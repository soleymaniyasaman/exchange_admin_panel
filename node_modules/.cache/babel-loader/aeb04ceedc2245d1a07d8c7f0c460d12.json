{"ast":null,"code":"import * as EVENTS from './../../common/constant';\nimport { isNullOrUndefined as isNOU, detach, createElement, closest } from '@syncfusion/ej2-base';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { markerClassName } from './dom-node';\nimport { NodeCutter } from './nodecutter';\n/**\n * Formats internal component\n *\n * @hidden\n\n */\n\nvar Formats =\n/** @class */\nfunction () {\n  /**\n   * Constructor for creating the Formats plugin\n   *\n   * @param {EditorManager} parent - specifies the parent element.\n   * @hidden\n    */\n  function Formats(parent) {\n    this.parent = parent;\n    this.addEventListener();\n  }\n\n  Formats.prototype.addEventListener = function () {\n    this.parent.observer.on(EVENTS.FORMAT_TYPE, this.applyFormats, this);\n    this.parent.observer.on(EVENTS.KEY_UP_HANDLER, this.onKeyUp, this);\n    this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.onKeyDown, this);\n  };\n\n  Formats.prototype.getParentNode = function (node) {\n    for (; node.parentNode && node.parentNode !== this.parent.editableElement; null) {\n      node = node.parentNode;\n    }\n\n    return node;\n  };\n\n  Formats.prototype.onKeyUp = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    var endCon = range.endContainer;\n    var lastChild = endCon.lastChild;\n\n    if (e.event.which === 13 && range.startContainer === endCon && endCon.nodeType !== 3) {\n      var pTag = createElement('p');\n      pTag.innerHTML = '<br>';\n\n      if (!isNOU(lastChild) && lastChild && lastChild.nodeName === 'BR' && lastChild.previousSibling && lastChild.previousSibling.nodeName === 'TABLE') {\n        endCon.replaceChild(pTag, lastChild);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n      } else {\n        var brNode = this.parent.nodeSelection.getSelectionNodeCollectionBr(range)[0];\n\n        if (!isNOU(brNode) && brNode.nodeName === 'BR' && brNode.previousSibling && brNode.previousSibling.nodeName === 'TABLE') {\n          endCon.replaceChild(pTag, brNode);\n          this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n        }\n      }\n    }\n  };\n\n  Formats.prototype.onKeyDown = function (e) {\n    if (e.event.which === 13) {\n      var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n      var startCon = range.startContainer.textContent.length === 0 || range.startContainer.nodeName === 'PRE' ? range.startContainer : range.startContainer.parentElement;\n      var endCon = range.endContainer.textContent.length === 0 || range.endContainer.nodeName === 'PRE' ? range.endContainer : range.endContainer.parentElement;\n      var preElem = closest(startCon, 'pre');\n      var endPreElem = closest(endCon, 'pre');\n      var liParent = !isNOU(preElem) && !isNOU(preElem.parentElement) && preElem.parentElement.tagName === 'LI';\n\n      if (liParent) {\n        return;\n      }\n\n      if (isNOU(preElem) && !isNOU(endPreElem) || !isNOU(preElem) && isNOU(endPreElem)) {\n        e.event.preventDefault();\n        this.deleteContent(range);\n        this.removeCodeContent(range);\n        range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, endCon, 0);\n      }\n\n      if (e.event.which === 13 && !isNOU(preElem) && !isNOU(endPreElem)) {\n        e.event.preventDefault();\n        this.deleteContent(range);\n        this.removeCodeContent(range);\n        range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var lastEmpty = range.startContainer.childNodes[range.endOffset];\n        var lastBeforeBr = range.startContainer.childNodes[range.endOffset - 1];\n        var startParent = range.startContainer;\n\n        if (!isNOU(lastEmpty) && !isNOU(lastBeforeBr) && isNOU(lastEmpty.nextSibling) && lastEmpty.nodeName === 'BR' && lastBeforeBr.nodeName === 'BR') {\n          this.paraFocus(range.startContainer, e.enterAction);\n        } else if (startParent.textContent.charCodeAt(0) === 8203 && startParent.textContent.length === 1 || startParent.textContent.length === 0) {\n          //Double enter with any parent tag for the node\n          while (startParent.parentElement.nodeName !== 'PRE' && (startParent.textContent.length === 1 || startParent.textContent.length === 0)) {\n            startParent = startParent.parentElement;\n          }\n\n          if (!isNOU(startParent.previousSibling) && startParent.previousSibling.nodeName === 'BR' && isNOU(startParent.nextSibling)) {\n            this.paraFocus(startParent.parentElement);\n          } else {\n            this.isNotEndCursor(preElem, range);\n          }\n        } else {\n          //Cursor at start and middle\n          this.isNotEndCursor(preElem, range);\n        }\n      }\n    }\n  };\n\n  Formats.prototype.removeCodeContent = function (range) {\n    var regEx = new RegExp(String.fromCharCode(65279), 'g');\n\n    if (!isNOU(range.endContainer.textContent.match(regEx))) {\n      var pointer = range.endContainer.textContent.charCodeAt(range.endOffset - 1) === 65279 ? range.endOffset - 2 : range.endOffset;\n      range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n\n      if (range.endContainer.textContent === '') {\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer.parentElement, 0);\n      } else {\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer, pointer);\n      }\n    }\n  };\n\n  Formats.prototype.deleteContent = function (range) {\n    if (range.startContainer !== range.endContainer || range.startOffset !== range.endOffset) {\n      range.deleteContents();\n    }\n  };\n\n  Formats.prototype.paraFocus = function (referNode, enterAction) {\n    var insertTag;\n\n    if (enterAction === 'DIV') {\n      insertTag = createElement('div');\n      insertTag.innerHTML = '<br>';\n    } else if (enterAction === 'BR') {\n      insertTag = createElement('br');\n    } else {\n      insertTag = createElement('p');\n      insertTag.innerHTML = '<br>';\n    }\n\n    this.parent.domNode.insertAfter(insertTag, referNode);\n    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, insertTag, 0);\n    detach(referNode.lastChild);\n  };\n\n  Formats.prototype.isNotEndCursor = function (preElem, range) {\n    var nodeCutter = new NodeCutter();\n    var isEnd = range.startOffset === preElem.lastChild.textContent.length && preElem.lastChild.textContent === range.startContainer.textContent; //Cursor at start point\n\n    if (preElem.textContent.indexOf(range.startContainer.textContent) === 0 && (range.startOffset === 0 && range.endOffset === 0 || range.startContainer.nodeName === 'PRE')) {\n      this.insertMarker(preElem, range);\n      var brTag = createElement('br');\n      preElem.childNodes[range.endOffset].parentElement.insertBefore(brTag, preElem.childNodes[range.endOffset]);\n    } else {\n      //Cursor at middle\n      var cloneNode = nodeCutter.SplitNode(range, preElem, true);\n      this.insertMarker(preElem, range);\n      var previousSib = preElem.previousElementSibling;\n\n      if (previousSib.tagName === 'PRE') {\n        previousSib.insertAdjacentHTML('beforeend', '<br>' + cloneNode.innerHTML);\n        detach(preElem);\n      }\n    } //To place the cursor position\n\n\n    this.setCursorPosition(isEnd, preElem);\n  };\n\n  Formats.prototype.setCursorPosition = function (isEnd, preElem) {\n    var isEmpty = false;\n    var markerElem = this.parent.editableElement.querySelector('.tempSpan');\n    var mrkParentElem = markerElem.parentElement; // eslint-disable-next-line\n\n    markerElem.parentNode.textContent === '' ? isEmpty = true : this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n\n    if (isEnd) {\n      if (isEmpty) {\n        //Enter press when pre element is empty\n        if (mrkParentElem === preElem) {\n          this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n          detach(markerElem);\n        } else {\n          this.focusSelectionParent(markerElem, mrkParentElem);\n        }\n      } else {\n        var brElm = createElement('br');\n        this.parent.domNode.insertAfter(brElm, markerElem);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n        detach(markerElem);\n      }\n    } else {\n      // eslint-disable-next-line\n      isEmpty ? this.focusSelectionParent(markerElem, mrkParentElem) : detach(markerElem);\n    }\n  };\n\n  Formats.prototype.focusSelectionParent = function (markerElem, tempSpanPElem) {\n    detach(markerElem);\n    tempSpanPElem.innerHTML = '\\u200B';\n    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, tempSpanPElem, 0);\n  };\n\n  Formats.prototype.insertMarker = function (preElem, range) {\n    var tempSpan = createElement('span', {\n      className: 'tempSpan'\n    });\n\n    if (range.startContainer.nodeName === 'PRE') {\n      preElem.childNodes[range.endOffset].parentElement.insertBefore(tempSpan, preElem.childNodes[range.endOffset]);\n    } else {\n      range.startContainer.parentElement.insertBefore(tempSpan, range.startContainer);\n    }\n  };\n\n  Formats.prototype.applyFormats = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    var isSelectAll = false;\n\n    if (this.parent.editableElement === range.endContainer && !isNOU(this.parent.editableElement.children[range.endOffset - 1]) && this.parent.editableElement.children[range.endOffset - 1].tagName === 'TABLE' && !range.collapsed) {\n      isSelectAll = true;\n    }\n\n    var save = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n    this.parent.domNode.setMarker(save);\n    var formatsNodes = this.parent.domNode.blockNodes();\n\n    if (e.enterAction === 'BR') {\n      this.setSelectionBRConfig();\n      var allSelectedNode = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument);\n      var selectedNodes = this.parent.nodeSelection.getSelectionNodes(allSelectedNode);\n      var currentFormatNodes = [];\n\n      if (selectedNodes.length === 0) {\n        selectedNodes.push(formatsNodes[0]);\n      }\n\n      for (var i = 0; i < selectedNodes.length; i++) {\n        var currentNode = selectedNodes[i];\n        var previousCurrentNode = void 0;\n\n        while (!this.parent.domNode.isBlockNode(currentNode) && currentNode !== this.parent.editableElement) {\n          previousCurrentNode = currentNode;\n          currentNode = currentNode.parentElement;\n        }\n\n        if (this.parent.domNode.isBlockNode(currentNode) && currentNode === this.parent.editableElement) {\n          currentFormatNodes.push(previousCurrentNode);\n        }\n      }\n\n      for (var i = 0; i < currentFormatNodes.length; i++) {\n        if (!this.parent.domNode.isBlockNode(currentFormatNodes[i])) {\n          var currentNode = currentFormatNodes[i];\n          var previousNode = currentNode;\n\n          while (currentNode === this.parent.editableElement) {\n            previousNode = currentNode;\n            currentNode = currentNode.parentElement;\n          }\n\n          var tempElem = void 0;\n\n          if (this.parent.domNode.isBlockNode(previousNode.parentElement) && previousNode.parentElement === this.parent.editableElement) {\n            tempElem = createElement('div');\n            previousNode.parentElement.insertBefore(tempElem, previousNode);\n            tempElem.appendChild(previousNode);\n          } else {\n            tempElem = previousNode;\n          }\n\n          var preNode = tempElem.previousSibling;\n\n          while (!isNOU(preNode) && preNode.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(preNode)) {\n            tempElem.firstChild.parentElement.insertBefore(preNode, tempElem.firstChild);\n            preNode = tempElem.previousSibling;\n          }\n\n          if (!isNOU(preNode) && preNode.nodeName === 'BR') {\n            detach(preNode);\n          }\n\n          var postNode = tempElem.nextSibling;\n\n          while (!isNOU(postNode) && postNode.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(postNode)) {\n            tempElem.appendChild(postNode);\n            postNode = tempElem.nextSibling;\n          }\n\n          if (!isNOU(postNode) && postNode.nodeName === 'BR') {\n            detach(postNode);\n          }\n        }\n      }\n\n      this.setSelectionBRConfig();\n      formatsNodes = this.parent.domNode.blockNodes();\n    }\n\n    for (var i = 0; i < formatsNodes.length; i++) {\n      var parentNode = void 0;\n      var replaceHTML = void 0;\n\n      if (e.subCommand.toLowerCase() === 'blockquote') {\n        parentNode = this.getParentNode(formatsNodes[i]);\n        replaceHTML = this.parent.domNode.isList(parentNode) || parentNode.tagName === 'TABLE' ? parentNode.outerHTML : parentNode.innerHTML;\n      } else {\n        parentNode = formatsNodes[i];\n        replaceHTML = parentNode.innerHTML;\n      }\n\n      if (e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() && (e.subCommand.toLowerCase() !== 'pre' || !isNOU(e.exeValue) && e.exeValue.name === 'dropDownSelect') || isNOU(parentNode.parentNode) || parentNode.tagName === 'TABLE' && e.subCommand.toLowerCase() === 'pre') {\n        continue;\n      }\n\n      this.cleanFormats(parentNode, e.subCommand);\n      var replaceNode = e.subCommand.toLowerCase() === 'pre' && parentNode.tagName.toLowerCase() === 'pre' ? 'p' : e.subCommand;\n      var replaceTag = this.parent.domNode.createTagString(replaceNode, parentNode, replaceHTML.replace(/>\\s+</g, '><'));\n\n      if (parentNode.tagName === 'LI') {\n        parentNode.innerHTML = '';\n        parentNode.insertAdjacentHTML('beforeend', replaceTag);\n      } else {\n        this.parent.domNode.replaceWith(parentNode, replaceTag);\n      }\n    }\n\n    this.preFormatMerge();\n    var startNode = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n    var endNode = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n\n    if (!isNOU(startNode) && !isNOU(endNode)) {\n      startNode = startNode.lastChild;\n      endNode = endNode.lastChild;\n    }\n\n    save = this.parent.domNode.saveMarker(save, null);\n\n    if (isIDevice()) {\n      setEditFrameFocus(this.parent.editableElement, e.selector);\n    }\n\n    if (isSelectAll) {\n      this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startNode, endNode, 0, endNode.textContent.length);\n    } else {\n      save.restore();\n    }\n\n    if (e.callBack) {\n      e.callBack({\n        requestType: e.subCommand,\n        editorMode: 'HTML',\n        event: e.event,\n        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n        elements: this.parent.domNode.blockNodes()\n      });\n    }\n  };\n\n  Formats.prototype.setSelectionBRConfig = function () {\n    var startElem = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n    var endElem = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n\n    if (isNOU(endElem)) {\n      this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, startElem, 0);\n    } else {\n      this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startElem, endElem, 0, 0);\n    }\n  };\n\n  Formats.prototype.preFormatMerge = function () {\n    var preNodes = this.parent.editableElement.querySelectorAll('PRE');\n\n    if (!isNOU(preNodes)) {\n      for (var i = 0; i < preNodes.length; i++) {\n        var previousSib = preNodes[i].previousElementSibling;\n\n        if (!isNOU(previousSib) && previousSib.tagName === 'PRE') {\n          previousSib.insertAdjacentHTML('beforeend', '<br>' + preNodes[i].innerHTML);\n          detach(preNodes[i]);\n        }\n      }\n    }\n  };\n\n  Formats.prototype.cleanFormats = function (element, tagName) {\n    var ignoreAttr = ['display', 'font-size', 'margin-top', 'margin-bottom', 'margin-left', 'margin-right', 'font-weight'];\n    tagName = tagName.toLowerCase();\n\n    for (var i = 0; i < ignoreAttr.length && tagName !== 'p' && tagName !== 'blockquote' && tagName !== 'pre'; i++) {\n      element.style.removeProperty(ignoreAttr[i]);\n    }\n  };\n\n  return Formats;\n}();\n\nexport { Formats };","map":{"version":3,"sources":["/Users/yasaman/Documents/moj_adminpanel/adminpanel/node_modules/@syncfusion/ej2-richtexteditor/src/editor-manager/plugin/formats.js"],"names":["EVENTS","isNullOrUndefined","isNOU","detach","createElement","closest","isIDevice","setEditFrameFocus","markerClassName","NodeCutter","Formats","parent","addEventListener","prototype","observer","on","FORMAT_TYPE","applyFormats","KEY_UP_HANDLER","onKeyUp","KEY_DOWN_HANDLER","onKeyDown","getParentNode","node","parentNode","editableElement","e","range","nodeSelection","getRange","currentDocument","endCon","endContainer","lastChild","event","which","startContainer","nodeType","pTag","innerHTML","nodeName","previousSibling","replaceChild","setCursorPoint","brNode","getSelectionNodeCollectionBr","startCon","textContent","length","parentElement","preElem","endPreElem","liParent","tagName","preventDefault","deleteContent","removeCodeContent","lastEmpty","childNodes","endOffset","lastBeforeBr","startParent","nextSibling","paraFocus","enterAction","charCodeAt","isNotEndCursor","regEx","RegExp","String","fromCharCode","match","pointer","replace","startOffset","deleteContents","referNode","insertTag","domNode","insertAfter","nodeCutter","isEnd","indexOf","insertMarker","brTag","insertBefore","cloneNode","SplitNode","previousSib","previousElementSibling","insertAdjacentHTML","setCursorPosition","isEmpty","markerElem","querySelector","mrkParentElem","focusSelectionParent","brElm","tempSpanPElem","tempSpan","className","isSelectAll","children","collapsed","save","setMarker","formatsNodes","blockNodes","setSelectionBRConfig","allSelectedNode","getSelectedNodes","selectedNodes","getSelectionNodes","currentFormatNodes","push","i","currentNode","previousCurrentNode","isBlockNode","previousNode","tempElem","appendChild","preNode","firstChild","postNode","replaceHTML","subCommand","toLowerCase","isList","outerHTML","exeValue","name","cleanFormats","replaceNode","replaceTag","createTagString","replaceWith","preFormatMerge","startNode","startSelection","endNode","endSelection","saveMarker","selector","setSelectionText","restore","callBack","requestType","editorMode","elements","startElem","endElem","preNodes","querySelectorAll","element","ignoreAttr","style","removeProperty"],"mappings":"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","sourcesContent":["import * as EVENTS from './../../common/constant';\nimport { isNullOrUndefined as isNOU, detach, createElement, closest } from '@syncfusion/ej2-base';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { markerClassName } from './dom-node';\nimport { NodeCutter } from './nodecutter';\n/**\n * Formats internal component\n *\n * @hidden\n\n */\nvar Formats = /** @class */ (function () {\n    /**\n     * Constructor for creating the Formats plugin\n     *\n     * @param {EditorManager} parent - specifies the parent element.\n     * @hidden\n\n     */\n    function Formats(parent) {\n        this.parent = parent;\n        this.addEventListener();\n    }\n    Formats.prototype.addEventListener = function () {\n        this.parent.observer.on(EVENTS.FORMAT_TYPE, this.applyFormats, this);\n        this.parent.observer.on(EVENTS.KEY_UP_HANDLER, this.onKeyUp, this);\n        this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.onKeyDown, this);\n    };\n    Formats.prototype.getParentNode = function (node) {\n        for (; node.parentNode && node.parentNode !== this.parent.editableElement; null) {\n            node = node.parentNode;\n        }\n        return node;\n    };\n    Formats.prototype.onKeyUp = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var endCon = range.endContainer;\n        var lastChild = endCon.lastChild;\n        if (e.event.which === 13 && range.startContainer === endCon && endCon.nodeType !== 3) {\n            var pTag = createElement('p');\n            pTag.innerHTML = '<br>';\n            if (!isNOU(lastChild) && lastChild && lastChild.nodeName === 'BR' && (lastChild.previousSibling && lastChild.previousSibling.nodeName === 'TABLE')) {\n                endCon.replaceChild(pTag, lastChild);\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n            }\n            else {\n                var brNode = this.parent.nodeSelection.getSelectionNodeCollectionBr(range)[0];\n                if (!isNOU(brNode) && brNode.nodeName === 'BR' && (brNode.previousSibling && brNode.previousSibling.nodeName === 'TABLE')) {\n                    endCon.replaceChild(pTag, brNode);\n                    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n                }\n            }\n        }\n    };\n    Formats.prototype.onKeyDown = function (e) {\n        if (e.event.which === 13) {\n            var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n            var startCon = (range.startContainer.textContent.length === 0 || range.startContainer.nodeName === 'PRE')\n                ? range.startContainer : range.startContainer.parentElement;\n            var endCon = (range.endContainer.textContent.length === 0 || range.endContainer.nodeName === 'PRE')\n                ? range.endContainer : range.endContainer.parentElement;\n            var preElem = closest(startCon, 'pre');\n            var endPreElem = closest(endCon, 'pre');\n            var liParent = !isNOU(preElem) && !isNOU(preElem.parentElement) && preElem.parentElement.tagName === 'LI';\n            if (liParent) {\n                return;\n            }\n            if (((isNOU(preElem) && !isNOU(endPreElem)) || (!isNOU(preElem) && isNOU(endPreElem)))) {\n                e.event.preventDefault();\n                this.deleteContent(range);\n                this.removeCodeContent(range);\n                range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, endCon, 0);\n            }\n            if (e.event.which === 13 && !isNOU(preElem) && !isNOU(endPreElem)) {\n                e.event.preventDefault();\n                this.deleteContent(range);\n                this.removeCodeContent(range);\n                range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n                var lastEmpty = range.startContainer.childNodes[range.endOffset];\n                var lastBeforeBr = range.startContainer.childNodes[range.endOffset - 1];\n                var startParent = range.startContainer;\n                if (!isNOU(lastEmpty) && !isNOU(lastBeforeBr) && isNOU(lastEmpty.nextSibling) &&\n                    lastEmpty.nodeName === 'BR' && lastBeforeBr.nodeName === 'BR') {\n                    this.paraFocus(range.startContainer, e.enterAction);\n                }\n                else if ((startParent.textContent.charCodeAt(0) === 8203 &&\n                    startParent.textContent.length === 1) || startParent.textContent.length === 0) {\n                    //Double enter with any parent tag for the node\n                    while (startParent.parentElement.nodeName !== 'PRE' &&\n                        (startParent.textContent.length === 1 || startParent.textContent.length === 0)) {\n                        startParent = startParent.parentElement;\n                    }\n                    if (!isNOU(startParent.previousSibling) && startParent.previousSibling.nodeName === 'BR' &&\n                        isNOU(startParent.nextSibling)) {\n                        this.paraFocus(startParent.parentElement);\n                    }\n                    else {\n                        this.isNotEndCursor(preElem, range);\n                    }\n                }\n                else {\n                    //Cursor at start and middle\n                    this.isNotEndCursor(preElem, range);\n                }\n            }\n        }\n    };\n    Formats.prototype.removeCodeContent = function (range) {\n        var regEx = new RegExp(String.fromCharCode(65279), 'g');\n        if (!isNOU(range.endContainer.textContent.match(regEx))) {\n            var pointer = range.endContainer.textContent.charCodeAt(range.endOffset - 1) === 65279 ?\n                range.endOffset - 2 : range.endOffset;\n            range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n            if (range.endContainer.textContent === '') {\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer.parentElement, 0);\n            }\n            else {\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer, pointer);\n            }\n        }\n    };\n    Formats.prototype.deleteContent = function (range) {\n        if (range.startContainer !== range.endContainer || range.startOffset !== range.endOffset) {\n            range.deleteContents();\n        }\n    };\n    Formats.prototype.paraFocus = function (referNode, enterAction) {\n        var insertTag;\n        if (enterAction === 'DIV') {\n            insertTag = createElement('div');\n            insertTag.innerHTML = '<br>';\n        }\n        else if (enterAction === 'BR') {\n            insertTag = createElement('br');\n        }\n        else {\n            insertTag = createElement('p');\n            insertTag.innerHTML = '<br>';\n        }\n        this.parent.domNode.insertAfter(insertTag, referNode);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, insertTag, 0);\n        detach(referNode.lastChild);\n    };\n    Formats.prototype.isNotEndCursor = function (preElem, range) {\n        var nodeCutter = new NodeCutter();\n        var isEnd = range.startOffset === preElem.lastChild.textContent.length &&\n            preElem.lastChild.textContent === range.startContainer.textContent;\n        //Cursor at start point\n        if (preElem.textContent.indexOf(range.startContainer.textContent) === 0 &&\n            ((range.startOffset === 0 && range.endOffset === 0) || range.startContainer.nodeName === 'PRE')) {\n            this.insertMarker(preElem, range);\n            var brTag = createElement('br');\n            preElem.childNodes[range.endOffset].parentElement.insertBefore(brTag, preElem.childNodes[range.endOffset]);\n        }\n        else {\n            //Cursor at middle\n            var cloneNode = nodeCutter.SplitNode(range, preElem, true);\n            this.insertMarker(preElem, range);\n            var previousSib = preElem.previousElementSibling;\n            if (previousSib.tagName === 'PRE') {\n                previousSib.insertAdjacentHTML('beforeend', '<br>' + cloneNode.innerHTML);\n                detach(preElem);\n            }\n        }\n        //To place the cursor position\n        this.setCursorPosition(isEnd, preElem);\n    };\n    Formats.prototype.setCursorPosition = function (isEnd, preElem) {\n        var isEmpty = false;\n        var markerElem = this.parent.editableElement.querySelector('.tempSpan');\n        var mrkParentElem = markerElem.parentElement;\n        // eslint-disable-next-line\n        markerElem.parentNode.textContent === '' ? isEmpty = true :\n            this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n        if (isEnd) {\n            if (isEmpty) {\n                //Enter press when pre element is empty\n                if (mrkParentElem === preElem) {\n                    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n                    detach(markerElem);\n                }\n                else {\n                    this.focusSelectionParent(markerElem, mrkParentElem);\n                }\n            }\n            else {\n                var brElm = createElement('br');\n                this.parent.domNode.insertAfter(brElm, markerElem);\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n                detach(markerElem);\n            }\n        }\n        else {\n            // eslint-disable-next-line\n            isEmpty ? this.focusSelectionParent(markerElem, mrkParentElem) : detach(markerElem);\n        }\n    };\n    Formats.prototype.focusSelectionParent = function (markerElem, tempSpanPElem) {\n        detach(markerElem);\n        tempSpanPElem.innerHTML = '\\u200B';\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, tempSpanPElem, 0);\n    };\n    Formats.prototype.insertMarker = function (preElem, range) {\n        var tempSpan = createElement('span', { className: 'tempSpan' });\n        if (range.startContainer.nodeName === 'PRE') {\n            preElem.childNodes[range.endOffset].parentElement.insertBefore(tempSpan, preElem.childNodes[range.endOffset]);\n        }\n        else {\n            range.startContainer.parentElement.insertBefore(tempSpan, range.startContainer);\n        }\n    };\n    Formats.prototype.applyFormats = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var isSelectAll = false;\n        if (this.parent.editableElement === range.endContainer &&\n            !isNOU(this.parent.editableElement.children[range.endOffset - 1]) &&\n            this.parent.editableElement.children[range.endOffset - 1].tagName === 'TABLE' && !range.collapsed) {\n            isSelectAll = true;\n        }\n        var save = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n        this.parent.domNode.setMarker(save);\n        var formatsNodes = this.parent.domNode.blockNodes();\n        if (e.enterAction === 'BR') {\n            this.setSelectionBRConfig();\n            var allSelectedNode = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument);\n            var selectedNodes = this.parent.nodeSelection.getSelectionNodes(allSelectedNode);\n            var currentFormatNodes = [];\n            if (selectedNodes.length === 0) {\n                selectedNodes.push(formatsNodes[0]);\n            }\n            for (var i = 0; i < selectedNodes.length; i++) {\n                var currentNode = selectedNodes[i];\n                var previousCurrentNode = void 0;\n                while (!this.parent.domNode.isBlockNode(currentNode) && currentNode !== this.parent.editableElement) {\n                    previousCurrentNode = currentNode;\n                    currentNode = currentNode.parentElement;\n                }\n                if (this.parent.domNode.isBlockNode(currentNode) && currentNode === this.parent.editableElement) {\n                    currentFormatNodes.push(previousCurrentNode);\n                }\n            }\n            for (var i = 0; i < currentFormatNodes.length; i++) {\n                if (!this.parent.domNode.isBlockNode(currentFormatNodes[i])) {\n                    var currentNode = currentFormatNodes[i];\n                    var previousNode = currentNode;\n                    while (currentNode === this.parent.editableElement) {\n                        previousNode = currentNode;\n                        currentNode = currentNode.parentElement;\n                    }\n                    var tempElem = void 0;\n                    if (this.parent.domNode.isBlockNode(previousNode.parentElement) &&\n                        previousNode.parentElement === this.parent.editableElement) {\n                        tempElem = createElement('div');\n                        previousNode.parentElement.insertBefore(tempElem, previousNode);\n                        tempElem.appendChild(previousNode);\n                    }\n                    else {\n                        tempElem = previousNode;\n                    }\n                    var preNode = tempElem.previousSibling;\n                    while (!isNOU(preNode) && preNode.nodeName !== 'BR' &&\n                        !this.parent.domNode.isBlockNode(preNode)) {\n                        tempElem.firstChild.parentElement.insertBefore(preNode, tempElem.firstChild);\n                        preNode = tempElem.previousSibling;\n                    }\n                    if (!isNOU(preNode) && preNode.nodeName === 'BR') {\n                        detach(preNode);\n                    }\n                    var postNode = tempElem.nextSibling;\n                    while (!isNOU(postNode) && postNode.nodeName !== 'BR' &&\n                        !this.parent.domNode.isBlockNode(postNode)) {\n                        tempElem.appendChild(postNode);\n                        postNode = tempElem.nextSibling;\n                    }\n                    if (!isNOU(postNode) && postNode.nodeName === 'BR') {\n                        detach(postNode);\n                    }\n                }\n            }\n            this.setSelectionBRConfig();\n            formatsNodes = this.parent.domNode.blockNodes();\n        }\n        for (var i = 0; i < formatsNodes.length; i++) {\n            var parentNode = void 0;\n            var replaceHTML = void 0;\n            if (e.subCommand.toLowerCase() === 'blockquote') {\n                parentNode = this.getParentNode(formatsNodes[i]);\n                replaceHTML = this.parent.domNode.isList(parentNode) ||\n                    parentNode.tagName === 'TABLE' ? parentNode.outerHTML : parentNode.innerHTML;\n            }\n            else {\n                parentNode = formatsNodes[i];\n                replaceHTML = parentNode.innerHTML;\n            }\n            if ((e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() &&\n                (e.subCommand.toLowerCase() !== 'pre' ||\n                    (!isNOU(e.exeValue) && e.exeValue.name === 'dropDownSelect'))) ||\n                isNOU(parentNode.parentNode) ||\n                (parentNode.tagName === 'TABLE' && e.subCommand.toLowerCase() === 'pre')) {\n                continue;\n            }\n            this.cleanFormats(parentNode, e.subCommand);\n            var replaceNode = (e.subCommand.toLowerCase() === 'pre' && parentNode.tagName.toLowerCase() === 'pre') ?\n                'p' : e.subCommand;\n            var replaceTag = this.parent.domNode.createTagString(replaceNode, parentNode, replaceHTML.replace(/>\\s+</g, '><'));\n            if (parentNode.tagName === 'LI') {\n                parentNode.innerHTML = '';\n                parentNode.insertAdjacentHTML('beforeend', replaceTag);\n            }\n            else {\n                this.parent.domNode.replaceWith(parentNode, replaceTag);\n            }\n        }\n        this.preFormatMerge();\n        var startNode = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n        var endNode = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n        if (!isNOU(startNode) && !isNOU(endNode)) {\n            startNode = startNode.lastChild;\n            endNode = endNode.lastChild;\n        }\n        save = this.parent.domNode.saveMarker(save, null);\n        if (isIDevice()) {\n            setEditFrameFocus(this.parent.editableElement, e.selector);\n        }\n        if (isSelectAll) {\n            this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startNode, endNode, 0, endNode.textContent.length);\n        }\n        else {\n            save.restore();\n        }\n        if (e.callBack) {\n            e.callBack({\n                requestType: e.subCommand,\n                editorMode: 'HTML',\n                event: e.event,\n                range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n                elements: this.parent.domNode.blockNodes()\n            });\n        }\n    };\n    Formats.prototype.setSelectionBRConfig = function () {\n        var startElem = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n        var endElem = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n        if (isNOU(endElem)) {\n            this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, startElem, 0);\n        }\n        else {\n            this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startElem, endElem, 0, 0);\n        }\n    };\n    Formats.prototype.preFormatMerge = function () {\n        var preNodes = this.parent.editableElement.querySelectorAll('PRE');\n        if (!isNOU(preNodes)) {\n            for (var i = 0; i < preNodes.length; i++) {\n                var previousSib = preNodes[i].previousElementSibling;\n                if (!isNOU(previousSib) && previousSib.tagName === 'PRE') {\n                    previousSib.insertAdjacentHTML('beforeend', '<br>' + preNodes[i].innerHTML);\n                    detach(preNodes[i]);\n                }\n            }\n        }\n    };\n    Formats.prototype.cleanFormats = function (element, tagName) {\n        var ignoreAttr = ['display', 'font-size', 'margin-top', 'margin-bottom', 'margin-left', 'margin-right', 'font-weight'];\n        tagName = tagName.toLowerCase();\n        for (var i = 0; i < ignoreAttr.length && (tagName !== 'p' && tagName !== 'blockquote' && tagName !== 'pre'); i++) {\n            element.style.removeProperty(ignoreAttr[i]);\n        }\n    };\n    return Formats;\n}());\nexport { Formats };\n"]},"metadata":{},"sourceType":"module"}