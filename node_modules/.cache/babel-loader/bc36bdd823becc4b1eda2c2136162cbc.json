{"ast":null,"code":"import { removeClass, selectAll, isNullOrUndefined, EventHandler } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { CLS_EXPAND_OPEN, CLS_TB_ITEM, CLS_ACTIVE } from '../base/classes';\nimport * as CONSTANT from '../../common/constant';\nimport { RenderType } from '../base/enum';\nimport { KeyboardEvents } from '../actions/keyboard';\n/**\n * Content module is used to render Rich Text Editor content\n *\n * @hidden\n\n */\n\nvar ViewSource =\n/** @class */\nfunction () {\n  /**\n   * Constructor for view source module\n   *\n   * @param {IRichTextEditor} parent - specifies the parent element.\n   * @param {ServiceLocator} locator - specifies the locator.\n   * @returns {void}\n   */\n  function ViewSource(parent, locator) {\n    this.parent = parent;\n    var serviceLocator = locator;\n    this.rendererFactory = serviceLocator.getService('rendererFactory');\n    this.addEventListener();\n  }\n\n  ViewSource.prototype.addEventListener = function () {\n    this.parent.on(events.sourceCode, this.sourceCode, this);\n    this.parent.on(events.initialEnd, this.onInitialEnd, this);\n    this.parent.on(events.updateSource, this.updateSourceCode, this);\n    this.parent.on(events.destroy, this.destroy, this);\n  };\n\n  ViewSource.prototype.onInitialEnd = function () {\n    this.parent.formatter.editorManager.observer.on(CONSTANT.KEY_DOWN_HANDLER, this.onKeyDown, this);\n  };\n\n  ViewSource.prototype.removeEventListener = function () {\n    this.unWireEvent();\n    this.parent.off(events.sourceCode, this.sourceCode);\n    this.parent.off(events.updateSource, this.updateSourceCode);\n    this.parent.off(events.initialEnd, this.onInitialEnd);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.formatter.editorManager.observer.off(CONSTANT.KEY_DOWN_HANDLER, this.onKeyDown);\n  };\n\n  ViewSource.prototype.getSourceCode = function () {\n    return this.parent.createElement('textarea', {\n      className: 'e-rte-srctextarea'\n    });\n  };\n\n  ViewSource.prototype.wireEvent = function (element) {\n    this.keyboardModule = new KeyboardEvents(element, {\n      keyAction: this.previewKeyDown.bind(this),\n      keyConfigs: this.parent.formatter.keyConfig,\n      eventName: 'keydown'\n    });\n    EventHandler.add(this.previewElement, 'mousedown', this.mouseDownHandler, this);\n  };\n\n  ViewSource.prototype.unWireEvent = function () {\n    if (this.keyboardModule) {\n      this.keyboardModule.destroy();\n    }\n\n    if (this.previewElement) {\n      EventHandler.remove(this.previewElement, 'mousedown', this.mouseDownHandler);\n    }\n  };\n\n  ViewSource.prototype.wireBaseKeyDown = function () {\n    this.parent.keyboardModule = new KeyboardEvents(this.contentModule.getEditPanel(), {\n      keyAction: this.parent.keyDown.bind(this.parent),\n      keyConfigs: this.parent.formatter.keyConfig,\n      eventName: 'keydown'\n    });\n  };\n\n  ViewSource.prototype.unWireBaseKeyDown = function () {\n    this.parent.keyboardModule.destroy();\n  };\n\n  ViewSource.prototype.mouseDownHandler = function (e) {\n    this.parent.notify(events.sourceCodeMouseDown, {\n      args: e\n    });\n  };\n\n  ViewSource.prototype.previewKeyDown = function (event) {\n    switch (event.action) {\n      case 'html-source':\n        this.updateSourceCode(event);\n        event.preventDefault();\n        break;\n\n      case 'toolbar-focus':\n        if (this.parent.toolbarSettings.enable) {\n          var selector = '.e-toolbar-item[aria-disabled=\"false\"][title] [tabindex]';\n          this.parent.toolbarModule.baseToolbar.toolbarObj.element.querySelector(selector).focus();\n        }\n\n        break;\n    }\n  };\n\n  ViewSource.prototype.onKeyDown = function (e) {\n    switch (e.event.action) {\n      case 'html-source':\n        e.event.preventDefault();\n        this.sourceCode(e);\n        e.callBack({\n          requestType: 'SourceCode',\n          editorMode: 'HTML',\n          event: e.event\n        });\n        break;\n    }\n  };\n  /**\n   * sourceCode method\n   *\n   * @param {ClickEventArgs} args - specifies the click event.\n   * @returns {void}\n   * @hidden\n    */\n\n\n  ViewSource.prototype.sourceCode = function (args) {\n    this.parent.isBlur = false;\n    this.parent.trigger(events.actionBegin, {\n      requestType: 'SourceCode',\n      targetItem: 'SourceCode',\n      args: args\n    });\n    var tbItems = selectAll('.' + CLS_TB_ITEM, this.parent.element);\n    this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n    this.parent.notify(events.updateToolbarItem, {\n      targetItem: 'SourceCode',\n      updateItem: 'Preview',\n      baseToolbar: this.parent.getBaseToolbarObject()\n    });\n\n    if (isNullOrUndefined(this.previewElement)) {\n      this.previewElement = this.getSourceCode();\n    }\n\n    this.parent.updateValueData();\n\n    if (this.parent.iframeSettings.enable) {\n      var rteContent = void 0;\n\n      if (isNullOrUndefined(this.parent.element.querySelector('#' + this.parent.element.id + '_source-view'))) {\n        rteContent = this.parent.createElement('div', {\n          className: 'e-source-content',\n          id: this.parent.element.id + '_source-view'\n        });\n      } else {\n        rteContent = this.parent.element.querySelector('#' + this.parent.element.id + '_source-view');\n      }\n\n      rteContent.appendChild(this.previewElement);\n      this.parent.element.appendChild(rteContent);\n      rteContent.style.height = this.contentModule.getPanel().style.height;\n      rteContent.style.marginTop = this.contentModule.getPanel().style.marginTop;\n      this.getPanel().value = this.getTextAreaValue();\n      this.contentModule.getPanel().style.display = 'none';\n      rteContent.style.display = 'block';\n      this.getPanel().style.display = 'block';\n    } else {\n      this.contentModule.getPanel().appendChild(this.previewElement);\n      this.getPanel().value = this.getTextAreaValue();\n      this.contentModule.getEditPanel().style.display = 'none';\n      this.previewElement.style.display = 'block';\n    }\n\n    this.parent.isBlur = false;\n    this.parent.disableToolbarItem(this.parent.toolbarSettings.items);\n    this.parent.enableToolbarItem('SourceCode');\n\n    if (this.parent.getToolbar()) {\n      removeClass([this.parent.getToolbar()], [CLS_EXPAND_OPEN]);\n    }\n\n    removeClass(tbItems, [CLS_ACTIVE]);\n    this.parent.setContentHeight('sourceCode', true);\n    this.wireEvent(this.previewElement);\n    this.unWireBaseKeyDown();\n    this.previewElement.focus();\n    this.parent.updateValue();\n\n    if (!isNullOrUndefined(this.parent.placeholder) && !this.parent.iframeSettings.enable) {\n      var placeHolderWrapper = this.parent.element.querySelector('.rte-placeholder.e-rte-placeholder');\n      placeHolderWrapper.style.display = 'none';\n    }\n\n    this.parent.trigger(events.actionComplete, {\n      requestType: 'SourceCode',\n      targetItem: 'SourceCode',\n      args: args\n    });\n    this.parent.invokeChangeEvent();\n  };\n  /**\n   * updateSourceCode method\n   *\n   * @param {ClickEventArgs} args - specifies the click event.\n   * @returns {void}\n   * @hidden\n    */\n\n\n  ViewSource.prototype.updateSourceCode = function (args) {\n    this.parent.isBlur = false;\n    this.parent.trigger(events.actionBegin, {\n      requestType: 'Preview',\n      targetItem: 'Preview',\n      args: args\n    });\n    var editHTML = this.getPanel();\n    this.parent.notify(events.updateToolbarItem, {\n      targetItem: 'Preview',\n      updateItem: 'SourceCode',\n      baseToolbar: this.parent.getBaseToolbarObject()\n    });\n    var serializeValue = this.parent.serializeValue(editHTML.value);\n    var value;\n\n    if (serializeValue === null || serializeValue === '') {\n      if (this.parent.enterKey === 'DIV') {\n        value = '<div><br/></div>';\n      } else if (this.parent.enterKey === 'BR') {\n        value = '<br/>';\n      } else {\n        value = '<p><br/></p>';\n      }\n    } else {\n      value = serializeValue;\n    }\n\n    if (this.parent.iframeSettings.enable) {\n      editHTML.parentElement.style.display = 'none';\n      editHTML.style.display = 'none';\n      this.contentModule.getPanel().style.display = 'block';\n      this.contentModule.getEditPanel().innerHTML = value;\n    } else {\n      editHTML.style.display = 'none';\n      this.contentModule.getEditPanel().style.display = 'block';\n      this.contentModule.getEditPanel().innerHTML = value;\n    }\n\n    this.parent.isBlur = false;\n    this.parent.enableToolbarItem(this.parent.toolbarSettings.items);\n\n    if (this.parent.getToolbar()) {\n      removeClass([this.parent.getToolbar()], [CLS_EXPAND_OPEN]);\n    }\n\n    this.parent.setContentHeight('preview', true);\n    this.unWireEvent();\n    this.wireBaseKeyDown();\n    this.contentModule.getEditPanel().focus();\n    this.parent.updateValue();\n\n    if (!isNullOrUndefined(this.parent.placeholder) && this.contentModule.getEditPanel().innerText.length === 0) {\n      var placeHolderWrapper = this.parent.element.querySelector('.rte-placeholder.e-rte-placeholder');\n      placeHolderWrapper.style.display = 'block';\n    }\n\n    this.parent.trigger(events.actionComplete, {\n      requestType: 'Preview',\n      targetItem: 'Preview',\n      args: args\n    });\n    this.parent.formatter.enableUndo(this.parent);\n    this.parent.invokeChangeEvent();\n  };\n\n  ViewSource.prototype.getTextAreaValue = function () {\n    return this.contentModule.getEditPanel().innerHTML === '<p><br></p>' || this.contentModule.getEditPanel().innerHTML === '<div><br></div>' || this.contentModule.getEditPanel().innerHTML === '<br>' || this.contentModule.getEditPanel().childNodes.length === 1 && this.contentModule.getEditPanel().childNodes[0].tagName === 'P' && this.contentModule.getEditPanel().innerHTML.length === 7 || this.contentModule.getEditPanel().childNodes[0].tagName === 'DIV' && this.contentModule.getEditPanel().innerHTML.length === 11 ? '' : this.parent.value;\n  };\n  /**\n   * getPanel method\n   *\n   * @returns {void}\n   * @hidden\n    */\n\n\n  ViewSource.prototype.getPanel = function () {\n    return this.parent.element && this.parent.element.querySelector('.e-rte-srctextarea');\n  };\n  /**\n   * getViewPanel method\n   *\n   * @returns {void}\n   * @hidden\n    */\n\n\n  ViewSource.prototype.getViewPanel = function () {\n    return this.parent.iframeSettings.enable && this.getPanel() ? this.getPanel().parentElement : this.getPanel();\n  };\n  /**\n   * Destroy the entire RichTextEditor.\n   *\n   * @returns {void}\n   * @hidden\n    */\n\n\n  ViewSource.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return ViewSource;\n}();\n\nexport { ViewSource };","map":{"version":3,"sources":["/Users/yasaman/Documents/moj_adminpanel/adminpanel/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/renderer/view-source.js"],"names":["removeClass","selectAll","isNullOrUndefined","EventHandler","events","CLS_EXPAND_OPEN","CLS_TB_ITEM","CLS_ACTIVE","CONSTANT","RenderType","KeyboardEvents","ViewSource","parent","locator","serviceLocator","rendererFactory","getService","addEventListener","prototype","on","sourceCode","initialEnd","onInitialEnd","updateSource","updateSourceCode","destroy","formatter","editorManager","observer","KEY_DOWN_HANDLER","onKeyDown","removeEventListener","unWireEvent","off","getSourceCode","createElement","className","wireEvent","element","keyboardModule","keyAction","previewKeyDown","bind","keyConfigs","keyConfig","eventName","add","previewElement","mouseDownHandler","remove","wireBaseKeyDown","contentModule","getEditPanel","keyDown","unWireBaseKeyDown","e","notify","sourceCodeMouseDown","args","event","action","preventDefault","toolbarSettings","enable","selector","toolbarModule","baseToolbar","toolbarObj","querySelector","focus","callBack","requestType","editorMode","isBlur","trigger","actionBegin","targetItem","tbItems","getRenderer","Content","updateToolbarItem","updateItem","getBaseToolbarObject","updateValueData","iframeSettings","rteContent","id","appendChild","style","height","getPanel","marginTop","value","getTextAreaValue","display","disableToolbarItem","items","enableToolbarItem","getToolbar","setContentHeight","updateValue","placeholder","placeHolderWrapper","actionComplete","invokeChangeEvent","editHTML","serializeValue","enterKey","parentElement","innerHTML","innerText","length","enableUndo","childNodes","tagName","getViewPanel"],"mappings":"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","sourcesContent":["import { removeClass, selectAll, isNullOrUndefined, EventHandler } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { CLS_EXPAND_OPEN, CLS_TB_ITEM, CLS_ACTIVE } from '../base/classes';\nimport * as CONSTANT from '../../common/constant';\nimport { RenderType } from '../base/enum';\nimport { KeyboardEvents } from '../actions/keyboard';\n/**\n * Content module is used to render Rich Text Editor content\n *\n * @hidden\n\n */\nvar ViewSource = /** @class */ (function () {\n    /**\n     * Constructor for view source module\n     *\n     * @param {IRichTextEditor} parent - specifies the parent element.\n     * @param {ServiceLocator} locator - specifies the locator.\n     * @returns {void}\n     */\n    function ViewSource(parent, locator) {\n        this.parent = parent;\n        var serviceLocator = locator;\n        this.rendererFactory = serviceLocator.getService('rendererFactory');\n        this.addEventListener();\n    }\n    ViewSource.prototype.addEventListener = function () {\n        this.parent.on(events.sourceCode, this.sourceCode, this);\n        this.parent.on(events.initialEnd, this.onInitialEnd, this);\n        this.parent.on(events.updateSource, this.updateSourceCode, this);\n        this.parent.on(events.destroy, this.destroy, this);\n    };\n    ViewSource.prototype.onInitialEnd = function () {\n        this.parent.formatter.editorManager.observer.on(CONSTANT.KEY_DOWN_HANDLER, this.onKeyDown, this);\n    };\n    ViewSource.prototype.removeEventListener = function () {\n        this.unWireEvent();\n        this.parent.off(events.sourceCode, this.sourceCode);\n        this.parent.off(events.updateSource, this.updateSourceCode);\n        this.parent.off(events.initialEnd, this.onInitialEnd);\n        this.parent.off(events.destroy, this.destroy);\n        this.parent.formatter.editorManager.observer.off(CONSTANT.KEY_DOWN_HANDLER, this.onKeyDown);\n    };\n    ViewSource.prototype.getSourceCode = function () {\n        return this.parent.createElement('textarea', { className: 'e-rte-srctextarea' });\n    };\n    ViewSource.prototype.wireEvent = function (element) {\n        this.keyboardModule = new KeyboardEvents(element, {\n            keyAction: this.previewKeyDown.bind(this), keyConfigs: this.parent.formatter.keyConfig, eventName: 'keydown'\n        });\n        EventHandler.add(this.previewElement, 'mousedown', this.mouseDownHandler, this);\n    };\n    ViewSource.prototype.unWireEvent = function () {\n        if (this.keyboardModule) {\n            this.keyboardModule.destroy();\n        }\n        if (this.previewElement) {\n            EventHandler.remove(this.previewElement, 'mousedown', this.mouseDownHandler);\n        }\n    };\n    ViewSource.prototype.wireBaseKeyDown = function () {\n        this.parent.keyboardModule = new KeyboardEvents(this.contentModule.getEditPanel(), {\n            keyAction: this.parent.keyDown.bind(this.parent), keyConfigs: this.parent.formatter.keyConfig, eventName: 'keydown'\n        });\n    };\n    ViewSource.prototype.unWireBaseKeyDown = function () {\n        this.parent.keyboardModule.destroy();\n    };\n    ViewSource.prototype.mouseDownHandler = function (e) {\n        this.parent.notify(events.sourceCodeMouseDown, { args: e });\n    };\n    ViewSource.prototype.previewKeyDown = function (event) {\n        switch (event.action) {\n            case 'html-source':\n                this.updateSourceCode(event);\n                event.preventDefault();\n                break;\n            case 'toolbar-focus':\n                if (this.parent.toolbarSettings.enable) {\n                    var selector = '.e-toolbar-item[aria-disabled=\"false\"][title] [tabindex]';\n                    this.parent.toolbarModule.baseToolbar.toolbarObj.element.querySelector(selector).focus();\n                }\n                break;\n        }\n    };\n    ViewSource.prototype.onKeyDown = function (e) {\n        switch (e.event.action) {\n            case 'html-source':\n                e.event.preventDefault();\n                this.sourceCode(e);\n                e.callBack({\n                    requestType: 'SourceCode',\n                    editorMode: 'HTML',\n                    event: e.event\n                });\n                break;\n        }\n    };\n    /**\n     * sourceCode method\n     *\n     * @param {ClickEventArgs} args - specifies the click event.\n     * @returns {void}\n     * @hidden\n\n     */\n    ViewSource.prototype.sourceCode = function (args) {\n        this.parent.isBlur = false;\n        this.parent.trigger(events.actionBegin, { requestType: 'SourceCode', targetItem: 'SourceCode', args: args });\n        var tbItems = selectAll('.' + CLS_TB_ITEM, this.parent.element);\n        this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n        this.parent.notify(events.updateToolbarItem, {\n            targetItem: 'SourceCode', updateItem: 'Preview',\n            baseToolbar: this.parent.getBaseToolbarObject()\n        });\n        if (isNullOrUndefined(this.previewElement)) {\n            this.previewElement = this.getSourceCode();\n        }\n        this.parent.updateValueData();\n        if (this.parent.iframeSettings.enable) {\n            var rteContent = void 0;\n            if (isNullOrUndefined(this.parent.element.querySelector('#' + this.parent.element.id + '_source-view'))) {\n                rteContent = this.parent.createElement('div', {\n                    className: 'e-source-content', id: this.parent.element.id + '_source-view'\n                });\n            }\n            else {\n                rteContent = this.parent.element.querySelector('#' + this.parent.element.id + '_source-view');\n            }\n            rteContent.appendChild(this.previewElement);\n            this.parent.element.appendChild(rteContent);\n            rteContent.style.height = this.contentModule.getPanel().style.height;\n            rteContent.style.marginTop = this.contentModule.getPanel().style.marginTop;\n            this.getPanel().value = this.getTextAreaValue();\n            this.contentModule.getPanel().style.display = 'none';\n            rteContent.style.display = 'block';\n            this.getPanel().style.display = 'block';\n        }\n        else {\n            this.contentModule.getPanel().appendChild(this.previewElement);\n            this.getPanel().value = this.getTextAreaValue();\n            this.contentModule.getEditPanel().style.display = 'none';\n            this.previewElement.style.display = 'block';\n        }\n        this.parent.isBlur = false;\n        this.parent.disableToolbarItem(this.parent.toolbarSettings.items);\n        this.parent.enableToolbarItem('SourceCode');\n        if (this.parent.getToolbar()) {\n            removeClass([this.parent.getToolbar()], [CLS_EXPAND_OPEN]);\n        }\n        removeClass(tbItems, [CLS_ACTIVE]);\n        this.parent.setContentHeight('sourceCode', true);\n        this.wireEvent(this.previewElement);\n        this.unWireBaseKeyDown();\n        this.previewElement.focus();\n        this.parent.updateValue();\n        if (!isNullOrUndefined(this.parent.placeholder) && !this.parent.iframeSettings.enable) {\n            var placeHolderWrapper = this.parent.element.querySelector('.rte-placeholder.e-rte-placeholder');\n            placeHolderWrapper.style.display = 'none';\n        }\n        this.parent.trigger(events.actionComplete, { requestType: 'SourceCode', targetItem: 'SourceCode', args: args });\n        this.parent.invokeChangeEvent();\n    };\n    /**\n     * updateSourceCode method\n     *\n     * @param {ClickEventArgs} args - specifies the click event.\n     * @returns {void}\n     * @hidden\n\n     */\n    ViewSource.prototype.updateSourceCode = function (args) {\n        this.parent.isBlur = false;\n        this.parent.trigger(events.actionBegin, { requestType: 'Preview', targetItem: 'Preview', args: args });\n        var editHTML = this.getPanel();\n        this.parent.notify(events.updateToolbarItem, {\n            targetItem: 'Preview', updateItem: 'SourceCode',\n            baseToolbar: this.parent.getBaseToolbarObject()\n        });\n        var serializeValue = this.parent.serializeValue(editHTML.value);\n        var value;\n        if (serializeValue === null || serializeValue === '') {\n            if (this.parent.enterKey === 'DIV') {\n                value = '<div><br/></div>';\n            }\n            else if (this.parent.enterKey === 'BR') {\n                value = '<br/>';\n            }\n            else {\n                value = '<p><br/></p>';\n            }\n        }\n        else {\n            value = serializeValue;\n        }\n        if (this.parent.iframeSettings.enable) {\n            editHTML.parentElement.style.display = 'none';\n            editHTML.style.display = 'none';\n            this.contentModule.getPanel().style.display = 'block';\n            this.contentModule.getEditPanel().innerHTML = value;\n        }\n        else {\n            editHTML.style.display = 'none';\n            this.contentModule.getEditPanel().style.display = 'block';\n            this.contentModule.getEditPanel().innerHTML = value;\n        }\n        this.parent.isBlur = false;\n        this.parent.enableToolbarItem(this.parent.toolbarSettings.items);\n        if (this.parent.getToolbar()) {\n            removeClass([this.parent.getToolbar()], [CLS_EXPAND_OPEN]);\n        }\n        this.parent.setContentHeight('preview', true);\n        this.unWireEvent();\n        this.wireBaseKeyDown();\n        this.contentModule.getEditPanel().focus();\n        this.parent.updateValue();\n        if (!isNullOrUndefined(this.parent.placeholder) && this.contentModule.getEditPanel().innerText.length === 0) {\n            var placeHolderWrapper = this.parent.element.querySelector('.rte-placeholder.e-rte-placeholder');\n            placeHolderWrapper.style.display = 'block';\n        }\n        this.parent.trigger(events.actionComplete, { requestType: 'Preview', targetItem: 'Preview', args: args });\n        this.parent.formatter.enableUndo(this.parent);\n        this.parent.invokeChangeEvent();\n    };\n    ViewSource.prototype.getTextAreaValue = function () {\n        return (this.contentModule.getEditPanel().innerHTML === '<p><br></p>') ||\n            (this.contentModule.getEditPanel().innerHTML === '<div><br></div>') ||\n            (this.contentModule.getEditPanel().innerHTML === '<br>') ||\n            (this.contentModule.getEditPanel().childNodes.length === 1 &&\n                (this.contentModule.getEditPanel().childNodes[0].tagName === 'P' &&\n                    this.contentModule.getEditPanel().innerHTML.length === 7) ||\n                (this.contentModule.getEditPanel().childNodes[0].tagName === 'DIV' &&\n                    this.contentModule.getEditPanel().innerHTML.length === 11)) ? '' : this.parent.value;\n    };\n    /**\n     * getPanel method\n     *\n     * @returns {void}\n     * @hidden\n\n     */\n    ViewSource.prototype.getPanel = function () {\n        return this.parent.element && this.parent.element.querySelector('.e-rte-srctextarea');\n    };\n    /**\n     * getViewPanel method\n     *\n     * @returns {void}\n     * @hidden\n\n     */\n    ViewSource.prototype.getViewPanel = function () {\n        return (this.parent.iframeSettings.enable && this.getPanel()) ? this.getPanel().parentElement : this.getPanel();\n    };\n    /**\n     * Destroy the entire RichTextEditor.\n     *\n     * @returns {void}\n     * @hidden\n\n     */\n    ViewSource.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return ViewSource;\n}());\nexport { ViewSource };\n"]},"metadata":{},"sourceType":"module"}