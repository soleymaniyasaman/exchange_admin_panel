{"ast":null,"code":"import _objectSpread from\"/Users/yasaman/Documents/moj_adminpanel/adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/yasaman/Documents/moj_adminpanel/adminpanel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import\"./style.css\";import{Field,Formik,Form}from\"formik\";import axios from\"axios\";import{Button,CircularProgress}from\"@material-ui/core\";import{AUTH_REFRESH,AUTH_LOGIN}from\"../../utils/constants\";// import { useFetchApi } from '../../utils/hooks';\nimport{RefreshToken,removeToken,setToken}from'../../utils/utils';import{useHistory}from'react-router-dom';import{UserContext}from'../../context/provider';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Login(props){var contextData=React.useContext(UserContext);var history=useHistory();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),loginLoading=_React$useState2[0],setLoginLoading=_React$useState2[1];var _React$useState3=React.useState(true),_React$useState4=_slicedToArray(_React$useState3,2),refreshLoading=_React$useState4[0],setRefreshLoading=_React$useState4[1];var _React$useState5=React.useState(''),_React$useState6=_slicedToArray(_React$useState5,2),hasError=_React$useState6[0],setHasError=_React$useState6[1];var setUserToken=function setUserToken(values){setToken(values);contextData.setIsLoggedIn(true);setTimeout(function(){return history.push('/users');},1000);};var checkUserRefreshToken=function checkUserRefreshToken(refreshToken){var payload={token:refreshToken};axios.post(AUTH_REFRESH,payload).then(function(res){return res.data;}).then(function(result){if(result.status_code===200){setUserToken(result.result);}}).catch(function(err){console.log(err);setRefreshLoading(false);removeToken();contextData.setIsLoggedIn(false);});};React.useEffect(function(){var refreshToken=RefreshToken();if(refreshToken){checkUserRefreshToken(refreshToken);}else{setRefreshLoading(false);}},[]);var handleSubmit=function handleSubmit(values){setHasError('');var payload=_objectSpread(_objectSpread({},values),{},{user_agent:window.navigator.userAgent,client_host:\"local\"});setLoginLoading(true);axios.post(AUTH_LOGIN,payload).then(function(res){return res.data;}).then(function(result){if(result.status_code===200){setUserToken(result.result);setLoginLoading(false);}}).catch(function(err){var _err$response,_err$response$data;setLoginLoading(false);if((err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.code)===404){setHasError('کاربری با این مشخصات پیدا نشد');}else{setHasError('خطایی رخ داده است');}console.log(err);});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"container-fluid\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"row justify-content-center mt-5 pt-5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6 text-center text-success mt-5 \",children:\"COMPANY LOGO\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"row justify-content-center mt-1 py-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 text-center login-card p-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"login-header text-bold text-right\",children:\"\\u0648\\u0631\\u0648\\u062F \\u0628\\u0647 \\u067E\\u0646\\u0644 \\u0627\\u062F\\u0645\\u06CC\\u0646\"}),/*#__PURE__*/_jsx(\"div\",{className:\"pt-3 pb-5 mx-auto\",children:refreshLoading?/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex my-5 py-4 flex-column justify-content-between align-items-center\",children:[/*#__PURE__*/_jsx(CircularProgress,{}),/*#__PURE__*/_jsx(\"span\",{className:\"mt-4 text-white\",children:\"...\\u062F\\u0631 \\u062D\\u0627\\u0644 \\u0627\\u0639\\u062A\\u0628\\u0627\\u0631 \\u0633\\u0646\\u062C\\u06CC\"})]}):/*#__PURE__*/_jsx(Formik,{initialValues:{input:'',password:''},enableReinitialize:true// validate={this.validate}\n,onSubmit:handleSubmit,children:/*#__PURE__*/_jsx(Form,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-bold font-gray-color px-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 d-flex flex-column\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-end text-white\",htmlFor:\"input\",children:\"\\u0646\\u0627\\u0645 \\u06A9\\u0627\\u0631\\u0628\\u0631\\u06CC\"}),/*#__PURE__*/_jsx(Field,{type:\"text\",name:\"input\",placeholder:\"\",required:true,className:\"form-control bg_input input_text\",style:{borderRadius:\"15px\"}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 mb-2 d-flex flex-column\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-end text-white\",htmlFor:\"password\",children:\"\\u0631\\u0645\\u0632\\u0639\\u0628\\u0648\\u0631\"}),/*#__PURE__*/_jsx(Field,{type:\"password\",name:\"password\",required:true,placeholder:\"\",className:\"form-control bg_input input_text\",style:{borderRadius:\"15px\"}})]}),Boolean(hasError)&&/*#__PURE__*/_jsx(\"p\",{className:\"text-danger\",children:hasError}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 pt-3\",children:/*#__PURE__*/_jsxs(Button,{disabled:loginLoading,variant:\"contained\",type:\"submit\",fullWidth:true,style:{borderRadius:\"15px\"},color:\"primary\",children:[\"\\u0648\\u0631\\u0648\\u062F\",loginLoading&&/*#__PURE__*/_jsx(CircularProgress,{size:24,className:\"position-absolute\"})]})})]})})})})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-100\",children:/*#__PURE__*/_jsx(\"div\",{className:\"back-ground-pic\"})})]});}export default Login;","map":{"version":3,"sources":["/Users/yasaman/Documents/moj_adminpanel/adminpanel/src/components/login/index.js"],"names":["React","Field","Formik","Form","axios","Button","CircularProgress","AUTH_REFRESH","AUTH_LOGIN","RefreshToken","removeToken","setToken","useHistory","UserContext","Login","props","contextData","useContext","history","useState","loginLoading","setLoginLoading","refreshLoading","setRefreshLoading","hasError","setHasError","setUserToken","values","setIsLoggedIn","setTimeout","push","checkUserRefreshToken","refreshToken","payload","token","post","then","res","data","result","status_code","catch","err","console","log","useEffect","handleSubmit","user_agent","window","navigator","userAgent","client_host","response","code","input","password","borderRadius","Boolean"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport \"./style.css\";\n\nimport { Field, Formik, Form } from \"formik\";\n\nimport axios from \"axios\";\n\nimport { Button, CircularProgress } from \"@material-ui/core\";\n\nimport { AUTH_REFRESH, AUTH_LOGIN } from \"../../utils/constants\";\n\n// import { useFetchApi } from '../../utils/hooks';\n\nimport { RefreshToken, removeToken, setToken } from '../../utils/utils';\n\nimport { useHistory } from 'react-router-dom';\n\nimport { UserContext } from '../../context/provider';\n\n\n\n\n\nfunction Login(props) {\n\n\n\n    const contextData = React.useContext(UserContext);\n\n\n\n    const history = useHistory();\n\n\n\n    const [loginLoading, setLoginLoading] = React.useState(false);\n\n    const [refreshLoading, setRefreshLoading] = React.useState(true);\n\n    const [hasError, setHasError] = React.useState('')\n\n\n\n    const setUserToken = (values) => {\n\n        setToken(values)\n\n        contextData.setIsLoggedIn(true)\n\n        setTimeout(() => history.push('/users'), 1000)\n\n    }\n\n\n\n    const checkUserRefreshToken = (refreshToken) => {\n\n        let payload = { token: refreshToken }\n\n        axios.post(AUTH_REFRESH, payload)\n\n            .then(res => res.data)\n\n            .then(result => {\n\n                if (result.status_code === 200) {\n\n                    setUserToken(result.result)\n\n                }\n\n            })\n\n            .catch(err => {\n\n                console.log(err)\n\n                setRefreshLoading(false)\n\n                removeToken()\n\n                contextData.setIsLoggedIn(false)\n\n            })\n\n    }\n\n\n\n    React.useEffect(() => {\n\n        let refreshToken = RefreshToken();\n\n        if (refreshToken) {\n\n            checkUserRefreshToken(refreshToken)\n\n        } else {\n\n            setRefreshLoading(false)\n\n        }\n\n    }, [])\n\n\n\n    const handleSubmit = (values) => {\n\n        setHasError('')\n\n        let payload = {\n\n            ...values,\n\n            user_agent: window.navigator.userAgent,\n\n            client_host: \"local\"\n\n        }\n\n        setLoginLoading(true)\n\n        axios.post(AUTH_LOGIN, payload)\n\n            .then(res => res.data)\n\n            .then(result => {\n\n                if (result.status_code === 200) {\n\n                    setUserToken(result.result)\n\n                    setLoginLoading(false)\n\n                }\n\n            })\n\n            .catch(err => {\n\n                setLoginLoading(false)\n\n                if (err?.response?.data?.code === 404) {\n\n                    setHasError('کاربری با این مشخصات پیدا نشد')\n\n                } else {\n\n                    setHasError('خطایی رخ داده است')\n\n                }\n\n                console.log(err)\n\n            })\n\n    }\n\n\n\n    return (\n\n        <>\n\n            <div className=\"container-fluid\">\n\n                <div className=\"row justify-content-center mt-5 pt-5\">\n\n                    <div className=\"col-md-6 text-center text-success mt-5 \">\n\n                        COMPANY LOGO\n\n                    </div>\n\n                </div>\n\n                <div className=\"row justify-content-center mt-1 py-5\">\n\n                    <div className=\"col-md-6 text-center login-card p-0\">\n\n                        <div className=\"login-header text-bold text-right\">\n\n                            ورود به پنل ادمین\n\n                        </div>\n\n                        <div className=\"pt-3 pb-5 mx-auto\">\n\n                            {\n\n                                refreshLoading ? (\n\n                                    <div className=\"d-flex my-5 py-4 flex-column justify-content-between align-items-center\" >\n\n                                        <CircularProgress />\n\n                                        <span className=\"mt-4 text-white\">...در حال اعتبار سنجی</span>\n\n                                    </div>\n\n                                ) : (\n\n                                    <Formik\n\n                                        initialValues={{ input: '', password: '' }}\n\n                                        enableReinitialize={true}\n\n                                        // validate={this.validate}\n\n                                        onSubmit={handleSubmit}\n\n                                    >\n\n                                        <Form>\n\n                                            <div className=\"text-bold font-gray-color px-5\">\n\n                                                <div className=\"mt-3 d-flex flex-column\">\n\n                                                    <label className=\"text-end text-white\" htmlFor=\"input\">نام کاربری</label>\n\n                                                    <Field\n\n                                                        type=\"text\"\n\n                                                        name=\"input\"\n\n                                                        placeholder=\"\"\n\n                                                        required\n\n                                                        className=\"form-control bg_input input_text\"\n\n                                                        style={{ borderRadius: \"15px\" }}\n\n                                                    />\n\n                                                </div>\n\n                                                <div className=\"mt-3 mb-2 d-flex flex-column\">\n\n                                                    <label className=\"text-end text-white\" htmlFor=\"password\">رمزعبور</label>\n\n                                                    <Field\n\n                                                        type=\"password\"\n\n                                                        name=\"password\"\n\n                                                        required\n\n                                                        placeholder=\"\"\n\n                                                        className=\"form-control bg_input input_text\"\n\n                                                        style={{ borderRadius: \"15px\" }}\n\n                                                    />\n\n                                                </div>\n\n                                                {Boolean(hasError) && <p className=\"text-danger\">{hasError}</p>}\n\n                                                <div className=\"mt-4 pt-3\">\n\n                                                    <Button disabled={loginLoading} variant=\"contained\" type=\"submit\" fullWidth style={{ borderRadius: \"15px\" }} color=\"primary\" >\n\n                                                        ورود\n\n                                                        {loginLoading && <CircularProgress size={24} className=\"position-absolute\" />}\n\n                                                    </Button>\n\n                                                </div>\n\n                                            </div>\n\n                                        </Form>\n\n                                    </Formik>\n\n                                )\n\n                            }\n\n                        </div>\n\n                    </div>\n\n                </div>\n\n            </div>\n\n            <div className=\"w-100\">\n\n                <div className=\"back-ground-pic\" ></div>\n\n            </div>\n\n        </>\n\n    )\n\n}\n\n\n\nexport default Login\n\n"]},"metadata":{},"sourceType":"module"}