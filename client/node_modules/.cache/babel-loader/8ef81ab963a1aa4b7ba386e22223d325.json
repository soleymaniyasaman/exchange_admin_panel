{"ast":null,"code":"import * as CONSTANT from './../base/constant';\nimport { extend } from '@syncfusion/ej2-base';\nimport * as EVENTS from './../../common/constant';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\n/**\n * Lists internal component\n *\n * @hidden\n */\n\nvar MDLists =\n/** @class */\nfunction () {\n  /**\n   * Constructor for creating the Lists plugin\n   *\n   * @param {IMDFormats} options - specifies the options\n   * @hidden\n   */\n  function MDLists(options) {\n    extend(this, this, options, true);\n    this.selection = this.parent.markdownSelection;\n    this.addEventListener();\n  }\n\n  MDLists.prototype.addEventListener = function () {\n    this.parent.observer.on(CONSTANT.LISTS_COMMAND, this.applyListsHandler, this);\n    this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.keyDownHandler, this);\n    this.parent.observer.on(EVENTS.KEY_UP_HANDLER, this.keyUpHandler, this);\n  };\n\n  MDLists.prototype.keyDownHandler = function (event) {\n    switch (event.event.which) {\n      case 9:\n        this.tabKey(event);\n        break;\n    }\n\n    switch (event.event.action) {\n      case 'ordered-list':\n        this.applyListsHandler({\n          subCommand: 'OL',\n          callBack: event.callBack\n        });\n        event.event.preventDefault();\n        break;\n\n      case 'unordered-list':\n        this.applyListsHandler({\n          subCommand: 'UL',\n          callBack: event.callBack\n        });\n        event.event.preventDefault();\n        break;\n    }\n  };\n\n  MDLists.prototype.keyUpHandler = function (event) {\n    switch (event.event.which) {\n      case 13:\n        this.enterKey(event);\n        break;\n    }\n  };\n\n  MDLists.prototype.tabKey = function (event) {\n    var textArea = this.parent.element;\n    this.selection.save(textArea.selectionStart, textArea.selectionEnd);\n    var start = textArea.selectionStart;\n    var end = textArea.selectionEnd;\n    var parents = this.selection.getSelectedParentPoints(textArea);\n    var addedLength = 0;\n    var isNotFirst = this.isNotFirstLine(textArea, parents[0]);\n\n    if (!isNotFirst && !event.event.shiftKey) {\n      this.restore(textArea, start, end + addedLength, event);\n      return;\n    }\n\n    var listFormat = this.olListType();\n    var regex = this.getListRegex();\n    this.currentAction = this.getAction(parents[0].text);\n\n    for (var i = 0; i < parents.length; i++) {\n      var prevIndex = event.event.shiftKey ? parents[i].line - 1 : parents[i].line - 1;\n      var prevLine = this.selection.getLine(textArea, prevIndex);\n\n      if (prevLine && (!event.event.shiftKey && isNotFirst || event.event.shiftKey)) {\n        var prevLineSplit = prevLine.split('. ');\n        var tabSpace = '\\t';\n        var tabSpaceLength = event.event.shiftKey ? -tabSpace.length : tabSpace.length;\n        var splitTab = parents[i].text.split('\\t');\n\n        if (event.event.shiftKey && splitTab.length === 1) {\n          break;\n        }\n\n        if (this.currentAction === 'OL' && /^\\d+$/.test(prevLineSplit[0].trim()) && listFormat) {\n          event.event.preventDefault();\n          parents[i].text = event.event.shiftKey ? splitTab.splice(1, splitTab.length).join('\\t') : tabSpace + parents[i].text;\n          var curTabSpace = this.getTabSpace(parents[i].text);\n          var prevTabSpace = this.getTabSpace(prevLine);\n          var splitText = parents[i].text.split('. ');\n\n          if (curTabSpace === prevTabSpace) {\n            this.changeTextAreaValue(splitText, this.nextOrderedListValue(prevLineSplit[0].trim()), event, textArea, parents, i, end);\n          } else if (prevTabSpace < curTabSpace) {\n            this.changeTextAreaValue(splitText, '1. ', event, textArea, parents, i, end);\n          } else {\n            for (; prevTabSpace.length > curTabSpace.length; null) {\n              prevIndex = prevIndex - 1;\n              prevLine = this.selection.getLine(textArea, prevIndex);\n              var prevLineSplit_1 = prevLine.trim().split('. ');\n\n              if (/^\\d+$/.test(prevLineSplit_1[0])) {\n                prevTabSpace = this.getTabSpace(prevLine);\n\n                if (prevTabSpace.length <= curTabSpace.length) {\n                  this.changeTextAreaValue(splitText, this.nextOrderedListValue(prevLineSplit_1[0]), event, textArea, parents, i, end);\n                  break;\n                }\n              }\n            }\n          }\n        } else if (this.currentAction === 'UL' && regex.test(prevLine.trim()) || !listFormat) {\n          event.event.preventDefault();\n          parents[i].text = event.event.shiftKey ? splitTab.splice(1, splitTab.length).join('\\t') : tabSpace + parents[i].text;\n          textArea.value = textArea.value.substr(0, parents[i].start) + parents[i].text + '\\n' + textArea.value.substr(parents[i].end, textArea.value.length);\n        }\n\n        start = i === 0 ? start + tabSpaceLength : start;\n        addedLength += tabSpaceLength;\n\n        if (parents.length !== 1) {\n          for (var j = i; j < parents.length; j++) {\n            parents[j].start = j !== 0 ? parents[j].start + tabSpaceLength : parents[j].start;\n            parents[j].end = parents[j].end + tabSpaceLength;\n          }\n        }\n      }\n    }\n\n    this.restore(textArea, start, end + addedLength, event);\n  };\n\n  MDLists.prototype.changeTextAreaValue = function (splitText, prefixValue, event, // eslint-disable-next-line\n  textArea, parents, k, end) {\n    var prefix = prefixValue;\n    splitText.splice(0, 1);\n    var textAreaLength = this.selection.getAllParents(textArea.value).length;\n    var changedList = '';\n    var curTabSpace = this.getTabSpace(parents[k].text); // eslint-disable-next-line\n\n    var prefixNumber = parseInt(prefix.split('.')[0], null);\n    var nestedTabSpace = this.getTabSpace(parents[k].text);\n    var nestedlistorder = true;\n    var nestedListStart = true;\n    var curTabSpaceLength;\n    var nextPrefixValue = -1;\n    var traversIncreased = true;\n    var nextLineLength = 0;\n    var lineBreak = '';\n    changedList = this.selection.getLine(textArea, parents[0].line + 1) !== '' ? '' : changedList + textArea.value.substr(parents[0].end, textArea.value.length);\n\n    for (var i = 1; i < textAreaLength && !isNullOrUndefined(this.selection.getLine(textArea, parents[0].line + i)) && this.selection.getLine(textArea, parents[0].line + i) !== ''; i++) {\n      var nextLine = this.selection.getLine(textArea, parents[0].line + i);\n      var nextTabSpace = this.getTabSpace(nextLine);\n      var nextLineSplit = nextLine.split('. ');\n\n      if (nextLineSplit.length === 1) {\n        changedList += textArea.value.substr(parents[0].end + nextLineLength, textArea.value.length);\n        break;\n      } else {\n        nextLineLength += nextLine.length;\n        var shiftTabTargetList = false;\n        curTabSpaceLength = event.event.shiftKey ? curTabSpace.length + 1 : curTabSpace.length - 1;\n\n        if (nextTabSpace.length > nestedTabSpace.length) {\n          traversIncreased = false;\n        }\n\n        if (curTabSpace.length !== nextTabSpace.length && nextTabSpace.length < nestedTabSpace.length) {\n          nestedListStart = true;\n          nestedlistorder = false;\n          shiftTabTargetList = event.event.shiftKey && curTabSpace.length === nextTabSpace.length ? (nestedListStart = false, true) : false;\n        } else if (traversIncreased && event.event.shiftKey && curTabSpace.length === nextTabSpace.length && nextTabSpace.length === nestedTabSpace.length) {\n          nestedListStart = false;\n          shiftTabTargetList = true;\n        }\n\n        lineBreak = changedList === '' ? '' : '\\n';\n\n        if (curTabSpaceLength === nextTabSpace.length && nestedListStart) {\n          var nextPrefix = event.event.shiftKey ? (nextPrefixValue++, this.nextOrderedListValue(nextPrefixValue.toString())) : this.previousOrderedListValue(nextLineSplit[0]);\n          nextLineSplit.splice(0, 1);\n          changedList = changedList + lineBreak + nextTabSpace + nextPrefix + nextLineSplit.join('. ');\n        } else if (curTabSpace.length === nextTabSpace.length && nestedlistorder || shiftTabTargetList) {\n          var nextPrefix = this.nextOrderedListValue(prefixNumber.toString());\n          prefixNumber++;\n          nextLineSplit.splice(0, 1);\n          changedList = changedList + lineBreak + nextTabSpace + nextPrefix + nextLineSplit.join('. ');\n        } else {\n          changedList = changedList + lineBreak + nextLine;\n          nestedListStart = false;\n        }\n\n        nestedTabSpace = this.getTabSpace(nextLine);\n      }\n    }\n\n    parents[k].text = this.getTabSpace(parents[k].text) + prefix + splitText.join('. ') + '\\n';\n    textArea.value = textArea.value.substr(0, parents[k].start) + parents[k].text + changedList;\n  };\n\n  MDLists.prototype.getTabSpace = function (line) {\n    var split = line.split('\\t');\n    var tabs = '';\n\n    for (var i = 0; i < split.length; i++) {\n      if (split[i] === '') {\n        tabs += '\\t';\n      } else {\n        break;\n      }\n    }\n\n    return tabs;\n  };\n\n  MDLists.prototype.isNotFirstLine = function (textArea, points) {\n    var currentLine = points.text;\n    var prevIndex = points.line - 1;\n    var prevLine = this.selection.getLine(textArea, prevIndex);\n    var regex = this.getListRegex();\n    var isNotFirst = false;\n    var regexFirstCondition;\n\n    if (prevLine) {\n      this.currentAction = this.getAction(prevLine);\n      var prevLineSplit = prevLine.split('. ');\n      regexFirstCondition = this.currentAction === 'OL' ? /^\\d+$/.test(prevLineSplit[0].trim()) : regex.test(prevLine.trim());\n    }\n\n    if (prevLine && regexFirstCondition) {\n      var curTabSpace = this.getTabSpace(currentLine);\n      var prevTabSpace = this.getTabSpace(prevLine);\n      isNotFirst = curTabSpace === prevTabSpace ? true : isNotFirst;\n\n      for (; prevTabSpace.length > curTabSpace.length; null) {\n        prevIndex = prevIndex - 1;\n        prevLine = this.selection.getLine(textArea, prevIndex);\n        var prevLineSplit = prevLine.trim().split('. ');\n        var regexSecondCondition = this.currentAction === 'OL' ? /^\\d+$/.test(prevLineSplit[0]) : regex.test(prevLine.trim());\n\n        if (regexSecondCondition) {\n          prevTabSpace = this.getTabSpace(prevLine);\n\n          if (prevTabSpace.length <= curTabSpace.length) {\n            isNotFirst = true;\n            break;\n          }\n        }\n      }\n    }\n\n    return isNotFirst;\n  };\n\n  MDLists.prototype.getAction = function (line) {\n    var ol = line.split('. ')[0]; // eslint-disable-next-line\n\n    var currentState = /^\\d+$/.test(ol.trim());\n    var ul = line.trim().split(new RegExp('^(' + this.selection.replaceSpecialChar(this.syntax.UL).trim() + ')'))[1];\n    return currentState ? 'OL' : ul ? 'UL' : 'NOTLIST';\n  };\n\n  MDLists.prototype.nextOrderedListValue = function (previousLine) {\n    // eslint-disable-next-line\n    var currentValue = parseInt(previousLine, null);\n    var nextValue = currentValue + 1;\n    return nextValue.toString() + '. ';\n  };\n\n  MDLists.prototype.previousOrderedListValue = function (previousLine) {\n    // eslint-disable-next-line\n    var currentValue = parseInt(previousLine, null);\n    var nextValue = currentValue - 1;\n    return nextValue.toString() + '. ';\n  };\n\n  MDLists.prototype.enterKey = function (event) {\n    var textArea = this.parent.element;\n    this.selection.save(textArea.selectionStart, textArea.selectionEnd);\n    var start = textArea.selectionStart;\n    var end = textArea.selectionEnd;\n    var parents = this.selection.getSelectedParentPoints(textArea);\n    var prevLine = this.selection.getLine(textArea, parents[0].line - 1);\n    var listFormat = this.olListType();\n    var regex = this.getListRegex();\n    var prevLineSplit = [];\n\n    if (!isNullOrUndefined(prevLine)) {\n      prevLineSplit = prevLine.split('. ');\n      this.currentAction = this.getAction(prevLine);\n    }\n\n    var addedLength = 0;\n\n    if (this.currentAction === 'OL' && prevLineSplit.length > 1 && /^\\d+$/.test(prevLineSplit[0].trim()) && listFormat && prevLineSplit[1] !== '') {\n      var tabSpace = this.getTabSpace(prevLine);\n      this.currentAction = this.getAction(prevLine);\n      var prefix = this.nextOrderedListValue(prevLineSplit[0]);\n      parents[0].text = tabSpace + prefix + parents[0].text;\n      var textAreaLength = this.selection.getAllParents(textArea.value).length;\n      var changedList = '\\n';\n      var curTabSpace = this.getTabSpace(prevLine);\n      var nestedTabSpace = this.getTabSpace(parents[0].text);\n      var nestedListOrder = true;\n\n      for (var i = 1; i < textAreaLength && textArea.value.substr(parents[0].end, textArea.value.length) !== ''; i++) {\n        var nextLine = this.selection.getLine(textArea, parents[0].line + i);\n\n        if (isNullOrUndefined(nextLine)) {\n          changedList = changedList + '';\n        } else {\n          var nextLineSplit = nextLine.split('. ');\n          var nextTabSpace = this.getTabSpace(nextLine);\n\n          if (nextTabSpace.length < nestedTabSpace.length) {\n            nestedListOrder = false;\n          }\n\n          if (nextLineSplit.length > 1 && /^\\d+$/.test(nextLineSplit[0].trim()) && curTabSpace.length === nextTabSpace.length && nestedListOrder) {\n            var nextPrefix = this.nextOrderedListValue(nextLineSplit[0]);\n            nextLineSplit.splice(0, 1);\n            changedList = changedList + nextTabSpace + nextPrefix + nextLineSplit.join('. ') + '\\n';\n          } else {\n            changedList = changedList + nextLine + '\\n';\n            nestedTabSpace = this.getTabSpace(nextLine);\n          }\n        }\n      }\n\n      textArea.value = textArea.value.substr(0, parents[0].start) + curTabSpace + prefix + this.selection.getLine(textArea, parents[0].line) + changedList;\n      start = start + prefix.length + tabSpace.length;\n      addedLength += prefix.length + tabSpace.length;\n    } else if (this.currentAction === 'UL' && prevLine && regex.test(prevLine.trim()) && prevLine.trim().replace(regex, '') !== '' || this.currentAction === 'OL' && !listFormat) {\n      var tabSpace = this.getTabSpace(prevLine);\n      var prefix = this.syntax[this.currentAction];\n      parents[0].text = tabSpace + prefix + parents[0].text + (parents[0].text.trim().length > 0 ? '\\n' : '');\n      textArea.value = textArea.value.substr(0, parents[0].start) + parents[0].text + textArea.value.substr(parents[0].end, textArea.value.length);\n      start = start + prefix.length + tabSpace.length;\n      addedLength += prefix.length + tabSpace.length;\n    }\n\n    this.restore(textArea, start, end + addedLength, event);\n  };\n\n  MDLists.prototype.olListType = function () {\n    var olSyntaxList = this.syntax.OL.split('.,');\n    var listType = olSyntaxList.length === 1 ? null : // eslint-disable-next-line\n    parseInt(olSyntaxList[2].trim(), null) - parseInt(olSyntaxList[0].trim(), null);\n\n    if (listType) {\n      return 1;\n    } else {\n      return 0;\n    }\n  };\n\n  MDLists.prototype.applyListsHandler = function (e) {\n    var textArea = this.parent.element;\n    this.selection.save(textArea.selectionStart, textArea.selectionEnd);\n    this.currentAction = e.subCommand;\n    var start = textArea.selectionStart;\n    var end = textArea.selectionEnd;\n    var addedLength = 0;\n    var startLength = 0;\n    var endLength = 0;\n    var parents = this.selection.getSelectedParentPoints(textArea);\n    var prefix = '';\n    var listFormat = this.olListType();\n    var regex;\n    var perfixObj = {};\n\n    for (var i = 0; i < parents.length; i++) {\n      if (listFormat) {\n        regex = this.currentAction === 'OL' ? i + listFormat + '. ' : this.syntax[this.currentAction];\n      } else {\n        regex = this.currentAction === 'OL' ? this.syntax.OL : this.syntax[this.currentAction];\n      }\n\n      if (!this.selection.isStartWith(parents[i].text, regex)) {\n        if (parents[i].text === '' && i === 0) {\n          this.selection.save(start, end);\n\n          if (parents.length !== 1) {\n            for (var j = i; j < parents.length; j++) {\n              parents[j].start = j !== 0 ? 1 + parents[j].start : parents[j].start;\n              parents[j].end = 1 + parents[j].end;\n            }\n          }\n        }\n\n        var preLineTabSpaceLength = !isNullOrUndefined(parents[i - 1]) ? this.getTabSpace(parents[i - 1].text).length : 0;\n        var replace = this.appliedLine(parents[i].text, regex, perfixObj, preLineTabSpaceLength);\n        prefix = replace.line ? prefix : regex;\n        parents[i].text = replace.line ? replace.line : prefix + parents[i].text;\n        replace.space = replace.space ? replace.space : 0;\n        textArea.value = textArea.value.substr(0, parents[i].start + endLength) + parents[i].text + '\\n' + textArea.value.substr(parents[i].end, textArea.value.length);\n        start = i === 0 ? start + prefix.length + replace.space > 0 ? start + prefix.length + replace.space : 0 : start;\n        addedLength += prefix.length + replace.space;\n\n        if (parents.length !== 1) {\n          for (var j = i; j < parents.length; j++) {\n            parents[j].start = j !== 0 ? prefix.length + parents[j].start + replace.space : parents[j].start;\n            parents[j].end = prefix.length + parents[j].end + replace.space;\n          }\n        }\n\n        this.restore(textArea, start, end + addedLength, null);\n      } else {\n        parents[i].text = parents[i].text.replace(regex, '');\n        textArea.value = textArea.value.substr(0, parents[i].start + endLength) + parents[i].text + '\\n' + textArea.value.substr(parents[i].end + endLength, textArea.value.length);\n        endLength -= regex.length;\n        startLength = regex.length;\n        this.restore(textArea, start - startLength, end + endLength, null);\n      }\n    }\n\n    this.restore(textArea, null, null, e);\n  };\n\n  MDLists.prototype.appliedLine = function (line, prefixPattern, perfixObj, preTabSpaceLength) {\n    var points = {};\n    var regex = new RegExp('^[' + this.syntax.UL.trim() + ']');\n    var lineSplit = line.split('. ');\n    var currentPrefix = lineSplit[0] + '. ';\n    var isExist = regex.test(line.trim()) || line.trim() === this.syntax.OL.trim() || line.trim() === this.syntax.UL.trim() || /^\\d+$/.test(lineSplit[0].trim());\n    var listFormat = this.olListType();\n    var curTabSpaceLength = this.getTabSpace(line).length;\n\n    if (this.currentAction === 'OL' && listFormat) {\n      perfixObj[curTabSpaceLength.toString()] = !isNullOrUndefined(perfixObj[curTabSpaceLength.toString()]) ? perfixObj[curTabSpaceLength.toString()].valueOf() + 1 : 1;\n      prefixPattern = perfixObj[curTabSpaceLength.toString()].valueOf().toString() + '. ';\n\n      if (!isNullOrUndefined(preTabSpaceLength) && preTabSpaceLength > curTabSpaceLength) {\n        perfixObj[preTabSpaceLength.toString()] = 0;\n      }\n    }\n\n    if (isExist) {\n      var replace = void 0;\n      var pattern = void 0; // eslint-disable-next-line\n\n      var space = 0;\n\n      if (regex.test(line.trim())) {\n        pattern = this.syntax.UL;\n        replace = prefixPattern;\n        points.space = prefixPattern.trim().length - this.syntax.UL.trim().length;\n      } else if (/^\\d+$/.test(lineSplit[0].trim()) && listFormat) {\n        pattern = lineSplit[0].trim() + '. ';\n        replace = prefixPattern;\n        points.space = this.syntax.UL.trim().length - currentPrefix.trim().length;\n      } else if (/^\\d+$/.test(lineSplit[0].trim())) {\n        pattern = lineSplit[0].trim() + '. ';\n        replace = this.syntax.UL;\n        points.space = this.syntax.UL.trim().length - currentPrefix.trim().length;\n      }\n\n      points.line = line.replace(pattern, replace);\n    }\n\n    return points;\n  };\n\n  MDLists.prototype.restore = function (textArea, start, end, event) {\n    if (!isNullOrUndefined(start) && !isNullOrUndefined(start)) {\n      this.selection.save(start, end);\n    }\n\n    if (!isNullOrUndefined(event)) {\n      this.selection.restore(textArea);\n    }\n\n    if (event && event.callBack) {\n      event.callBack({\n        requestType: this.currentAction,\n        selectedText: this.selection.getSelectedText(textArea),\n        editorMode: 'Markdown',\n        event: event.event\n      });\n    }\n  };\n\n  MDLists.prototype.getListRegex = function () {\n    var regex = '';\n    var configKey = Object.keys(this.syntax);\n\n    for (var j = 0; j < configKey.length; j++) {\n      var syntax = this.selection.replaceSpecialChar(this.syntax[configKey[j]]);\n      regex += regex === '' ? '^(' + syntax + ')|^(' + syntax.trim() + ')' : '|^(' + syntax + ')|^(' + syntax.trim() + ')';\n    }\n\n    return new RegExp(regex);\n  };\n\n  return MDLists;\n}();\n\nexport { MDLists };","map":{"version":3,"sources":["/Users/yasaman/Documents/moj_adminpanel/adminpanel/node_modules/@syncfusion/ej2-richtexteditor/src/markdown-parser/plugin/lists.js"],"names":["CONSTANT","extend","EVENTS","isNullOrUndefined","MDLists","options","selection","parent","markdownSelection","addEventListener","prototype","observer","on","LISTS_COMMAND","applyListsHandler","KEY_DOWN_HANDLER","keyDownHandler","KEY_UP_HANDLER","keyUpHandler","event","which","tabKey","action","subCommand","callBack","preventDefault","enterKey","textArea","element","save","selectionStart","selectionEnd","start","end","parents","getSelectedParentPoints","addedLength","isNotFirst","isNotFirstLine","shiftKey","restore","listFormat","olListType","regex","getListRegex","currentAction","getAction","text","i","length","prevIndex","line","prevLine","getLine","prevLineSplit","split","tabSpace","tabSpaceLength","splitTab","test","trim","splice","join","curTabSpace","getTabSpace","prevTabSpace","splitText","changeTextAreaValue","nextOrderedListValue","prevLineSplit_1","value","substr","j","prefixValue","k","prefix","textAreaLength","getAllParents","changedList","prefixNumber","parseInt","nestedTabSpace","nestedlistorder","nestedListStart","curTabSpaceLength","nextPrefixValue","traversIncreased","nextLineLength","lineBreak","nextLine","nextTabSpace","nextLineSplit","shiftTabTargetList","nextPrefix","toString","previousOrderedListValue","tabs","points","currentLine","regexFirstCondition","regexSecondCondition","ol","currentState","ul","RegExp","replaceSpecialChar","syntax","UL","previousLine","currentValue","nextValue","nestedListOrder","replace","olSyntaxList","OL","listType","e","startLength","endLength","perfixObj","isStartWith","preLineTabSpaceLength","appliedLine","space","prefixPattern","preTabSpaceLength","lineSplit","currentPrefix","isExist","valueOf","pattern","requestType","selectedText","getSelectedText","editorMode","configKey","Object","keys"],"mappings":"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","sourcesContent":["import * as CONSTANT from './../base/constant';\nimport { extend } from '@syncfusion/ej2-base';\nimport * as EVENTS from './../../common/constant';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\n/**\n * Lists internal component\n *\n * @hidden\n */\nvar MDLists = /** @class */ (function () {\n    /**\n     * Constructor for creating the Lists plugin\n     *\n     * @param {IMDFormats} options - specifies the options\n     * @hidden\n     */\n    function MDLists(options) {\n        extend(this, this, options, true);\n        this.selection = this.parent.markdownSelection;\n        this.addEventListener();\n    }\n    MDLists.prototype.addEventListener = function () {\n        this.parent.observer.on(CONSTANT.LISTS_COMMAND, this.applyListsHandler, this);\n        this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.keyDownHandler, this);\n        this.parent.observer.on(EVENTS.KEY_UP_HANDLER, this.keyUpHandler, this);\n    };\n    MDLists.prototype.keyDownHandler = function (event) {\n        switch (event.event.which) {\n            case 9:\n                this.tabKey(event);\n                break;\n        }\n        switch (event.event.action) {\n            case 'ordered-list':\n                this.applyListsHandler({ subCommand: 'OL', callBack: event.callBack });\n                event.event.preventDefault();\n                break;\n            case 'unordered-list':\n                this.applyListsHandler({ subCommand: 'UL', callBack: event.callBack });\n                event.event.preventDefault();\n                break;\n        }\n    };\n    MDLists.prototype.keyUpHandler = function (event) {\n        switch (event.event.which) {\n            case 13:\n                this.enterKey(event);\n                break;\n        }\n    };\n    MDLists.prototype.tabKey = function (event) {\n        var textArea = this.parent.element;\n        this.selection.save(textArea.selectionStart, textArea.selectionEnd);\n        var start = textArea.selectionStart;\n        var end = textArea.selectionEnd;\n        var parents = this.selection.getSelectedParentPoints(textArea);\n        var addedLength = 0;\n        var isNotFirst = this.isNotFirstLine(textArea, parents[0]);\n        if (!isNotFirst && !event.event.shiftKey) {\n            this.restore(textArea, start, end + addedLength, event);\n            return;\n        }\n        var listFormat = this.olListType();\n        var regex = this.getListRegex();\n        this.currentAction = this.getAction(parents[0].text);\n        for (var i = 0; i < parents.length; i++) {\n            var prevIndex = event.event.shiftKey ? parents[i].line - 1 : parents[i].line - 1;\n            var prevLine = this.selection.getLine(textArea, prevIndex);\n            if (prevLine && (!event.event.shiftKey && isNotFirst || (event.event.shiftKey))) {\n                var prevLineSplit = prevLine.split('. ');\n                var tabSpace = '\\t';\n                var tabSpaceLength = event.event.shiftKey ? -tabSpace.length : tabSpace.length;\n                var splitTab = parents[i].text.split('\\t');\n                if (event.event.shiftKey && splitTab.length === 1) {\n                    break;\n                }\n                if (this.currentAction === 'OL' && /^\\d+$/.test(prevLineSplit[0].trim()) && listFormat) {\n                    event.event.preventDefault();\n                    parents[i].text = event.event.shiftKey ? splitTab.splice(1, splitTab.length).join('\\t') : tabSpace + parents[i].text;\n                    var curTabSpace = this.getTabSpace(parents[i].text);\n                    var prevTabSpace = this.getTabSpace(prevLine);\n                    var splitText = parents[i].text.split('. ');\n                    if (curTabSpace === prevTabSpace) {\n                        this.changeTextAreaValue(splitText, this.nextOrderedListValue(prevLineSplit[0].trim()), event, textArea, parents, i, end);\n                    }\n                    else if (prevTabSpace < curTabSpace) {\n                        this.changeTextAreaValue(splitText, '1. ', event, textArea, parents, i, end);\n                    }\n                    else {\n                        for (; prevTabSpace.length > curTabSpace.length; null) {\n                            prevIndex = prevIndex - 1;\n                            prevLine = this.selection.getLine(textArea, prevIndex);\n                            var prevLineSplit_1 = prevLine.trim().split('. ');\n                            if (/^\\d+$/.test(prevLineSplit_1[0])) {\n                                prevTabSpace = this.getTabSpace(prevLine);\n                                if (prevTabSpace.length <= curTabSpace.length) {\n                                    this.changeTextAreaValue(splitText, this.nextOrderedListValue(prevLineSplit_1[0]), event, textArea, parents, i, end);\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                }\n                else if (this.currentAction === 'UL' && regex.test(prevLine.trim()) || !listFormat) {\n                    event.event.preventDefault();\n                    parents[i].text = event.event.shiftKey ? splitTab.splice(1, splitTab.length).join('\\t') : tabSpace + parents[i].text;\n                    textArea.value = textArea.value.substr(0, parents[i].start) + parents[i].text + '\\n' +\n                        textArea.value.substr(parents[i].end, textArea.value.length);\n                }\n                start = i === 0 ? start + tabSpaceLength : start;\n                addedLength += tabSpaceLength;\n                if (parents.length !== 1) {\n                    for (var j = i; j < parents.length; j++) {\n                        parents[j].start = j !== 0 ? parents[j].start + tabSpaceLength : parents[j].start;\n                        parents[j].end = parents[j].end + tabSpaceLength;\n                    }\n                }\n            }\n        }\n        this.restore(textArea, start, end + addedLength, event);\n    };\n    MDLists.prototype.changeTextAreaValue = function (splitText, prefixValue, event, \n    // eslint-disable-next-line\n    textArea, parents, k, end) {\n        var prefix = prefixValue;\n        splitText.splice(0, 1);\n        var textAreaLength = this.selection.getAllParents(textArea.value).length;\n        var changedList = '';\n        var curTabSpace = this.getTabSpace(parents[k].text);\n        // eslint-disable-next-line\n        var prefixNumber = parseInt(prefix.split('.')[0], null);\n        var nestedTabSpace = this.getTabSpace(parents[k].text);\n        var nestedlistorder = true;\n        var nestedListStart = true;\n        var curTabSpaceLength;\n        var nextPrefixValue = -1;\n        var traversIncreased = true;\n        var nextLineLength = 0;\n        var lineBreak = '';\n        changedList = (this.selection.getLine(textArea, parents[0].line + 1) !== '') ?\n            '' : changedList + textArea.value.substr(parents[0].end, textArea.value.length);\n        for (var i = 1; i < textAreaLength &&\n            !isNullOrUndefined(this.selection.getLine(textArea, parents[0].line + i))\n            && this.selection.getLine(textArea, parents[0].line + i) !== ''; i++) {\n            var nextLine = this.selection.getLine(textArea, parents[0].line + i);\n            var nextTabSpace = this.getTabSpace(nextLine);\n            var nextLineSplit = nextLine.split('. ');\n            if (nextLineSplit.length === 1) {\n                changedList += textArea.value.substr(parents[0].end + nextLineLength, textArea.value.length);\n                break;\n            }\n            else {\n                nextLineLength += nextLine.length;\n                var shiftTabTargetList = false;\n                curTabSpaceLength = event.event.shiftKey ? curTabSpace.length + 1 : curTabSpace.length - 1;\n                if (nextTabSpace.length > nestedTabSpace.length) {\n                    traversIncreased = false;\n                }\n                if (curTabSpace.length !== nextTabSpace.length && nextTabSpace.length < nestedTabSpace.length) {\n                    nestedListStart = true;\n                    nestedlistorder = false;\n                    shiftTabTargetList = event.event.shiftKey &&\n                        curTabSpace.length === nextTabSpace.length ? (nestedListStart = false, true) : false;\n                }\n                else if (traversIncreased && event.event.shiftKey &&\n                    curTabSpace.length === nextTabSpace.length && nextTabSpace.length === nestedTabSpace.length) {\n                    nestedListStart = false;\n                    shiftTabTargetList = true;\n                }\n                lineBreak = changedList === '' ? '' : '\\n';\n                if (curTabSpaceLength === nextTabSpace.length && nestedListStart) {\n                    var nextPrefix = event.event.shiftKey ?\n                        (nextPrefixValue++, this.nextOrderedListValue(nextPrefixValue.toString()))\n                        : this.previousOrderedListValue(nextLineSplit[0]);\n                    nextLineSplit.splice(0, 1);\n                    changedList = changedList + lineBreak + nextTabSpace + nextPrefix + nextLineSplit.join('. ');\n                }\n                else if (curTabSpace.length === nextTabSpace.length && nestedlistorder || shiftTabTargetList) {\n                    var nextPrefix = this.nextOrderedListValue(prefixNumber.toString());\n                    prefixNumber++;\n                    nextLineSplit.splice(0, 1);\n                    changedList = changedList + lineBreak + nextTabSpace + nextPrefix + nextLineSplit.join('. ');\n                }\n                else {\n                    changedList = changedList + lineBreak + nextLine;\n                    nestedListStart = false;\n                }\n                nestedTabSpace = this.getTabSpace(nextLine);\n            }\n        }\n        parents[k].text = this.getTabSpace(parents[k].text) + prefix + splitText.join('. ') + '\\n';\n        textArea.value = textArea.value.substr(0, parents[k].start) + parents[k].text + changedList;\n    };\n    MDLists.prototype.getTabSpace = function (line) {\n        var split = line.split('\\t');\n        var tabs = '';\n        for (var i = 0; i < split.length; i++) {\n            if (split[i] === '') {\n                tabs += '\\t';\n            }\n            else {\n                break;\n            }\n        }\n        return tabs;\n    };\n    MDLists.prototype.isNotFirstLine = function (textArea, points) {\n        var currentLine = points.text;\n        var prevIndex = points.line - 1;\n        var prevLine = this.selection.getLine(textArea, prevIndex);\n        var regex = this.getListRegex();\n        var isNotFirst = false;\n        var regexFirstCondition;\n        if (prevLine) {\n            this.currentAction = this.getAction(prevLine);\n            var prevLineSplit = prevLine.split('. ');\n            regexFirstCondition = this.currentAction === 'OL' ? /^\\d+$/.test(prevLineSplit[0].trim()) : regex.test(prevLine.trim());\n        }\n        if (prevLine && regexFirstCondition) {\n            var curTabSpace = this.getTabSpace(currentLine);\n            var prevTabSpace = this.getTabSpace(prevLine);\n            isNotFirst = curTabSpace === prevTabSpace ? true : isNotFirst;\n            for (; prevTabSpace.length > curTabSpace.length; null) {\n                prevIndex = prevIndex - 1;\n                prevLine = this.selection.getLine(textArea, prevIndex);\n                var prevLineSplit = prevLine.trim().split('. ');\n                var regexSecondCondition = this.currentAction === 'OL' ?\n                    /^\\d+$/.test(prevLineSplit[0]) : regex.test(prevLine.trim());\n                if (regexSecondCondition) {\n                    prevTabSpace = this.getTabSpace(prevLine);\n                    if (prevTabSpace.length <= curTabSpace.length) {\n                        isNotFirst = true;\n                        break;\n                    }\n                }\n            }\n        }\n        return isNotFirst;\n    };\n    MDLists.prototype.getAction = function (line) {\n        var ol = line.split('. ')[0];\n        // eslint-disable-next-line\n        var currentState = /^\\d+$/.test(ol.trim());\n        var ul = line.trim().split(new RegExp('^(' + this.selection.replaceSpecialChar(this.syntax.UL).trim() + ')'))[1];\n        return (currentState ? 'OL' : ul ? 'UL' : 'NOTLIST');\n    };\n    MDLists.prototype.nextOrderedListValue = function (previousLine) {\n        // eslint-disable-next-line\n        var currentValue = parseInt(previousLine, null);\n        var nextValue = currentValue + 1;\n        return nextValue.toString() + '. ';\n    };\n    MDLists.prototype.previousOrderedListValue = function (previousLine) {\n        // eslint-disable-next-line\n        var currentValue = parseInt(previousLine, null);\n        var nextValue = currentValue - 1;\n        return nextValue.toString() + '. ';\n    };\n    MDLists.prototype.enterKey = function (event) {\n        var textArea = this.parent.element;\n        this.selection.save(textArea.selectionStart, textArea.selectionEnd);\n        var start = textArea.selectionStart;\n        var end = textArea.selectionEnd;\n        var parents = this.selection.getSelectedParentPoints(textArea);\n        var prevLine = this.selection.getLine(textArea, parents[0].line - 1);\n        var listFormat = this.olListType();\n        var regex = this.getListRegex();\n        var prevLineSplit = [];\n        if (!isNullOrUndefined(prevLine)) {\n            prevLineSplit = prevLine.split('. ');\n            this.currentAction = this.getAction(prevLine);\n        }\n        var addedLength = 0;\n        if (this.currentAction === 'OL' && prevLineSplit.length > 1 && /^\\d+$/.test(prevLineSplit[0].trim()) && listFormat\n            && prevLineSplit[1] !== '') {\n            var tabSpace = this.getTabSpace(prevLine);\n            this.currentAction = this.getAction(prevLine);\n            var prefix = this.nextOrderedListValue(prevLineSplit[0]);\n            parents[0].text = tabSpace + prefix + parents[0].text;\n            var textAreaLength = this.selection.getAllParents(textArea.value).length;\n            var changedList = '\\n';\n            var curTabSpace = this.getTabSpace(prevLine);\n            var nestedTabSpace = this.getTabSpace(parents[0].text);\n            var nestedListOrder = true;\n            for (var i = 1; i < textAreaLength &&\n                textArea.value.substr(parents[0].end, textArea.value.length) !== ''; i++) {\n                var nextLine = this.selection.getLine(textArea, parents[0].line + i);\n                if (isNullOrUndefined(nextLine)) {\n                    changedList = changedList + '';\n                }\n                else {\n                    var nextLineSplit = nextLine.split('. ');\n                    var nextTabSpace = this.getTabSpace(nextLine);\n                    if (nextTabSpace.length < nestedTabSpace.length) {\n                        nestedListOrder = false;\n                    }\n                    if (nextLineSplit.length > 1 && /^\\d+$/.test(nextLineSplit[0].trim()) &&\n                        curTabSpace.length === nextTabSpace.length && nestedListOrder) {\n                        var nextPrefix = this.nextOrderedListValue(nextLineSplit[0]);\n                        nextLineSplit.splice(0, 1);\n                        changedList = changedList + nextTabSpace + nextPrefix + nextLineSplit.join('. ') + '\\n';\n                    }\n                    else {\n                        changedList = changedList + nextLine + '\\n';\n                        nestedTabSpace = this.getTabSpace(nextLine);\n                    }\n                }\n            }\n            textArea.value = textArea.value.substr(0, parents[0].start) + curTabSpace +\n                prefix + this.selection.getLine(textArea, parents[0].line) + changedList;\n            start = start + prefix.length + tabSpace.length;\n            addedLength += prefix.length + tabSpace.length;\n        }\n        else if (this.currentAction === 'UL' && (prevLine && regex.test(prevLine.trim())) &&\n            prevLine.trim().replace(regex, '') !== '' || this.currentAction === 'OL' && !listFormat) {\n            var tabSpace = this.getTabSpace(prevLine);\n            var prefix = this.syntax[this.currentAction];\n            parents[0].text = tabSpace + prefix + parents[0].text +\n                (parents[0].text.trim().length > 0 ? '\\n' : '');\n            textArea.value = textArea.value.substr(0, parents[0].start) + parents[0].text +\n                textArea.value.substr(parents[0].end, textArea.value.length);\n            start = start + prefix.length + tabSpace.length;\n            addedLength += prefix.length + tabSpace.length;\n        }\n        this.restore(textArea, start, end + addedLength, event);\n    };\n    MDLists.prototype.olListType = function () {\n        var olSyntaxList = this.syntax.OL.split('.,');\n        var listType = olSyntaxList.length === 1 ? null :\n            // eslint-disable-next-line\n            parseInt(olSyntaxList[2].trim(), null) - parseInt(olSyntaxList[0].trim(), null);\n        if (listType) {\n            return 1;\n        }\n        else {\n            return 0;\n        }\n    };\n    MDLists.prototype.applyListsHandler = function (e) {\n        var textArea = this.parent.element;\n        this.selection.save(textArea.selectionStart, textArea.selectionEnd);\n        this.currentAction = e.subCommand;\n        var start = textArea.selectionStart;\n        var end = textArea.selectionEnd;\n        var addedLength = 0;\n        var startLength = 0;\n        var endLength = 0;\n        var parents = this.selection.getSelectedParentPoints(textArea);\n        var prefix = '';\n        var listFormat = this.olListType();\n        var regex;\n        var perfixObj = {};\n        for (var i = 0; i < parents.length; i++) {\n            if (listFormat) {\n                regex = this.currentAction === 'OL' ? i + listFormat + '. ' : this.syntax[this.currentAction];\n            }\n            else {\n                regex = this.currentAction === 'OL' ? this.syntax.OL : this.syntax[this.currentAction];\n            }\n            if (!this.selection.isStartWith(parents[i].text, regex)) {\n                if (parents[i].text === '' && i === 0) {\n                    this.selection.save(start, end);\n                    if (parents.length !== 1) {\n                        for (var j = i; j < parents.length; j++) {\n                            parents[j].start = j !== 0 ? 1 + parents[j].start : parents[j].start;\n                            parents[j].end = 1 + parents[j].end;\n                        }\n                    }\n                }\n                var preLineTabSpaceLength = !isNullOrUndefined(parents[i - 1]) ?\n                    this.getTabSpace(parents[i - 1].text).length : 0;\n                var replace = this.appliedLine(parents[i].text, regex, perfixObj, preLineTabSpaceLength);\n                prefix = replace.line ? prefix : regex;\n                parents[i].text = replace.line ? replace.line : prefix + parents[i].text;\n                replace.space = replace.space ? replace.space : 0;\n                textArea.value = textArea.value.substr(0, parents[i].start + endLength) + parents[i].text + '\\n' +\n                    textArea.value.substr(parents[i].end, textArea.value.length);\n                start = i === 0 ? (start + prefix.length + replace.space) > 0 ?\n                    start + prefix.length + replace.space : 0 : start;\n                addedLength += prefix.length + replace.space;\n                if (parents.length !== 1) {\n                    for (var j = i; j < parents.length; j++) {\n                        parents[j].start = j !== 0 ? prefix.length +\n                            parents[j].start + replace.space : parents[j].start;\n                        parents[j].end = prefix.length + parents[j].end + replace.space;\n                    }\n                }\n                this.restore(textArea, start, end + addedLength, null);\n            }\n            else {\n                parents[i].text = parents[i].text.replace(regex, '');\n                textArea.value = textArea.value.substr(0, parents[i].start + endLength) + parents[i].text + '\\n' +\n                    textArea.value.substr(parents[i].end + endLength, textArea.value.length);\n                endLength -= regex.length;\n                startLength = regex.length;\n                this.restore(textArea, start - startLength, end + endLength, null);\n            }\n        }\n        this.restore(textArea, null, null, e);\n    };\n    MDLists.prototype.appliedLine = function (line, prefixPattern, perfixObj, preTabSpaceLength) {\n        var points = {};\n        var regex = new RegExp('^[' + this.syntax.UL.trim() + ']');\n        var lineSplit = line.split('. ');\n        var currentPrefix = lineSplit[0] + '. ';\n        var isExist = regex.test(line.trim()) || line.trim() === this.syntax.OL.trim()\n            || line.trim() === this.syntax.UL.trim() || /^\\d+$/.test(lineSplit[0].trim());\n        var listFormat = this.olListType();\n        var curTabSpaceLength = this.getTabSpace(line).length;\n        if (this.currentAction === 'OL' && listFormat) {\n            perfixObj[curTabSpaceLength.toString()] = !isNullOrUndefined(perfixObj[curTabSpaceLength.toString()]) ?\n                perfixObj[curTabSpaceLength.toString()].valueOf() + 1 : 1;\n            prefixPattern = perfixObj[curTabSpaceLength.toString()].valueOf().toString() + '. ';\n            if (!isNullOrUndefined(preTabSpaceLength) && preTabSpaceLength > curTabSpaceLength) {\n                perfixObj[preTabSpaceLength.toString()] = 0;\n            }\n        }\n        if (isExist) {\n            var replace = void 0;\n            var pattern = void 0;\n            // eslint-disable-next-line\n            var space = 0;\n            if (regex.test(line.trim())) {\n                pattern = this.syntax.UL;\n                replace = prefixPattern;\n                points.space = prefixPattern.trim().length - this.syntax.UL.trim().length;\n            }\n            else if (/^\\d+$/.test(lineSplit[0].trim()) && listFormat) {\n                pattern = lineSplit[0].trim() + '. ';\n                replace = prefixPattern;\n                points.space = this.syntax.UL.trim().length - currentPrefix.trim().length;\n            }\n            else if (/^\\d+$/.test(lineSplit[0].trim())) {\n                pattern = lineSplit[0].trim() + '. ';\n                replace = this.syntax.UL;\n                points.space = this.syntax.UL.trim().length - currentPrefix.trim().length;\n            }\n            points.line = line.replace(pattern, replace);\n        }\n        return points;\n    };\n    MDLists.prototype.restore = function (textArea, start, end, event) {\n        if (!isNullOrUndefined(start) && !isNullOrUndefined(start)) {\n            this.selection.save(start, end);\n        }\n        if (!isNullOrUndefined(event)) {\n            this.selection.restore(textArea);\n        }\n        if (event && event.callBack) {\n            event.callBack({\n                requestType: this.currentAction,\n                selectedText: this.selection.getSelectedText(textArea),\n                editorMode: 'Markdown',\n                event: event.event\n            });\n        }\n    };\n    MDLists.prototype.getListRegex = function () {\n        var regex = '';\n        var configKey = Object.keys(this.syntax);\n        for (var j = 0; j < configKey.length; j++) {\n            var syntax = this.selection.replaceSpecialChar(this.syntax[configKey[j]]);\n            regex += regex === '' ? '^(' + syntax + ')|^(' + syntax.trim() + ')' :\n                '|^(' + syntax + ')|^(' + syntax.trim() + ')';\n        }\n        return new RegExp(regex);\n    };\n    return MDLists;\n}());\nexport { MDLists };\n"]},"metadata":{},"sourceType":"module"}