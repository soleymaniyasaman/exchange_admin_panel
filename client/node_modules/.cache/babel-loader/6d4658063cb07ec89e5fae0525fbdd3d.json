{"ast":null,"code":"import { extend, select } from '@syncfusion/ej2-base';\nimport { remove, isNullOrUndefined, updateBlazorTemplate } from '@syncfusion/ej2-base';\nimport { parentsUntil, isGroupAdaptive, refreshForeignData, getObject, gridActionHandler } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { DataUtil } from '@syncfusion/ej2-data';\nimport { addRemoveEventListener } from '../base/util';\nimport * as literals from '../base/string-literals';\n/**\n * `NormalEdit` module is used to handle normal('inline, dialog, external') editing actions.\n *\n * @hidden\n */\n\nvar NormalEdit =\n/** @class */\nfunction () {\n  function NormalEdit(parent, serviceLocator, renderer) {\n    this.args = {};\n    this.currentVirtualData = {};\n    this.parent = parent;\n    this.renderer = renderer;\n    this.serviceLocator = serviceLocator;\n    this.addEventListener();\n  }\n\n  NormalEdit.prototype.clickHandler = function (e) {\n    var target = e.target;\n    var gObj = this.parent;\n\n    if ((parentsUntil(target, literals.gridContent) && parentsUntil(parentsUntil(target, literals.gridContent), 'e-grid').id === gObj.element.id || gObj.frozenRows && parentsUntil(target, literals.headerContent)) && !parentsUntil(target, 'e-unboundcelldiv')) {\n      this.rowIndex = parentsUntil(target, literals.rowCell) ? parseInt(target.parentElement.getAttribute(literals.ariaRowIndex), 10) : -1;\n\n      if (gObj.isEdit) {\n        gObj.editModule.endEdit();\n      }\n    }\n  };\n\n  NormalEdit.prototype.dblClickHandler = function (e) {\n    if (parentsUntil(e.target, literals.rowCell) && this.parent.editSettings.allowEditOnDblClick) {\n      this.parent.editModule.startEdit(parentsUntil(e.target, literals.row));\n    }\n  };\n  /**\n   * The function used to trigger editComplete\n   *\n   * @param {NotifyArgs} e - specifies the NotifyArgs\n   * @returns {void}\n   * @hidden\n   */\n\n\n  NormalEdit.prototype.editComplete = function (e) {\n    this.parent.isEdit = false;\n    var action = 'action';\n\n    switch (e.requestType) {\n      case 'save':\n        if (!(this.parent.isCheckBoxSelection || this.parent.selectionSettings.type === 'Multiple') || !this.parent.isPersistSelection) {\n          if (e[action] !== 'edit') {\n            this.parent.selectRow(0);\n          }\n        }\n\n        this.parent.trigger(events.actionComplete, extend(e, {\n          requestType: 'save',\n          type: events.actionComplete\n        }));\n        break;\n\n      case 'delete':\n        this.parent.trigger(events.actionComplete, extend(e, {\n          requestType: 'delete',\n          type: events.actionComplete\n        }));\n\n        if (!this.parent.isCheckBoxSelection) {\n          this.parent.selectRow(this.editRowIndex);\n        }\n\n        break;\n    }\n  };\n\n  NormalEdit.prototype.getEditArgs = function (editedData, rowObj, isScroll) {\n    var primaryKeys = this.parent.getPrimaryKeyFieldNames();\n    var primaryKeyValues = [];\n\n    for (var i = 0; i < primaryKeys.length; i++) {\n      primaryKeyValues.push(getObject(primaryKeys[i], editedData));\n    }\n\n    var args = {\n      primaryKey: primaryKeys,\n      primaryKeyValue: primaryKeyValues,\n      requestType: 'beginEdit',\n      rowData: editedData,\n      rowIndex: this.rowIndex,\n      type: 'edit',\n      cancel: false,\n      foreignKeyData: rowObj && rowObj.foreignKeyData,\n      target: undefined,\n      isScroll: isScroll\n    };\n    return args;\n  };\n\n  NormalEdit.prototype.startEdit = function (tr) {\n    var _this = this;\n\n    var gObj = this.parent;\n    this.rowIndex = this.editRowIndex = parseInt(tr.getAttribute(literals.ariaRowIndex), 10);\n\n    if (gObj.enableVirtualization || gObj.enableInfiniteScrolling) {\n      var selector = '.e-row[aria-rowindex=\"' + this.rowIndex + '\"]';\n      var virtualRow = this.parent.element.querySelector(selector);\n\n      if (!virtualRow) {\n        return;\n      }\n    }\n\n    var e = {\n      data: undefined,\n      index: this.rowIndex,\n      isScroll: false\n    };\n    this.parent.notify(events.virtualScrollEditActionBegin, e);\n\n    if (isGroupAdaptive(gObj)) {\n      var rObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n      this.previousData = rObj.data;\n    } else if (!this.previousData && (this.parent.enableVirtualization || this.parent.enableInfiniteScrolling)) {\n      this.previousData = e.data;\n    } else if (!this.parent.enableVirtualization) {\n      this.previousData = extend({}, {}, gObj.getCurrentViewRecords()[this.rowIndex], true);\n    }\n\n    var editedData = extend({}, {}, e.data || this.previousData, true);\n    this.uid = tr.getAttribute('data-uid');\n    var rowObj = gObj.getRowObjectFromUID(this.uid);\n    var args = this.getEditArgs(editedData, rowObj, e.isScroll);\n    args.row = tr;\n\n    if (!args.isScroll) {\n      this.parent.notify(events.createVirtualValidationForm, {\n        uid: this.uid,\n        prevData: this.previousData,\n        argsCreator: this.getEditArgs.bind(this),\n        renderer: this.renderer\n      });\n      gObj.trigger(events.beginEdit, args, function (begineditargs) {\n        begineditargs.type = 'actionBegin';\n        gObj.trigger(events.actionBegin, begineditargs, function (editargs) {\n          if (!editargs.cancel) {\n            _this.inlineEditHandler(editargs, tr);\n          }\n        });\n      });\n    } else {\n      this.inlineEditHandler(args, tr);\n    }\n  };\n\n  NormalEdit.prototype.inlineEditHandler = function (editargs, tr) {\n    var gObj = this.parent;\n    gObj.isEdit = true;\n    editargs.row = editargs.row ? editargs.row : tr;\n\n    if (gObj.editSettings.mode !== 'Dialog') {\n      gObj.clearSelection();\n    }\n\n    if (gObj.editSettings.mode === 'Dialog' && gObj.selectionModule) {\n      gObj.selectionModule.preventFocus = true;\n      editargs.row.classList.add('e-dlgeditrow');\n    }\n\n    this.renderer.update(editargs);\n    this.uid = tr.getAttribute('data-uid');\n    gObj.editModule.applyFormValidation();\n    editargs.type = 'actionComplete';\n    gObj.trigger(events.actionComplete, editargs);\n    this.args = editargs;\n\n    if (this.parent.allowTextWrap) {\n      this.parent.notify(events.freezeRender, {\n        case: 'textwrap'\n      });\n    }\n  };\n\n  NormalEdit.prototype.updateRow = function (index, data) {\n    var _this = this;\n\n    var gObj = this.parent;\n    this.editRowIndex = index;\n    var args = {\n      requestType: 'save',\n      action: 'edit',\n      type: events.actionBegin,\n      data: data,\n      cancel: false,\n      previousData: gObj.getCurrentViewRecords()[index],\n      row: gObj.getRowByIndex(index)\n    };\n    gObj.showSpinner();\n    gObj.notify(events.updateData, args);\n\n    if (args.promise) {\n      args.promise.then(function () {\n        return gObj.refresh();\n      }).catch(function (e) {\n        return _this.edFail(e);\n      });\n    } else {\n      gObj.refresh();\n    }\n  };\n\n  NormalEdit.prototype.editFormValidate = function () {\n    var gObj = this.parent;\n    var isValid = gObj.editModule.editFormValidate();\n    var validationArgs = {\n      prevData: this.previousData,\n      isValid: true,\n      editIdx: this.editRowIndex,\n      addIdx: this.addedRowIndex\n    };\n    gObj.notify(events.validateVirtualForm, validationArgs);\n    return isValid && validationArgs.isValid;\n  };\n\n  NormalEdit.prototype.endEdit = function () {\n    var gObj = this.parent;\n\n    if (!this.parent.isEdit || !this.editFormValidate()) {\n      return;\n    }\n\n    var editedData = extend({}, {}, this.previousData, true);\n    var args = extend(this.args, {\n      requestType: 'save',\n      type: events.actionBegin,\n      data: editedData,\n      cancel: false,\n      previousData: this.previousData,\n      selectedRow: gObj.selectedRowIndex,\n      foreignKeyData: {}\n    });\n    var index = gObj.getFrozenMode() === 'Right' ? 1 : 0;\n    var isDlg = gObj.editSettings.mode === 'Dialog';\n    var dlgWrapper = select('#' + gObj.element.id + '_dialogEdit_wrapper', document);\n    var dlgForm = isDlg ? dlgWrapper.querySelector('.e-gridform') : gObj.element.getElementsByClassName('e-gridform')[index];\n    var data = {\n      virtualData: extend({}, {}, this.previousData, true),\n      isAdd: false,\n      isScroll: false,\n      endEdit: true\n    };\n    this.parent.notify(events.getVirtualData, data);\n\n    if ((this.parent.enableVirtualization || this.parent.enableInfiniteScrolling) && this.parent.editSettings.mode === 'Normal' && Object.keys(data.virtualData).length) {\n      if (this.parent.isEdit) {\n        this.currentVirtualData = editedData = args.data = data.virtualData;\n      }\n    } else {\n      editedData = gObj.editModule.getCurrentEditedData(dlgForm, editedData);\n    }\n\n    if (gObj.isFrozenGrid() && gObj.editSettings.mode === 'Normal') {\n      var mhdrFrm = gObj.getMovableVirtualHeader().querySelector('.e-gridform');\n      var mCntFrm = gObj.getMovableVirtualContent().querySelector('.e-gridform');\n      var mvblEle = [mhdrFrm || mCntFrm];\n      var frHdrFrm = void 0;\n      var frCntFrm = void 0;\n      var frEle = [];\n\n      if (gObj.getFrozenMode() === literals.leftRight) {\n        frHdrFrm = gObj.getFrozenRightHeader().querySelector('.e-gridform');\n        frCntFrm = gObj.getFrozenRightContent().querySelector('.e-gridform');\n        frEle = [frHdrFrm || frCntFrm];\n      }\n\n      gridActionHandler(this.parent, function (tableName, elements) {\n        for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n          var ele = elements_1[_i];\n\n          if (ele) {\n            editedData = gObj.editModule.getCurrentEditedData(ele, editedData);\n          }\n        }\n      }, [[], mvblEle, frEle]);\n    }\n\n    var eleLength = [].slice.call(gObj.element.getElementsByClassName(literals.editedRow)).length;\n\n    if (!data.isAdd && Object.keys(this.currentVirtualData).length && !eleLength) {\n      eleLength = 1;\n    }\n\n    if (isDlg ? dlgWrapper.getElementsByClassName(literals.editedRow).length : eleLength) {\n      args.action = 'edit';\n      gObj.trigger(events.actionBegin, args, function (endEditArgs) {\n        if (endEditArgs.cancel) {\n          return;\n        }\n\n        gObj.showSpinner();\n        gObj.notify(events.updateData, endEditArgs);\n      });\n    } else {\n      args.action = 'add';\n      args.selectedRow = 0;\n      args.index = this.addedRowIndex;\n      gObj.notify(events.virtualScrollEditSuccess, {});\n      gObj.notify(events.modelChanged, args);\n      this.addedRowIndex = null;\n\n      if (args.cancel) {\n        return;\n      }\n    }\n  };\n\n  NormalEdit.prototype.destroyElements = function () {\n    var gObj = this.parent;\n    gObj.editModule.destroyWidgets();\n    gObj.editModule.destroyForm();\n    this.parent.notify(events.dialogDestroy, {});\n  };\n\n  NormalEdit.prototype.editHandler = function (args) {\n    var _this = this;\n\n    if (args.promise) {\n      args.promise.then(function (e) {\n        return _this.edSucc(e, args);\n      }).catch(function (e) {\n        return _this.edFail(e);\n      });\n    } else {\n      this.editSuccess(args.data, args);\n    }\n  };\n\n  NormalEdit.prototype.edSucc = function (e, args) {\n    this.editSuccess(e, args);\n  };\n\n  NormalEdit.prototype.edFail = function (e) {\n    this.editFailure(e);\n  };\n\n  NormalEdit.prototype.updateCurrentViewData = function (data) {\n    if (!this.parent.enableVirtualization && !this.parent.enableInfiniteScrolling) {\n      this.parent.getCurrentViewRecords()[this.editRowIndex] = data;\n    }\n  };\n\n  NormalEdit.prototype.requestSuccess = function (args) {\n    if (this.parent.editModule.formObj && !this.parent.editModule.formObj.isDestroyed) {\n      this.destroyElements();\n      this.stopEditStatus();\n\n      if (this.parent.editSettings.mode === 'Dialog' && args.action !== 'add' && this.parent.selectionModule) {\n        this.parent.element.querySelector('.e-dlgeditrow').classList.remove('e-dlgeditrow');\n      }\n    }\n  };\n\n  NormalEdit.prototype.editSuccess = function (e, args) {\n    if (!isNullOrUndefined(e) && !(e instanceof Array)) {\n      var rowData = 'rowData';\n      args.data = extend({}, extend({}, args[rowData], args.data), e);\n    }\n\n    this.requestSuccess(args);\n    this.parent.trigger(events.beforeDataBound, args);\n    args.type = events.actionComplete;\n    this.parent.isEdit = false;\n    this.refreshRow(args.data);\n    this.parent.notify(events.virtualScrollEditSuccess, args);\n    this.parent.editModule.checkLastRow(args.row);\n    this.parent.editModule.isLastRow = false;\n    this.updateCurrentViewData(args.data);\n    this.blazorTemplate();\n    this.editRowIndex = null;\n    this.parent.trigger(events.actionComplete, args);\n\n    if (!(this.parent.isCheckBoxSelection || this.parent.selectionSettings.type === 'Multiple') || !this.parent.isPersistSelection && !this.parent.selectionSettings.checkboxOnly) {\n      if (this.parent.editSettings.mode !== 'Dialog') {\n        this.parent.selectRow(this.rowIndex > -1 ? this.rowIndex : this.editRowIndex);\n      }\n    }\n\n    this.parent.hideSpinner();\n  };\n\n  NormalEdit.prototype.closeForm = function () {\n    if (!this.cloneRow && this.parent.isEdit) {\n      this.stopEditStatus();\n    }\n\n    if (this.cloneRow) {\n      this.cloneRow.remove();\n      this.cloneRow = null;\n      this.originalRow.classList.remove('e-hiddenrow');\n    }\n\n    if (this.parent.isFrozenGrid() && this.cloneFrozen) {\n      this.cloneFrozen.remove();\n      this.frozen.classList.remove('e-hiddenrow');\n    }\n  };\n\n  NormalEdit.prototype.blazorTemplate = function () {\n    var cols = this.parent.getColumns();\n\n    if (this.parent.editSettings.template && this.parent.editSettings.mode === 'Normal') {\n      updateBlazorTemplate(this.parent.element.id + 'editSettingsTemplate', 'Template', this.parent.editSettings);\n    }\n\n    for (var i = 0; i < cols.length; i++) {\n      var col = cols[i];\n\n      if (col.template) {\n        updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n      }\n\n      if (col.editTemplate) {\n        updateBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate', col);\n      }\n    }\n  };\n\n  NormalEdit.prototype.editFailure = function (e) {\n    this.parent.trigger(events.actionFailure, {\n      error: e\n    });\n    this.parent.hideSpinner();\n    this.parent.log('actionfailure', {\n      error: e\n    });\n  };\n\n  NormalEdit.prototype.needRefresh = function () {\n    var refresh = true;\n    var editedRow = this.parent.element.querySelector('.e-gridform');\n\n    if ((this.parent.enableVirtualization || this.parent.infiniteScrollSettings.enableCache) && this.parent.editSettings.mode === 'Normal' && !editedRow) {\n      refresh = false;\n    }\n\n    return refresh;\n  };\n\n  NormalEdit.prototype.refreshRow = function (data) {\n    var frzCols = this.parent.isFrozenGrid();\n    var row = new RowRenderer(this.serviceLocator, null, this.parent);\n    var rowObj = this.parent.getRowObjectFromUID(this.uid);\n\n    if (rowObj) {\n      rowObj.changes = data;\n      this.parent.notify(events.refreshVirtualCache, {\n        data: data\n      });\n      refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n\n      if (this.needRefresh()) {\n        row.refresh(rowObj, this.parent.getColumns(), true);\n      }\n\n      var tr = [].slice.call(this.parent.element.querySelectorAll('[aria-rowindex=\"' + rowObj.index + '\"]'));\n\n      if (frzCols && tr.length) {\n        for (var i = 0; i < tr.length; i++) {\n          var rowUid = tr[i].getAttribute('data-uid');\n\n          if (rowUid !== this.uid) {\n            rowObj = this.parent.getRowObjectFromUID(rowUid);\n            rowObj.changes = data;\n            row.refresh(rowObj, this.parent.getColumns(), true);\n            this.parent.editModule.checkLastRow(tr[i]);\n          }\n        }\n      }\n    }\n  };\n\n  NormalEdit.prototype.closeEdit = function () {\n    var _this = this;\n\n    if (!this.parent.isEdit) {\n      return;\n    }\n\n    var gObj = this.parent;\n    var args = extend(this.args, {\n      requestType: 'cancel',\n      type: events.actionBegin,\n      cancel: false,\n      data: this.previousData,\n      selectedRow: gObj.selectedRowIndex\n    });\n    gObj.notify(events.virtualScrollEditCancel, args);\n    this.blazorTemplate();\n    gObj.trigger(events.actionBegin, args, function (closeEditArgs) {\n      if (closeEditArgs.cancel) {\n        return;\n      }\n\n      if (_this.parent.editSettings.mode === 'Dialog') {\n        _this.parent.notify(events.dialogDestroy, {});\n      }\n\n      gObj.isEdit = false;\n\n      _this.stopEditStatus();\n\n      closeEditArgs.type = events.actionComplete;\n\n      if (gObj.editSettings.mode !== 'Dialog') {\n        _this.refreshRow(closeEditArgs.data);\n      }\n\n      var isLazyLoad = gObj.groupSettings.enableLazyLoading && gObj.groupSettings.columns.length && !gObj.getContentTable().querySelector('tr.e-emptyrow');\n\n      if (!gObj.getContentTable().querySelector('tr.e-emptyrow') && !gObj.getContentTable().querySelector('tr.e-row') && !isLazyLoad) {\n        gObj.renderModule.emptyRow();\n      }\n\n      if (gObj.editSettings.mode !== 'Dialog') {\n        gObj.selectRow(_this.rowIndex);\n      }\n\n      gObj.trigger(events.actionComplete, closeEditArgs);\n    });\n  };\n\n  NormalEdit.prototype.addRecord = function (data, index) {\n    var _this = this;\n\n    var gObj = this.parent;\n    this.addedRowIndex = index = !isNullOrUndefined(index) ? index : 0;\n\n    if (data) {\n      gObj.notify(events.modelChanged, {\n        requestType: 'save',\n        type: events.actionBegin,\n        data: data,\n        selectedRow: 0,\n        action: 'add',\n        index: index\n      });\n      return;\n    }\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    this.previousData = {};\n    this.uid = '';\n    var cols = gObj.getColumns();\n    var rowData = {\n      virtualData: {},\n      isScroll: false\n    };\n    this.parent.notify(events.getVirtualData, rowData);\n\n    for (var i = 0; i < cols.length; i++) {\n      if (rowData.isScroll && cols[i].getFreezeTableName() !== 'movable') {\n        continue;\n      }\n\n      if (cols[i].field) {\n        DataUtil.setValue(cols[i].field, cols[i].defaultValue, this.previousData);\n      }\n    }\n\n    var args = {\n      cancel: false,\n      foreignKeyData: {},\n      requestType: 'add',\n      data: this.previousData,\n      type: events.actionBegin,\n      index: index,\n      rowData: this.previousData,\n      target: undefined,\n      isScroll: rowData.isScroll\n    };\n\n    if ((this.parent.enableVirtualization || this.parent.infiniteScrollSettings.enableCache) && Object.keys(rowData.virtualData).length) {\n      args.data = args.rowData = rowData.virtualData;\n    }\n\n    if (!args.isScroll) {\n      this.parent.notify(events.createVirtualValidationForm, {\n        uid: this.uid,\n        prevData: this.previousData,\n        argsCreator: this.getEditArgs.bind(this),\n        renderer: this.renderer\n      });\n      gObj.trigger(events.actionBegin, args, function (addArgs) {\n        if (addArgs.cancel) {\n          return;\n        }\n\n        _this.inlineAddHandler(addArgs);\n      });\n    } else {\n      this.inlineAddHandler(args);\n    }\n  };\n\n  NormalEdit.prototype.inlineAddHandler = function (addArgs) {\n    var gObj = this.parent;\n    gObj.isEdit = true;\n\n    if (gObj.editSettings.mode !== 'Dialog') {\n      gObj.clearSelection();\n    }\n\n    this.renderer.addNew(addArgs);\n    gObj.editModule.applyFormValidation();\n    addArgs.type = events.actionComplete;\n    addArgs.row = gObj.element.querySelector('.' + literals.addedRow);\n    gObj.trigger(events.actionComplete, addArgs);\n    this.args = addArgs;\n  };\n\n  NormalEdit.prototype.deleteRecord = function (fieldname, data) {\n    this.editRowIndex = this.parent.selectedRowIndex;\n\n    if (data) {\n      data = data instanceof Array ? data : [data];\n      var gObj = this.parent;\n      var dataLen = Object.keys(data).length;\n      fieldname = fieldname || this.parent.getPrimaryKeyFieldNames()[0];\n\n      var _loop_1 = function (i) {\n        var _a;\n\n        var tmpRecord;\n        var contained = gObj.currentViewData.some(function (record) {\n          tmpRecord = record;\n          return data[i] === getObject(fieldname, record) || data[i] === record;\n        });\n        data[i] = contained ? tmpRecord : data[i][fieldname] ? data[i] : (_a = {}, _a[fieldname] = data[i], _a);\n      };\n\n      for (var i = 0; i < dataLen; i++) {\n        _loop_1(i);\n      }\n    }\n\n    var args = {\n      requestType: 'delete',\n      type: events.actionBegin,\n      foreignKeyData: {},\n      data: data ? data : this.parent.getSelectedRecords(),\n      tr: this.parent.getSelectedRows(),\n      cancel: false\n    };\n\n    if (!isNullOrUndefined(this.parent.commandDelIndex)) {\n      args.data[0] = this.parent.getRowObjectFromUID(this.parent.getRowByIndex(this.parent.commandDelIndex).getAttribute('data-uid')).data;\n    }\n\n    if (this.parent.enableVirtualization && args.data.length > 1) {\n      var uid = this.parent.getSelectedRows()[0].getAttribute('data-uid');\n      args.data = [this.parent.getRowObjectFromUID(uid).data];\n    }\n\n    this.parent.notify(events.modelChanged, args);\n  };\n\n  NormalEdit.prototype.stopEditStatus = function () {\n    var gObj = this.parent;\n    var addElements = [].slice.call(gObj.element.getElementsByClassName(literals.addedRow));\n    var editElements = [].slice.call(gObj.element.getElementsByClassName(literals.editedRow));\n\n    for (var i = 0; i < addElements.length; i++) {\n      remove(addElements[i]);\n    }\n\n    for (var i = 0; i < editElements.length; i++) {\n      editElements[i].classList.remove(literals.editedRow);\n    }\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  NormalEdit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.evtHandlers = [{\n      event: events.crudAction,\n      handler: this.editHandler\n    }, {\n      event: events.doubleTap,\n      handler: this.dblClickHandler\n    }, {\n      event: events.click,\n      handler: this.clickHandler\n    }, {\n      event: events.recordAdded,\n      handler: this.requestSuccess\n    }, {\n      event: events.dblclick,\n      handler: this.dblClickHandler\n    }, {\n      event: events.deleteComplete,\n      handler: this.editComplete\n    }, {\n      event: events.saveComplete,\n      handler: this.editComplete\n    }, {\n      event: events.rowModeChange,\n      handler: this.closeEdit\n    }, {\n      event: events.closeInline,\n      handler: this.closeForm\n    }];\n    addRemoveEventListener(this.parent, this.evtHandlers, true, this);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  NormalEdit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    addRemoveEventListener(this.parent, this.evtHandlers, false);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  NormalEdit.prototype.destroy = function () {\n    this.removeEventListener();\n    this.renderer.destroy();\n  };\n\n  return NormalEdit;\n}();\n\nexport { NormalEdit };","map":{"version":3,"sources":["/Users/yasaman/Documents/moj_adminpanel/adminpanel/node_modules/@syncfusion/ej2-grids/src/grid/actions/normal-edit.js"],"names":["extend","select","remove","isNullOrUndefined","updateBlazorTemplate","parentsUntil","isGroupAdaptive","refreshForeignData","getObject","gridActionHandler","events","RowRenderer","DataUtil","addRemoveEventListener","literals","NormalEdit","parent","serviceLocator","renderer","args","currentVirtualData","addEventListener","prototype","clickHandler","e","target","gObj","gridContent","id","element","frozenRows","headerContent","rowIndex","rowCell","parseInt","parentElement","getAttribute","ariaRowIndex","isEdit","editModule","endEdit","dblClickHandler","editSettings","allowEditOnDblClick","startEdit","row","editComplete","action","requestType","isCheckBoxSelection","selectionSettings","type","isPersistSelection","selectRow","trigger","actionComplete","editRowIndex","getEditArgs","editedData","rowObj","isScroll","primaryKeys","getPrimaryKeyFieldNames","primaryKeyValues","i","length","push","primaryKey","primaryKeyValue","rowData","cancel","foreignKeyData","undefined","tr","_this","enableVirtualization","enableInfiniteScrolling","selector","virtualRow","querySelector","data","index","notify","virtualScrollEditActionBegin","rObj","getRowObjectFromUID","previousData","getCurrentViewRecords","uid","createVirtualValidationForm","prevData","argsCreator","bind","beginEdit","begineditargs","actionBegin","editargs","inlineEditHandler","mode","clearSelection","selectionModule","preventFocus","classList","add","update","applyFormValidation","allowTextWrap","freezeRender","case","updateRow","getRowByIndex","showSpinner","updateData","promise","then","refresh","catch","edFail","editFormValidate","isValid","validationArgs","editIdx","addIdx","addedRowIndex","validateVirtualForm","selectedRow","selectedRowIndex","getFrozenMode","isDlg","dlgWrapper","document","dlgForm","getElementsByClassName","virtualData","isAdd","getVirtualData","Object","keys","getCurrentEditedData","isFrozenGrid","mhdrFrm","getMovableVirtualHeader","mCntFrm","getMovableVirtualContent","mvblEle","frHdrFrm","frCntFrm","frEle","leftRight","getFrozenRightHeader","getFrozenRightContent","tableName","elements","_i","elements_1","ele","eleLength","slice","call","editedRow","endEditArgs","virtualScrollEditSuccess","modelChanged","destroyElements","destroyWidgets","destroyForm","dialogDestroy","editHandler","edSucc","editSuccess","editFailure","updateCurrentViewData","requestSuccess","formObj","isDestroyed","stopEditStatus","Array","beforeDataBound","refreshRow","checkLastRow","isLastRow","blazorTemplate","checkboxOnly","hideSpinner","closeForm","cloneRow","originalRow","cloneFrozen","frozen","cols","getColumns","template","col","editTemplate","actionFailure","error","log","needRefresh","infiniteScrollSettings","enableCache","frzCols","changes","refreshVirtualCache","getForeignKeyColumns","querySelectorAll","rowUid","closeEdit","virtualScrollEditCancel","closeEditArgs","isLazyLoad","groupSettings","enableLazyLoading","columns","getContentTable","renderModule","emptyRow","addRecord","getFreezeTableName","field","setValue","defaultValue","addArgs","inlineAddHandler","addNew","addedRow","deleteRecord","fieldname","dataLen","_loop_1","_a","tmpRecord","contained","currentViewData","some","record","getSelectedRecords","getSelectedRows","commandDelIndex","addElements","editElements","evtHandlers","event","crudAction","handler","doubleTap","click","recordAdded","dblclick","deleteComplete","saveComplete","rowModeChange","closeInline","removeEventListener","destroy"],"mappings":"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","sourcesContent":["import { extend, select } from '@syncfusion/ej2-base';\nimport { remove, isNullOrUndefined, updateBlazorTemplate } from '@syncfusion/ej2-base';\nimport { parentsUntil, isGroupAdaptive, refreshForeignData, getObject, gridActionHandler } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { DataUtil } from '@syncfusion/ej2-data';\nimport { addRemoveEventListener } from '../base/util';\nimport * as literals from '../base/string-literals';\n/**\n * `NormalEdit` module is used to handle normal('inline, dialog, external') editing actions.\n *\n * @hidden\n */\nvar NormalEdit = /** @class */ (function () {\n    function NormalEdit(parent, serviceLocator, renderer) {\n        this.args = {};\n        this.currentVirtualData = {};\n        this.parent = parent;\n        this.renderer = renderer;\n        this.serviceLocator = serviceLocator;\n        this.addEventListener();\n    }\n    NormalEdit.prototype.clickHandler = function (e) {\n        var target = e.target;\n        var gObj = this.parent;\n        if ((((parentsUntil(target, literals.gridContent) &&\n            parentsUntil(parentsUntil(target, literals.gridContent), 'e-grid').id === gObj.element.id)) || (gObj.frozenRows\n            && parentsUntil(target, literals.headerContent))) && !parentsUntil(target, 'e-unboundcelldiv')) {\n            this.rowIndex = parentsUntil(target, literals.rowCell)\n                ? parseInt(target.parentElement.getAttribute(literals.ariaRowIndex), 10) : -1;\n            if (gObj.isEdit) {\n                gObj.editModule.endEdit();\n            }\n        }\n    };\n    NormalEdit.prototype.dblClickHandler = function (e) {\n        if (parentsUntil(e.target, literals.rowCell) && this.parent.editSettings.allowEditOnDblClick) {\n            this.parent.editModule.startEdit(parentsUntil(e.target, literals.row));\n        }\n    };\n    /**\n     * The function used to trigger editComplete\n     *\n     * @param {NotifyArgs} e - specifies the NotifyArgs\n     * @returns {void}\n     * @hidden\n     */\n    NormalEdit.prototype.editComplete = function (e) {\n        this.parent.isEdit = false;\n        var action = 'action';\n        switch (e.requestType) {\n            case 'save':\n                if (!(this.parent.isCheckBoxSelection || this.parent.selectionSettings.type === 'Multiple')\n                    || (!this.parent.isPersistSelection)) {\n                    if (e[action] !== 'edit') {\n                        this.parent.selectRow(0);\n                    }\n                }\n                this.parent.trigger(events.actionComplete, extend(e, {\n                    requestType: 'save',\n                    type: events.actionComplete\n                }));\n                break;\n            case 'delete':\n                this.parent.trigger(events.actionComplete, extend(e, {\n                    requestType: 'delete',\n                    type: events.actionComplete\n                }));\n                if (!this.parent.isCheckBoxSelection) {\n                    this.parent.selectRow(this.editRowIndex);\n                }\n                break;\n        }\n    };\n    NormalEdit.prototype.getEditArgs = function (editedData, rowObj, isScroll) {\n        var primaryKeys = this.parent.getPrimaryKeyFieldNames();\n        var primaryKeyValues = [];\n        for (var i = 0; i < primaryKeys.length; i++) {\n            primaryKeyValues.push(getObject(primaryKeys[i], editedData));\n        }\n        var args = {\n            primaryKey: primaryKeys, primaryKeyValue: primaryKeyValues, requestType: 'beginEdit',\n            rowData: editedData, rowIndex: this.rowIndex, type: 'edit', cancel: false,\n            foreignKeyData: rowObj && rowObj.foreignKeyData, target: undefined, isScroll: isScroll\n        };\n        return args;\n    };\n    NormalEdit.prototype.startEdit = function (tr) {\n        var _this = this;\n        var gObj = this.parent;\n        this.rowIndex = this.editRowIndex = parseInt(tr.getAttribute(literals.ariaRowIndex), 10);\n        if (gObj.enableVirtualization || gObj.enableInfiniteScrolling) {\n            var selector = '.e-row[aria-rowindex=\"' + this.rowIndex + '\"]';\n            var virtualRow = this.parent.element.querySelector(selector);\n            if (!virtualRow) {\n                return;\n            }\n        }\n        var e = { data: undefined, index: this.rowIndex, isScroll: false };\n        this.parent.notify(events.virtualScrollEditActionBegin, e);\n        if (isGroupAdaptive(gObj)) {\n            var rObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n            this.previousData = rObj.data;\n        }\n        else if (!this.previousData && (this.parent.enableVirtualization || this.parent.enableInfiniteScrolling)) {\n            this.previousData = e.data;\n        }\n        else if (!this.parent.enableVirtualization) {\n            this.previousData = extend({}, {}, gObj.getCurrentViewRecords()[this.rowIndex], true);\n        }\n        var editedData = extend({}, {}, e.data || this.previousData, true);\n        this.uid = tr.getAttribute('data-uid');\n        var rowObj = gObj.getRowObjectFromUID(this.uid);\n        var args = this.getEditArgs(editedData, rowObj, e.isScroll);\n        args.row = tr;\n        if (!args.isScroll) {\n            this.parent.notify(events.createVirtualValidationForm, { uid: this.uid, prevData: this.previousData, argsCreator: this.getEditArgs.bind(this), renderer: this.renderer });\n            gObj.trigger(events.beginEdit, args, function (begineditargs) {\n                begineditargs.type = 'actionBegin';\n                gObj.trigger(events.actionBegin, begineditargs, function (editargs) {\n                    if (!editargs.cancel) {\n                        _this.inlineEditHandler(editargs, tr);\n                    }\n                });\n            });\n        }\n        else {\n            this.inlineEditHandler(args, tr);\n        }\n    };\n    NormalEdit.prototype.inlineEditHandler = function (editargs, tr) {\n        var gObj = this.parent;\n        gObj.isEdit = true;\n        editargs.row = editargs.row ? editargs.row : tr;\n        if (gObj.editSettings.mode !== 'Dialog') {\n            gObj.clearSelection();\n        }\n        if (gObj.editSettings.mode === 'Dialog' && gObj.selectionModule) {\n            gObj.selectionModule.preventFocus = true;\n            editargs.row.classList.add('e-dlgeditrow');\n        }\n        this.renderer.update(editargs);\n        this.uid = tr.getAttribute('data-uid');\n        gObj.editModule.applyFormValidation();\n        editargs.type = 'actionComplete';\n        gObj.trigger(events.actionComplete, editargs);\n        this.args = editargs;\n        if (this.parent.allowTextWrap) {\n            this.parent.notify(events.freezeRender, { case: 'textwrap' });\n        }\n    };\n    NormalEdit.prototype.updateRow = function (index, data) {\n        var _this = this;\n        var gObj = this.parent;\n        this.editRowIndex = index;\n        var args = {\n            requestType: 'save', action: 'edit', type: events.actionBegin, data: data, cancel: false,\n            previousData: gObj.getCurrentViewRecords()[index],\n            row: gObj.getRowByIndex(index)\n        };\n        gObj.showSpinner();\n        gObj.notify(events.updateData, args);\n        if (args.promise) {\n            args.promise.then(function () { return gObj.refresh(); }).catch(function (e) { return _this.edFail(e); });\n        }\n        else {\n            gObj.refresh();\n        }\n    };\n    NormalEdit.prototype.editFormValidate = function () {\n        var gObj = this.parent;\n        var isValid = gObj.editModule.editFormValidate();\n        var validationArgs = {\n            prevData: this.previousData, isValid: true, editIdx: this.editRowIndex, addIdx: this.addedRowIndex\n        };\n        gObj.notify(events.validateVirtualForm, validationArgs);\n        return (isValid && validationArgs.isValid);\n    };\n    NormalEdit.prototype.endEdit = function () {\n        var gObj = this.parent;\n        if (!this.parent.isEdit || !this.editFormValidate()) {\n            return;\n        }\n        var editedData = extend({}, {}, this.previousData, true);\n        var args = extend(this.args, {\n            requestType: 'save', type: events.actionBegin, data: editedData, cancel: false,\n            previousData: this.previousData, selectedRow: gObj.selectedRowIndex, foreignKeyData: {}\n        });\n        var index = gObj.getFrozenMode() === 'Right' ? 1 : 0;\n        var isDlg = gObj.editSettings.mode === 'Dialog';\n        var dlgWrapper = select('#' + gObj.element.id + '_dialogEdit_wrapper', document);\n        var dlgForm = isDlg ? dlgWrapper.querySelector('.e-gridform') : gObj.element.getElementsByClassName('e-gridform')[index];\n        var data = {\n            virtualData: extend({}, {}, this.previousData, true), isAdd: false, isScroll: false, endEdit: true\n        };\n        this.parent.notify(events.getVirtualData, data);\n        if ((this.parent.enableVirtualization || this.parent.enableInfiniteScrolling)\n            && this.parent.editSettings.mode === 'Normal' && Object.keys(data.virtualData).length) {\n            if (this.parent.isEdit) {\n                this.currentVirtualData = editedData = args.data = data.virtualData;\n            }\n        }\n        else {\n            editedData = gObj.editModule.getCurrentEditedData(dlgForm, editedData);\n        }\n        if (gObj.isFrozenGrid() && gObj.editSettings.mode === 'Normal') {\n            var mhdrFrm = gObj.getMovableVirtualHeader().querySelector('.e-gridform');\n            var mCntFrm = gObj.getMovableVirtualContent().querySelector('.e-gridform');\n            var mvblEle = [mhdrFrm || mCntFrm];\n            var frHdrFrm = void 0;\n            var frCntFrm = void 0;\n            var frEle = [];\n            if (gObj.getFrozenMode() === literals.leftRight) {\n                frHdrFrm = gObj.getFrozenRightHeader().querySelector('.e-gridform');\n                frCntFrm = gObj.getFrozenRightContent().querySelector('.e-gridform');\n                frEle = [frHdrFrm || frCntFrm];\n            }\n            gridActionHandler(this.parent, function (tableName, elements) {\n                for (var _i = 0, elements_1 = elements; _i < elements_1.length; _i++) {\n                    var ele = elements_1[_i];\n                    if (ele) {\n                        editedData = gObj.editModule.getCurrentEditedData(ele, editedData);\n                    }\n                }\n            }, [[], mvblEle, frEle]);\n        }\n        var eleLength = [].slice.call(gObj.element.getElementsByClassName(literals.editedRow)).length;\n        if (!data.isAdd && Object.keys(this.currentVirtualData).length && !eleLength) {\n            eleLength = 1;\n        }\n        if (isDlg ? dlgWrapper.getElementsByClassName(literals.editedRow).length : eleLength) {\n            args.action = 'edit';\n            gObj.trigger(events.actionBegin, args, function (endEditArgs) {\n                if (endEditArgs.cancel) {\n                    return;\n                }\n                gObj.showSpinner();\n                gObj.notify(events.updateData, endEditArgs);\n            });\n        }\n        else {\n            args.action = 'add';\n            args.selectedRow = 0;\n            args.index = this.addedRowIndex;\n            gObj.notify(events.virtualScrollEditSuccess, {});\n            gObj.notify(events.modelChanged, args);\n            this.addedRowIndex = null;\n            if (args.cancel) {\n                return;\n            }\n        }\n    };\n    NormalEdit.prototype.destroyElements = function () {\n        var gObj = this.parent;\n        gObj.editModule.destroyWidgets();\n        gObj.editModule.destroyForm();\n        this.parent.notify(events.dialogDestroy, {});\n    };\n    NormalEdit.prototype.editHandler = function (args) {\n        var _this = this;\n        if (args.promise) {\n            args.promise.then(function (e) { return _this.edSucc(e, args); }).catch(function (e) { return _this.edFail(e); });\n        }\n        else {\n            this.editSuccess(args.data, args);\n        }\n    };\n    NormalEdit.prototype.edSucc = function (e, args) {\n        this.editSuccess(e, args);\n    };\n    NormalEdit.prototype.edFail = function (e) {\n        this.editFailure(e);\n    };\n    NormalEdit.prototype.updateCurrentViewData = function (data) {\n        if (!this.parent.enableVirtualization && !this.parent.enableInfiniteScrolling) {\n            this.parent.getCurrentViewRecords()[this.editRowIndex] = data;\n        }\n    };\n    NormalEdit.prototype.requestSuccess = function (args) {\n        if (this.parent.editModule.formObj && !this.parent.editModule.formObj.isDestroyed) {\n            this.destroyElements();\n            this.stopEditStatus();\n            if (this.parent.editSettings.mode === 'Dialog' && args.action !== 'add' &&\n                this.parent.selectionModule) {\n                this.parent.element.querySelector('.e-dlgeditrow').classList.remove('e-dlgeditrow');\n            }\n        }\n    };\n    NormalEdit.prototype.editSuccess = function (e, args) {\n        if (!isNullOrUndefined(e) && !(e instanceof Array)) {\n            var rowData = 'rowData';\n            args.data = extend({}, extend({}, args[rowData], args.data), e);\n        }\n        this.requestSuccess(args);\n        this.parent.trigger(events.beforeDataBound, args);\n        args.type = events.actionComplete;\n        this.parent.isEdit = false;\n        this.refreshRow(args.data);\n        this.parent.notify(events.virtualScrollEditSuccess, args);\n        this.parent.editModule.checkLastRow(args.row);\n        this.parent.editModule.isLastRow = false;\n        this.updateCurrentViewData(args.data);\n        this.blazorTemplate();\n        this.editRowIndex = null;\n        this.parent.trigger(events.actionComplete, args);\n        if (!(this.parent.isCheckBoxSelection || this.parent.selectionSettings.type === 'Multiple')\n            || (!this.parent.isPersistSelection) && !this.parent.selectionSettings.checkboxOnly) {\n            if (this.parent.editSettings.mode !== 'Dialog') {\n                this.parent.selectRow(this.rowIndex > -1 ? this.rowIndex : this.editRowIndex);\n            }\n        }\n        this.parent.hideSpinner();\n    };\n    NormalEdit.prototype.closeForm = function () {\n        if (!this.cloneRow && this.parent.isEdit) {\n            this.stopEditStatus();\n        }\n        if (this.cloneRow) {\n            this.cloneRow.remove();\n            this.cloneRow = null;\n            this.originalRow.classList.remove('e-hiddenrow');\n        }\n        if (this.parent.isFrozenGrid() && this.cloneFrozen) {\n            this.cloneFrozen.remove();\n            this.frozen.classList.remove('e-hiddenrow');\n        }\n    };\n    NormalEdit.prototype.blazorTemplate = function () {\n        var cols = this.parent.getColumns();\n        if (this.parent.editSettings.template && this.parent.editSettings.mode === 'Normal') {\n            updateBlazorTemplate(this.parent.element.id + 'editSettingsTemplate', 'Template', this.parent.editSettings);\n        }\n        for (var i = 0; i < cols.length; i++) {\n            var col = cols[i];\n            if (col.template) {\n                updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n            }\n            if (col.editTemplate) {\n                updateBlazorTemplate(this.parent.element.id + col.uid + 'editTemplate', 'EditTemplate', col);\n            }\n        }\n    };\n    NormalEdit.prototype.editFailure = function (e) {\n        this.parent.trigger(events.actionFailure, ({ error: e }));\n        this.parent.hideSpinner();\n        this.parent.log('actionfailure', { error: e });\n    };\n    NormalEdit.prototype.needRefresh = function () {\n        var refresh = true;\n        var editedRow = this.parent.element.querySelector('.e-gridform');\n        if ((this.parent.enableVirtualization || this.parent.infiniteScrollSettings.enableCache)\n            && this.parent.editSettings.mode === 'Normal' && !editedRow) {\n            refresh = false;\n        }\n        return refresh;\n    };\n    NormalEdit.prototype.refreshRow = function (data) {\n        var frzCols = this.parent.isFrozenGrid();\n        var row = new RowRenderer(this.serviceLocator, null, this.parent);\n        var rowObj = this.parent.getRowObjectFromUID(this.uid);\n        if (rowObj) {\n            rowObj.changes = data;\n            this.parent.notify(events.refreshVirtualCache, { data: data });\n            refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n            if (this.needRefresh()) {\n                row.refresh(rowObj, this.parent.getColumns(), true);\n            }\n            var tr = [].slice.call(this.parent.element.querySelectorAll('[aria-rowindex=\"' + rowObj.index + '\"]'));\n            if (frzCols && tr.length) {\n                for (var i = 0; i < tr.length; i++) {\n                    var rowUid = tr[i].getAttribute('data-uid');\n                    if (rowUid !== this.uid) {\n                        rowObj = this.parent.getRowObjectFromUID(rowUid);\n                        rowObj.changes = data;\n                        row.refresh(rowObj, this.parent.getColumns(), true);\n                        this.parent.editModule.checkLastRow(tr[i]);\n                    }\n                }\n            }\n        }\n    };\n    NormalEdit.prototype.closeEdit = function () {\n        var _this = this;\n        if (!this.parent.isEdit) {\n            return;\n        }\n        var gObj = this.parent;\n        var args = extend(this.args, {\n            requestType: 'cancel', type: events.actionBegin, cancel: false, data: this.previousData, selectedRow: gObj.selectedRowIndex\n        });\n        gObj.notify(events.virtualScrollEditCancel, args);\n        this.blazorTemplate();\n        gObj.trigger(events.actionBegin, args, function (closeEditArgs) {\n            if (closeEditArgs.cancel) {\n                return;\n            }\n            if (_this.parent.editSettings.mode === 'Dialog') {\n                _this.parent.notify(events.dialogDestroy, {});\n            }\n            gObj.isEdit = false;\n            _this.stopEditStatus();\n            closeEditArgs.type = events.actionComplete;\n            if (gObj.editSettings.mode !== 'Dialog') {\n                _this.refreshRow(closeEditArgs.data);\n            }\n            var isLazyLoad = gObj.groupSettings.enableLazyLoading && gObj.groupSettings.columns.length\n                && !gObj.getContentTable().querySelector('tr.e-emptyrow');\n            if (!gObj.getContentTable().querySelector('tr.e-emptyrow') &&\n                !gObj.getContentTable().querySelector('tr.e-row') && !isLazyLoad) {\n                gObj.renderModule.emptyRow();\n            }\n            if (gObj.editSettings.mode !== 'Dialog') {\n                gObj.selectRow(_this.rowIndex);\n            }\n            gObj.trigger(events.actionComplete, closeEditArgs);\n        });\n    };\n    NormalEdit.prototype.addRecord = function (data, index) {\n        var _this = this;\n        var gObj = this.parent;\n        this.addedRowIndex = index = !isNullOrUndefined(index) ? index : 0;\n        if (data) {\n            gObj.notify(events.modelChanged, {\n                requestType: 'save', type: events.actionBegin, data: data, selectedRow: 0, action: 'add', index: index\n            });\n            return;\n        }\n        if (gObj.isEdit) {\n            return;\n        }\n        this.previousData = {};\n        this.uid = '';\n        var cols = gObj.getColumns();\n        var rowData = { virtualData: {}, isScroll: false };\n        this.parent.notify(events.getVirtualData, rowData);\n        for (var i = 0; i < cols.length; i++) {\n            if (rowData.isScroll && cols[i].getFreezeTableName() !== 'movable') {\n                continue;\n            }\n            if (cols[i].field) {\n                DataUtil.setValue(cols[i].field, cols[i].defaultValue, this.previousData);\n            }\n        }\n        var args = {\n            cancel: false, foreignKeyData: {},\n            requestType: 'add', data: this.previousData, type: events.actionBegin, index: index,\n            rowData: this.previousData, target: undefined, isScroll: rowData.isScroll\n        };\n        if ((this.parent.enableVirtualization || this.parent.infiniteScrollSettings.enableCache)\n            && Object.keys(rowData.virtualData).length) {\n            args.data = args.rowData = rowData.virtualData;\n        }\n        if (!args.isScroll) {\n            this.parent.notify(events.createVirtualValidationForm, { uid: this.uid, prevData: this.previousData, argsCreator: this.getEditArgs.bind(this), renderer: this.renderer });\n            gObj.trigger(events.actionBegin, args, function (addArgs) {\n                if (addArgs.cancel) {\n                    return;\n                }\n                _this.inlineAddHandler(addArgs);\n            });\n        }\n        else {\n            this.inlineAddHandler(args);\n        }\n    };\n    NormalEdit.prototype.inlineAddHandler = function (addArgs) {\n        var gObj = this.parent;\n        gObj.isEdit = true;\n        if (gObj.editSettings.mode !== 'Dialog') {\n            gObj.clearSelection();\n        }\n        this.renderer.addNew(addArgs);\n        gObj.editModule.applyFormValidation();\n        addArgs.type = events.actionComplete;\n        addArgs.row = gObj.element.querySelector('.' + literals.addedRow);\n        gObj.trigger(events.actionComplete, addArgs);\n        this.args = addArgs;\n    };\n    NormalEdit.prototype.deleteRecord = function (fieldname, data) {\n        this.editRowIndex = this.parent.selectedRowIndex;\n        if (data) {\n            data = (data instanceof Array) ? data : [data];\n            var gObj = this.parent;\n            var dataLen = Object.keys(data).length;\n            fieldname = fieldname || this.parent.getPrimaryKeyFieldNames()[0];\n            var _loop_1 = function (i) {\n                var _a;\n                var tmpRecord;\n                var contained = gObj.currentViewData.some(function (record) {\n                    tmpRecord = record;\n                    return data[i] === getObject(fieldname, record) || data[i] === record;\n                });\n                data[i] = contained ? tmpRecord : data[i][fieldname] ? data[i] : (_a = {}, _a[fieldname] = data[i], _a);\n            };\n            for (var i = 0; i < dataLen; i++) {\n                _loop_1(i);\n            }\n        }\n        var args = {\n            requestType: 'delete', type: events.actionBegin, foreignKeyData: {},\n            data: data ? data : this.parent.getSelectedRecords(), tr: this.parent.getSelectedRows(), cancel: false\n        };\n        if (!isNullOrUndefined(this.parent.commandDelIndex)) {\n            args.data[0] =\n                this.parent.getRowObjectFromUID(this.parent.getRowByIndex(this.parent.commandDelIndex).getAttribute('data-uid')).data;\n        }\n        if (this.parent.enableVirtualization && args.data.length > 1) {\n            var uid = this.parent.getSelectedRows()[0].getAttribute('data-uid');\n            args.data = [this.parent.getRowObjectFromUID(uid).data];\n        }\n        this.parent.notify(events.modelChanged, args);\n    };\n    NormalEdit.prototype.stopEditStatus = function () {\n        var gObj = this.parent;\n        var addElements = [].slice.call(gObj.element.getElementsByClassName(literals.addedRow));\n        var editElements = [].slice.call(gObj.element.getElementsByClassName(literals.editedRow));\n        for (var i = 0; i < addElements.length; i++) {\n            remove(addElements[i]);\n        }\n        for (var i = 0; i < editElements.length; i++) {\n            editElements[i].classList.remove(literals.editedRow);\n        }\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    NormalEdit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.evtHandlers = [{ event: events.crudAction, handler: this.editHandler },\n            { event: events.doubleTap, handler: this.dblClickHandler },\n            { event: events.click, handler: this.clickHandler },\n            { event: events.recordAdded, handler: this.requestSuccess },\n            { event: events.dblclick, handler: this.dblClickHandler },\n            { event: events.deleteComplete, handler: this.editComplete },\n            { event: events.saveComplete, handler: this.editComplete },\n            { event: events.rowModeChange, handler: this.closeEdit },\n            { event: events.closeInline, handler: this.closeForm }];\n        addRemoveEventListener(this.parent, this.evtHandlers, true, this);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    NormalEdit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        addRemoveEventListener(this.parent, this.evtHandlers, false);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    NormalEdit.prototype.destroy = function () {\n        this.removeEventListener();\n        this.renderer.destroy();\n    };\n    return NormalEdit;\n}());\nexport { NormalEdit };\n"]},"metadata":{},"sourceType":"module"}