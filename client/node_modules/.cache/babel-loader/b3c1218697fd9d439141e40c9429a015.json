{"ast":null,"code":"import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\n\nvar Image =\n/** @class */\nfunction () {\n  function Image(parent, serviceLocator) {\n    this.isImgUploaded = false;\n    this.isAllowedTypes = true;\n    this.pageX = null;\n    this.pageY = null;\n    this.deletedImg = [];\n    this.parent = parent;\n    this.rteID = parent.element.id;\n    this.i10n = serviceLocator.getService('rteLocale');\n    this.rendererFactory = serviceLocator.getService('rendererFactory');\n    this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n    this.addEventListener();\n  }\n\n  Image.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.insertImage, this.insertImage, this);\n    this.parent.on(events.showImageDialog, this.showDialog, this);\n    this.parent.on(events.closeImageDialog, this.closeDialog, this);\n    this.parent.on(events.windowResize, this.onWindowResize, this);\n    this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n    this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n    this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n    this.parent.on(events.imageCaption, this.caption, this);\n    this.parent.on(events.imageDelete, this.deleteImg, this);\n    this.parent.on(events.imageLink, this.insertImgLink, this);\n    this.parent.on(events.imageAlt, this.insertAltText, this);\n    this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n    this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n    this.parent.on(events.imageSize, this.imageSize, this);\n    this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n    this.parent.on(events.initialEnd, this.afterRender, this);\n    this.parent.on(events.dynamicModule, this.afterRender, this);\n    this.parent.on(events.paste, this.imagePaste, this);\n    this.parent.on(events.destroy, this.removeEventListener, this);\n  };\n\n  Image.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.keyUp, this.onKeyUp);\n    this.parent.off(events.windowResize, this.onWindowResize);\n    this.parent.off(events.insertImage, this.insertImage);\n    this.parent.off(events.showImageDialog, this.showDialog);\n    this.parent.off(events.closeImageDialog, this.closeDialog);\n    this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n    this.parent.off(events.clearDialogObj, this.clearDialogObj);\n    this.parent.off(events.imageCaption, this.caption);\n    this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n    this.parent.off(events.imageDelete, this.deleteImg);\n    this.parent.off(events.imageLink, this.insertImgLink);\n    this.parent.off(events.imageAlt, this.insertAltText);\n    this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n    this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n    this.parent.off(events.imageSize, this.imageSize);\n    this.parent.off(events.dropDownSelect, this.alignmentSelect);\n    this.parent.off(events.initialEnd, this.afterRender);\n    this.parent.off(events.dynamicModule, this.afterRender);\n    this.parent.off(events.paste, this.imagePaste);\n    this.parent.off(events.destroy, this.removeEventListener);\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n    dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n\n    if (!isNullOrUndefined(this.contentModule)) {\n      EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n      this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n\n      if (this.parent.insertImageSettings.resize) {\n        EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n        EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n        EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n      }\n    }\n  };\n\n  Image.prototype.onIframeMouseDown = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n\n  Image.prototype.afterRender = function () {\n    this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n    EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n\n    if (this.parent.insertImageSettings.resize) {\n      EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n      EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n      EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n    }\n\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n    dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n  };\n\n  Image.prototype.undoStack = function (args) {\n    if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n      for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n        var temp = this.parent.createElement('div');\n        var contentElem = parseHtml(this.parent.formatter.getUndoRedoStack()[i].text);\n        temp.appendChild(contentElem);\n        var img = temp.querySelectorAll('img');\n\n        if (temp.querySelector('.e-img-resize') && img.length > 0) {\n          for (var j = 0; j < img.length; j++) {\n            img[j].style.outline = '';\n          }\n\n          detach(temp.querySelector('.e-img-resize'));\n          this.parent.formatter.getUndoRedoStack()[i].text = temp.innerHTML;\n        }\n      }\n    }\n  };\n\n  Image.prototype.resizeEnd = function (e) {\n    this.resizeBtnInit();\n    this.imgEle.parentElement.style.cursor = 'auto';\n\n    if (Browser.isDevice) {\n      removeClass([e.target.parentElement], 'e-mob-span');\n    }\n\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.resizeStop, args);\n    /* eslint-disable */\n\n    var pageX = this.getPointX(e);\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n    /* eslint-enable */\n\n    this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n    this.parent.formatter.saveData();\n  };\n\n  Image.prototype.resizeStart = function (e, ele) {\n    var _this = this;\n\n    if (this.parent.readonly) {\n      return;\n    }\n\n    var target = ele ? ele : e.target;\n    this.prevSelectedImgEle = this.imgEle;\n\n    if (target.tagName === 'IMG') {\n      this.parent.preventDefaultResize(e);\n      var img = target;\n\n      if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n        detach(this.imgResizeDiv);\n      }\n\n      this.imageResize(img);\n    }\n\n    if (target.classList.contains('e-rte-imageboxmark')) {\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n\n      this.pageX = this.getPointX(e);\n      this.pageY = this.getPointY(e);\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      this.resizeBtnInit();\n\n      if (this.quickToolObj) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n\n      if (target.classList.contains('e-rte-topLeft')) {\n        this.resizeBtnStat.topLeft = true;\n      }\n\n      if (target.classList.contains('e-rte-topRight')) {\n        this.resizeBtnStat.topRight = true;\n      }\n\n      if (target.classList.contains('e-rte-botLeft')) {\n        this.resizeBtnStat.botLeft = true;\n      }\n\n      if (target.classList.contains('e-rte-botRight')) {\n        this.resizeBtnStat.botRight = true;\n      }\n\n      if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) && !this.imgResizeDiv.classList.contains('e-mob-span')) {\n        addClass([this.imgResizeDiv], 'e-mob-span');\n      } else {\n        var args = {\n          event: e,\n          requestType: 'images'\n        };\n        this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n          if (resizeStartArgs.cancel) {\n            _this.cancelResizeAction();\n          }\n        });\n      }\n\n      EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n    }\n  };\n\n  Image.prototype.imageClick = function (e) {\n    if (Browser.isDevice) {\n      if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A' || e.target.tagName === 'IMG') {\n        this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n        e.target.focus();\n      } else {\n        if (!this.parent.readonly) {\n          this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n        }\n      }\n    }\n\n    if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A') {\n      e.preventDefault();\n    }\n  };\n\n  Image.prototype.onCutHandler = function () {\n    if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n  };\n\n  Image.prototype.imageResize = function (e) {\n    this.resizeBtnInit();\n    this.imgEle = e;\n    addClass([this.imgEle], 'e-resize');\n    this.imgResizeDiv = this.parent.createElement('span', {\n      className: 'e-img-resize',\n      id: this.rteID + '_imgResize'\n    });\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topLeft',\n      styles: 'cursor: nwse-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topRight',\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botLeft',\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botRight',\n      styles: 'cursor: nwse-resize'\n    }));\n\n    if (Browser.isDevice) {\n      addClass([this.imgResizeDiv], 'e-mob-rte');\n    }\n\n    e.style.outline = '2px solid #4a90e2';\n    this.imgResizePos(e, this.imgResizeDiv);\n    this.resizeImgDupPos(e);\n    this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n    EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n  };\n\n  Image.prototype.getPointX = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageX;\n    } else {\n      return e.pageX;\n    }\n  };\n\n  Image.prototype.getPointY = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageY;\n    } else {\n      return e.pageY;\n    }\n  };\n\n  Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n    var pos = this.calcPos(e);\n    var top = pos.top;\n    var left = pos.left;\n    var imgWid = e.width;\n    var imgHgt = e.height;\n    var borWid = Browser.isDevice ? 4 * parseInt(e.style.outline.slice(-3), 10) + 2 : 2 * parseInt(e.style.outline.slice(-3), 10) + 2; //span border width + image outline width\n\n    var devWid = Browser.isDevice ? 0 : 2; // span border width\n\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.top = top - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.top = top - borWid + 'px';\n  };\n\n  Image.prototype.calcPos = function (elem) {\n    var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n    var parentOffset = {\n      top: 0,\n      left: 0\n    };\n    var doc = elem.ownerDocument;\n    var offsetParent = (elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') || ignoreOffset.indexOf(elem.offsetParent.tagName) > -1) ? closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n\n    while (offsetParent && (offsetParent === doc.body || offsetParent === doc.documentElement) && offsetParent.style.position === 'static') {\n      offsetParent = offsetParent.parentNode;\n    }\n\n    if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n      // eslint-disable-next-line\n      parentOffset = offsetParent.getBoundingClientRect();\n    }\n\n    return {\n      top: elem.offsetTop,\n      left: elem.offsetLeft\n    };\n  };\n\n  Image.prototype.setAspectRatio = function (img, expectedX, expectedY) {\n    if (isNullOrUndefined(img.width)) {\n      return;\n    }\n\n    var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) : parseInt(img.style.width, 10) : img.width;\n    var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n\n    if (width > height) {\n      img.style.minWidth = '20px';\n\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          var percentageValue = this.pixToPerc(width / height * expectedY, img.previousElementSibling || img.parentElement);\n          img.style.width = Math.min(Math.round(percentageValue / img.getBoundingClientRect().width * expectedX * 100) / 100, 100) + '%';\n        } else {\n          img.style.width = this.pixToPerc(width / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width === '' && img.style.height !== '') {\n        img.style.height = expectedY + 'px';\n      } else if (img.style.width !== '' && img.style.height === '') {\n        var currentWidth = width / height * expectedY + width / height < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY + width / height : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth.toString() + 'px';\n      } else if (img.style.width !== '') {\n        var currentWidth = width / height * expectedY < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth + 'px';\n        img.style.height = expectedY + 'px';\n      } else {\n        img.setAttribute('width', (width / height * expectedY + width / height).toString());\n      }\n    } else if (height > width) {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          img.style.width = Math.min(Math.round(width / img.getBoundingClientRect().width * expectedX * 100) / 100, 100) + '%';\n        } else {\n          img.style.width = this.pixToPerc(expectedX / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width !== '') {\n        img.style.width = expectedX + 'px';\n        img.style.height = height / width * expectedX + 'px';\n      } else {\n        img.setAttribute('width', expectedX.toString());\n      }\n    } else {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        img.style.width = this.pixToPerc(expectedX, img.previousElementSibling || img.parentElement) + '%';\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width !== '') {\n        img.style.width = expectedX + 'px';\n        img.style.height = expectedX + 'px';\n      } else {\n        img.setAttribute('width', expectedX.toString());\n        img.setAttribute('height', expectedX.toString());\n      }\n    }\n  };\n\n  Image.prototype.pixToPerc = function (expected, parentEle) {\n    return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n  };\n\n  Image.prototype.imgDupMouseMove = function (width, height, e) {\n    var _this = this;\n\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.onResize, args, function (resizingArgs) {\n      if (resizingArgs.cancel) {\n        _this.cancelResizeAction();\n      } else {\n        if (parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) || parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) && isNOU(_this.imgEle.style.width)) {\n          return;\n        }\n\n        if (!_this.parent.insertImageSettings.resizeByPercent && (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) || parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n          return;\n        }\n\n        _this.imgEle.parentElement.style.cursor = 'pointer';\n\n        _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10));\n\n        _this.resizeImgDupPos(_this.imgEle);\n\n        _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n\n        _this.parent.setContentHeight('', false);\n      }\n    });\n  };\n\n  Image.prototype.resizing = function (e) {\n    if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n      this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n    }\n\n    var pageX = this.getPointX(e);\n    var pageY = this.getPointY(e);\n    var mouseX = this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft ? -(pageX - this.pageX) : pageX - this.pageX;\n    var mouseY = this.resizeBtnStat.topLeft || this.resizeBtnStat.topRight ? -(pageY - this.pageY) : pageY - this.pageY;\n    var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n    var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n    this.pageX = pageX;\n    this.pageY = pageY;\n\n    if (this.resizeBtnStat.botRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.botLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    }\n  };\n\n  Image.prototype.cancelResizeAction = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n\n    if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      detach(this.imgResizeDiv);\n      this.imgEle.style.outline = '';\n      this.imgResizeDiv = null;\n      this.pageX = null;\n      this.pageY = null;\n    }\n  };\n\n  Image.prototype.resizeImgDupPos = function (e) {\n    this.imgDupPos = {\n      width: e.style.width !== '' ? this.imgEle.style.width : e.width + 'px',\n      height: e.style.height !== '' ? this.imgEle.style.height : e.height + 'px'\n    };\n  };\n\n  Image.prototype.resizeBtnInit = function () {\n    return this.resizeBtnStat = {\n      botLeft: false,\n      botRight: false,\n      topRight: false,\n      topLeft: false\n    };\n  };\n\n  Image.prototype.onToolbarAction = function (args) {\n    if (isIDevice()) {\n      this.parent.notify(events.selectionRestore, {});\n    }\n\n    var item = args.args.item;\n\n    switch (item.subCommand) {\n      case 'Replace':\n        if (this.parent.fileManagerSettings.enable) {\n          this.parent.notify(events.renderFileManager, args);\n        } else {\n          this.parent.notify(events.insertImage, args);\n        }\n\n        break;\n\n      case 'Caption':\n        this.parent.notify(events.imageCaption, args);\n        break;\n\n      case 'InsertLink':\n        this.parent.notify(events.imageLink, args);\n        break;\n\n      case 'AltText':\n        this.parent.notify(events.imageAlt, args);\n        break;\n\n      case 'Remove':\n        this.parent.notify(events.imageDelete, args);\n        break;\n\n      case 'Dimension':\n        this.parent.notify(events.imageSize, args);\n        break;\n\n      case 'OpenImageLink':\n        this.openImgLink(args);\n        break;\n\n      case 'EditImageLink':\n        this.editImgLink(args);\n        break;\n\n      case 'RemoveImageLink':\n        this.removeImgLink(args);\n        break;\n    }\n  };\n\n  Image.prototype.openImgLink = function (e) {\n    var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      url: e.selectParent[0].parentNode.href,\n      target: target,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n  };\n\n  Image.prototype.editImgLink = function (e) {\n    var selectParentEle = e.selectParent[0].parentNode;\n    var linkUpdate = this.i10n.getConstant('dialogUpdate');\n    var inputDetails = {\n      url: selectParentEle.href,\n      target: selectParentEle.target,\n      header: 'Edit Link',\n      btnText: linkUpdate\n    };\n    this.insertImgLink(e, inputDetails);\n  };\n\n  Image.prototype.removeImgLink = function (e) {\n    if (Browser.isIE) {\n      this.contentModule.getEditPanel().focus();\n    }\n\n    e.selection.restore();\n    var isCapLink = this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle) ? true : false;\n    var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      insertElement: e.selectNode[0],\n      selectParent: selectParent,\n      selection: e.selection,\n      subCommand: e.args.item.subCommand\n    });\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n\n      if (!isNullOrUndefined(e.selectParent)) {\n        removeClass([e.selectParent[0]], 'e-img-focus');\n      }\n    }\n\n    if (isCapLink) {\n      select('.e-img-inner', this.captionEle).focus();\n    }\n  };\n\n  Image.prototype.onKeyDown = function (event) {\n    var originalEvent = event.args;\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    this.deletedImg = [];\n    var isCursor;\n    var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n\n    if (this.parent.editorMode === 'HTML') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n    }\n\n    if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n      var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n\n      for (var i = 0; i < nodes.length; i++) {\n        if (nodes[i].nodeName === 'IMG') {\n          this.deletedImg.push(nodes[i]);\n        }\n      }\n    }\n\n    if (this.parent.editorMode === 'HTML' && (originalEvent.which === 8 && originalEvent.code === 'Backspace' || originalEvent.which === 46 && originalEvent.code === 'Delete')) {\n      var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n\n      if (originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1) {\n        this.checkImageBack(range);\n      } else if (originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1) {\n        this.checkImageDel(range);\n      }\n    }\n\n    if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) && originalEvent.code !== 'KeyK') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n\n      if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') && selectParentEle[0].tagName === 'IMG' && selectParentEle[0].parentElement) {\n        var prev = selectParentEle[0].parentElement.childNodes[0];\n\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n          this.removeResizeEle();\n        }\n\n        this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n        removeClass([selectParentEle[0]], 'e-img-focus');\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n\n    if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n      this.undoStack({\n        subCommand: originalEvent.keyCode === 90 ? 'undo' : 'redo'\n      });\n    }\n\n    if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n      if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n        originalEvent.preventDefault();\n        var event_1 = {\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle,\n          args: {\n            item: {\n              command: 'Images',\n              subCommand: 'Remove'\n            },\n            originalEvent: originalEvent\n          }\n        };\n        this.deleteImg(event_1, originalEvent.keyCode);\n      }\n\n      if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        this.removeResizeEle();\n      }\n    }\n\n    if (originalEvent.code === 'Backspace') {\n      originalEvent.action = 'backspace';\n    }\n\n    switch (originalEvent.action) {\n      case 'escape':\n        if (!isNullOrUndefined(this.dialogObj)) {\n          this.dialogObj.close();\n        }\n\n        break;\n\n      case 'backspace':\n      case 'delete':\n        for (var i = 0; i < this.deletedImg.length; i++) {\n          var src = this.deletedImg[i].src;\n          this.imageRemovePost(src);\n        }\n\n        if (range.startContainer.nodeType === 3) {\n          if (originalEvent.code === 'Backspace') {\n            if (range.startContainer.previousElementSibling && range.startOffset === 0 && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n              detach(range.startContainer.previousElementSibling);\n            }\n          } else {\n            if (range.startContainer.nextElementSibling && range.endContainer.textContent.length === range.endOffset && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n              detach(range.startContainer.nextElementSibling);\n            }\n          }\n        } else if (range.startContainer.nodeType === 1 && range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE)) {\n          detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n        }\n\n        break;\n\n      case 'insert-image':\n        this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n        originalEvent.preventDefault();\n        break;\n    }\n  };\n\n  Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n\n    if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = selection;\n      selectNodeEle = ele;\n      selectParentEle = parentEle;\n    }\n\n    if (this.parent.editorMode === 'HTML') {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event\n        },\n        selectNode: selectNodeEle,\n        selection: save,\n        selectParent: selectParentEle\n      });\n    } else {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event\n        },\n        member: 'image',\n        text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n        module: 'Markdown',\n        name: 'insertImage'\n      });\n    }\n  };\n\n  Image.prototype.showDialog = function () {\n    this.openDialog(false);\n  };\n\n  Image.prototype.closeDialog = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.onKeyUp = function (event) {\n    if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n      for (var i = 0; i < this.deletedImg.length; i++) {\n        var args = {\n          element: this.deletedImg[i],\n          src: this.deletedImg[i].getAttribute('src')\n        };\n        this.parent.trigger(events.afterImageDelete, args);\n      }\n    }\n  };\n\n  Image.prototype.checkImageBack = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === 0 && !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.previousSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) && range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n    }\n  };\n\n  Image.prototype.checkImageDel = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length && !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.nextSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) && range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n    }\n  };\n\n  Image.prototype.alignmentSelect = function (e) {\n    var item = e.item;\n\n    if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n      return;\n    }\n\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n    selectNodeEle = selectNodeEle[0].nodeName === 'IMG' ? selectNodeEle : [this.imgEle];\n    var args = {\n      args: e,\n      selectNode: selectNodeEle\n    };\n\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    switch (item.subCommand) {\n      case 'JustifyLeft':\n        this.alignImage(args, 'JustifyLeft');\n        break;\n\n      case 'JustifyCenter':\n        this.alignImage(args, 'JustifyCenter');\n        break;\n\n      case 'JustifyRight':\n        this.alignImage(args, 'JustifyRight');\n        break;\n\n      case 'Inline':\n        this.inline(args);\n        break;\n\n      case 'Break':\n        this.break(args);\n        break;\n    }\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNodeEle[0]], 'e-img-focus');\n    }\n\n    this.cancelResizeAction();\n  };\n\n  Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n    var separator;\n    var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n\n    for (var i = 0; i < items.length; i++) {\n      if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n        addClass([items[i]], 'e-link-groups');\n        items[i].style.display = 'none';\n      } else if (items[i].getAttribute('title') === 'Insert Link') {\n        items[i].style.display = '';\n      } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n        // eslint-disable-next-line\n        separator = items[i];\n        detach(items[i]);\n      }\n    }\n\n    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n  };\n\n  Image.prototype.showImageQuickToolbar = function (e) {\n    var _this = this;\n\n    if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule) || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n      return;\n    }\n\n    this.quickToolObj = this.parent.quickToolbarModule;\n    var args = e.args;\n    var target = e.elements;\n    [].forEach.call(e.elements, function (element, index) {\n      if (index === 0) {\n        target = element;\n      }\n    });\n\n    if (target && !closest(target, 'a')) {\n      this.imageWithLinkQTBarItemUpdate();\n    }\n\n    if (target.nodeName === 'IMG') {\n      addClass([target], ['e-img-focus']);\n    }\n\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n\n    if (this.parent.quickToolbarModule.imageQTBar) {\n      if (e.isNotify) {\n        setTimeout(function () {\n          _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n        }, 400);\n      } else {\n        this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n      }\n    }\n  };\n\n  Image.prototype.hideImageQuickToolbar = function () {\n    if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n      removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n\n      if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n  };\n\n  Image.prototype.editAreaClickHandler = function (e) {\n    if (this.parent.readonly) {\n      this.hideImageQuickToolbar();\n      return;\n    }\n\n    var args = e.args;\n    var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n\n    if (args.which === 2 || showOnRightClick && args.which === 1 || !showOnRightClick && args.which === 3) {\n      if (showOnRightClick && args.which === 1 && !isNullOrUndefined(args.target) && args.target.tagName === 'IMG') {\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n      }\n\n      return;\n    }\n\n    if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n      this.quickToolObj = this.parent.quickToolbarModule;\n      var target = args.target;\n      this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n      var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n\n      if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n        if (isPopupOpen) {\n          return;\n        }\n\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n\n        if (isIDevice()) {\n          this.parent.notify(events.selectionSave, e);\n        }\n\n        addClass([target], 'e-img-focus');\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        var separator = void 0;\n\n        if (closest(target, 'a')) {\n          for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n              items[i].style.display = '';\n              removeClass([items[i]], 'e-link-groups');\n            } else if (items[i].getAttribute('title') === 'Insert Link') {\n              items[i].style.display = 'none';\n            } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n              // eslint-disable-next-line\n              separator = items[i];\n              detach(items[i]);\n            }\n          }\n\n          var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n          this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n        } else if (!closest(target, 'a')) {\n          this.imageWithLinkQTBarItemUpdate();\n        }\n\n        this.showImageQuickToolbar({\n          args: args,\n          type: 'Images',\n          elements: [args.target]\n        });\n      } else {\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n\n  Image.prototype.insertImgLink = function (e, inputDetails) {\n    var _this = this;\n\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    this.imagDialog(e);\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var linkWrap = this.parent.createElement('div', {\n        className: 'e-img-linkwrap'\n      });\n      var linkUrl = this.i10n.getConstant('linkurl');\n      var content = '<div class=\"e-rte-field\">' + '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' + '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' + '<input type=\"checkbox\" class=\"e-rte-linkTarget\"  data-role =\"none\"></div>';\n      var contentElem = parseHtml(content);\n      linkWrap.appendChild(contentElem);\n      var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n      var inputLink = linkWrap.querySelector('.e-img-link');\n      var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n      this.checkBoxObj = new CheckBox({\n        label: linkOpenLabel,\n        checked: true,\n        enableRtl: this.parent.enableRtl,\n        change: function (e) {\n          if (e.checked) {\n            target_1 = '_blank';\n          } else {\n            target_1 = null;\n          }\n        }\n      });\n      this.checkBoxObj.isStringTemplate = true;\n      this.checkBoxObj.createElement = this.parent.createElement;\n      this.checkBoxObj.appendTo(linkTarget);\n      var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var linkargs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        selectParent: e.selectParent,\n        link: inputLink,\n        target: target_1\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n        content: linkWrap,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertlink(linkargs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-link',\n            isPrimary: true\n          }\n        }]\n      });\n\n      if (!isNullOrUndefined(inputDetails)) {\n        inputLink.value = inputDetails.url; // eslint-disable-next-line\n\n        inputDetails.target ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n        this.dialogObj.header = inputDetails.header;\n      }\n\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n\n  Image.prototype.insertAltText = function (e) {\n    var _this = this;\n\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    this.imagDialog(e);\n    var altText = this.i10n.getConstant('altText');\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var altWrap = this.parent.createElement('div', {\n        className: 'e-img-altwrap'\n      });\n      var altHeader = this.i10n.getConstant('alternateHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var getAlt = e.selectNode[0].getAttribute('alt') === null ? '' : e.selectNode[0].getAttribute('alt');\n      var content = '<div class=\"e-rte-field\">' + '<input type=\"text\" spellcheck=\"false\" value=\"' + getAlt + '\" class=\"e-input e-img-alt\" placeholder=\"' + altText + '\"/>' + '</div>';\n      var contentElem = parseHtml(content);\n      altWrap.appendChild(contentElem);\n      var inputAlt = altWrap.querySelector('.e-img-alt');\n      var altArgs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        alt: inputAlt\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: altHeader,\n        content: altWrap,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertAlt(altArgs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-alt',\n            isPrimary: true\n          }\n        }]\n      });\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n\n  Image.prototype.insertAlt = function (e) {\n    if (!isNullOrUndefined(e.alt)) {\n      e.selection.restore();\n\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n\n      var altText = e.alt.value;\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        altText: altText,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      this.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n\n  Image.prototype.insertlink = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var url = e.link.value;\n\n    if (url === '') {\n      addClass([e.link], 'e-error');\n      e.link.setSelectionRange(0, url.length);\n      e.link.focus();\n      return;\n    }\n\n    if (!this.isUrl(url)) {\n      url = 'http://' + url;\n    } else {\n      removeClass([e.link], 'e-error');\n    }\n\n    var proxy = e.selfImage;\n\n    if (proxy.parent.editorMode === 'HTML') {\n      e.selection.restore();\n    }\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    if (e.selectNode[0].parentElement.nodeName === 'A') {\n      proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n        url: url,\n        target: proxy.checkBoxObj.checked ? '_blank' : null,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      proxy.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n\n    proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n      url: url,\n      target: proxy.checkBoxObj.checked ? '_blank' : null,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand,\n      selection: e.selection\n    });\n    var captionEle = closest(e.selectNode[0], '.e-img-caption');\n\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n\n    proxy.dialogObj.hide({\n      returnValue: false\n    });\n  };\n\n  Image.prototype.isUrl = function (url) {\n    // eslint-disable-next-line\n    var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n    return regexp.test(url);\n  };\n\n  Image.prototype.deleteImg = function (e, keyCode) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var args = {\n      element: e.selectNode[0],\n      src: e.selectNode[0].getAttribute('src')\n    };\n\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    e.selection.restore();\n\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n      this.removeResizeEle();\n    }\n\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      captionClass: classes.CLS_CAPTION,\n      subCommand: e.args.item.subCommand\n    });\n    this.imageRemovePost(args.src);\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n    }\n\n    this.cancelResizeAction();\n\n    if (isNullOrUndefined(keyCode)) {\n      this.parent.trigger(events.afterImageDelete, args);\n    }\n  };\n\n  Image.prototype.imageRemovePost = function (src) {\n    var proxy = this;\n    var absoluteUrl = '';\n\n    if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n      return;\n    }\n\n    if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n      absoluteUrl = src;\n    } else {\n      absoluteUrl = new URL(src, document.baseURI).href;\n    }\n\n    this.removingImgName = absoluteUrl.replace(/^.*[\\\\\\/]/, '');\n    var xhr = new XMLHttpRequest();\n    xhr.addEventListener(\"readystatechange\", function () {\n      if (this.readyState == 4 && this.status == 200) {\n        proxy.triggerPost(this.response);\n      }\n    });\n    xhr.open('GET', absoluteUrl);\n    xhr.responseType = 'blob';\n    xhr.send();\n  };\n\n  Image.prototype.triggerPost = function (response) {\n    var removeUrl = this.parent.insertImageSettings.removeUrl;\n\n    if (isNOU(removeUrl) || removeUrl === '') {\n      return;\n    }\n\n    var file = new File([response], this.removingImgName);\n    var ajax = new Ajax(removeUrl, 'POST', true, null);\n    var formData = new FormData();\n    formData.append('UploadFiles', file);\n    ajax.send(formData);\n  };\n\n  Image.prototype.caption = function (e) {\n    var selectNode = e.selectNode[0];\n\n    if (selectNode.nodeName !== 'IMG') {\n      return;\n    }\n\n    e.selection.restore();\n\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    this.cancelResizeAction();\n    addClass([selectNode], 'e-rte-image');\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Caption';\n\n    if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n      detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n\n      if (Browser.isIE) {\n        this.contentModule.getEditPanel().focus();\n        e.selection.restore();\n      }\n\n      if (selectNode.parentElement.tagName === 'A') {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode.parentElement,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      } else {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      }\n    } else {\n      this.captionEle = this.parent.createElement('span', {\n        className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION,\n        attrs: {\n          contenteditable: 'false',\n          draggable: 'false',\n          style: 'width:' + this.parent.insertImageSettings.width\n        }\n      });\n      var imgWrap = this.parent.createElement('span', {\n        className: 'e-img-wrap'\n      });\n      var imgInner = this.parent.createElement('span', {\n        className: 'e-img-inner',\n        attrs: {\n          contenteditable: 'true'\n        }\n      });\n      var parent_1 = e.selectNode[0].parentElement;\n\n      if (parent_1.tagName === 'A') {\n        parent_1.setAttribute('contenteditable', 'true');\n      }\n\n      imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n      imgWrap.appendChild(imgInner);\n      var imgCaption = this.i10n.getConstant('imageCaption');\n      imgInner.innerHTML = imgCaption;\n      this.captionEle.appendChild(imgWrap);\n\n      if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n        addClass([this.captionEle], classes.CLS_CAPINLINE);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n        addClass([this.captionEle], classes.CLS_IMGBREAK);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n        addClass([this.captionEle], classes.CLS_IMGLEFT);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n        addClass([this.captionEle], classes.CLS_IMGRIGHT);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n        addClass([this.captionEle], classes.CLS_IMGCENTER);\n      }\n\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        insertElement: this.captionEle,\n        selectNode: e.selectNode,\n        subCommand: subCommand\n      });\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n    }\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNode], 'e-img-focus');\n    }\n  };\n\n  Image.prototype.imageSize = function (e) {\n    var _this = this;\n\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    this.imagDialog(e);\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var dialogContent = this.imgsizeInput(e);\n      var selectObj_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: imgSizeHeader,\n        content: dialogContent,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertSize(selectObj_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-size',\n            isPrimary: true\n          }\n        }]\n      });\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n\n  Image.prototype.break = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Break';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n\n  Image.prototype.inline = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Inline';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n\n  Image.prototype.alignImage = function (e, type) {\n    var subCommand = e.args.item ? e.args.item.subCommand : type;\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n\n  Image.prototype.clearDialogObj = function () {\n    if (this.dialogObj) {\n      this.dialogObj.destroy();\n      detach(this.dialogObj.element);\n      this.dialogObj = null;\n    }\n  };\n\n  Image.prototype.imagDialog = function (e) {\n    var _this = this;\n\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n\n    var imgDialog = this.parent.createElement('div', {\n      className: 'e-rte-img-dialog',\n      id: this.rteID + '_image'\n    });\n    this.parent.element.appendChild(imgDialog);\n    var imgInsert = this.i10n.getConstant('dialogInsert');\n    var imglinkCancel = this.i10n.getConstant('dialogCancel');\n    var imgHeader = this.i10n.getConstant('imageHeader');\n    var selection = e.selection;\n    var selectObj = {\n      selfImage: this,\n      selection: e.selection,\n      args: e.args,\n      selectParent: e.selectParent\n    };\n    var dialogModel = {\n      header: imgHeader,\n      cssClass: classes.CLS_RTE_ELEMENTS,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      showCloseIcon: true,\n      closeOnEscape: true,\n      width: Browser.isDevice ? '290px' : '340px',\n      height: 'inherit',\n      position: {\n        X: 'center',\n        Y: Browser.isDevice ? 'center' : 'top'\n      },\n      isModal: Browser.isDevice,\n      buttons: [{\n        click: this.insertImageUrl.bind(selectObj),\n        buttonModel: {\n          content: imgInsert,\n          cssClass: 'e-flat e-insertImage',\n          isPrimary: true,\n          disabled: true\n        }\n      }, {\n        click: function (e) {\n          _this.cancelDialog(e);\n        },\n        buttonModel: {\n          cssClass: 'e-flat e-cancel',\n          content: imglinkCancel\n        }\n      }],\n      target: Browser.isDevice ? document.body : this.parent.element,\n      animationSettings: {\n        effect: 'None'\n      },\n      close: function (event) {\n        if (_this.isImgUploaded) {\n          _this.uploadObj.removing();\n        }\n\n        _this.parent.isBlur = false;\n\n        if (event && event.event.returnValue) {\n          if (_this.parent.editorMode === 'HTML') {\n            selection.restore();\n          } else {\n            _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n          }\n        }\n\n        _this.dialogObj.destroy();\n\n        detach(_this.dialogObj.element);\n\n        _this.dialogRenderObj.close(event);\n\n        _this.dialogObj = null;\n      }\n    };\n    var dialogContent = this.parent.createElement('div', {\n      className: 'e-img-content'\n    });\n\n    if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n      dialogContent.appendChild(this.imgUpload(e));\n    }\n\n    var linkHeader = this.parent.createElement('div', {\n      className: 'e-linkheader'\n    });\n    var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n\n    if (this.parent.editorMode === 'HTML') {\n      linkHeader.innerHTML = linkHeaderText;\n    } else {\n      linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n    }\n\n    dialogContent.appendChild(linkHeader);\n    dialogContent.appendChild(this.imageUrlPopup(e));\n\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n      dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n      dialogModel.content = dialogContent;\n    } else {\n      dialogModel.content = dialogContent;\n    }\n\n    this.dialogObj = this.dialogRenderObj.render(dialogModel);\n    this.dialogObj.createElement = this.parent.createElement;\n    this.dialogObj.appendTo(imgDialog);\n\n    if (isNullOrUndefined(this.dialogObj)) {\n      return;\n    }\n\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && e.name === 'insertImage') {\n      this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n    }\n\n    imgDialog.style.maxHeight = 'inherit';\n\n    if (this.quickToolObj) {\n      if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n\n        if (!isNullOrUndefined(e.selectParent)) {\n          removeClass([e.selectParent[0]], 'e-img-focus');\n        }\n      }\n\n      if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n        this.quickToolObj.inlineQTBar.hidePopup();\n      }\n    }\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.cancelDialog = function (e) {\n    this.parent.isBlur = false;\n    this.dialogObj.hide({\n      returnValue: true\n    });\n\n    if (this.isImgUploaded) {\n      this.uploadObj.removing();\n    }\n  };\n\n  Image.prototype.onDocumentClick = function (e) {\n    var target = e.target;\n\n    if (target.nodeName === 'IMG') {\n      this.imgEle = target;\n    }\n\n    if (!isNullOrUndefined(this.dialogObj) && ( // eslint-disable-next-line\n    !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() && !this.parent.getToolbarElement().contains(e.target) || this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) && !closest(target, '#' + this.parent.getID() + '_toolbar_Image') && !target.querySelector('#' + this.parent.getID() + '_toolbar_Image'))) {\n      /* eslint-disable */\n      if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {} else {\n        this.dialogObj.hide({\n          returnValue: true\n        });\n        this.parent.isBlur = true;\n        dispatchEvent(this.parent.element, 'focusout');\n      }\n      /* eslint-enable */\n\n    }\n\n    if (e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj && this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n      if (target.tagName !== 'IMG') {\n        this.removeResizeEle();\n      }\n\n      if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n        this.imgEle.style.outline = '';\n      } else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n        this.prevSelectedImgEle.style.outline = '';\n      }\n    }\n  };\n\n  Image.prototype.removeResizeEle = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n    detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n  };\n\n  Image.prototype.onWindowResize = function () {\n    if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n      this.cancelResizeAction();\n    }\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.imageUrlPopup = function (e) {\n    var _this = this;\n\n    var imgUrl = this.parent.createElement('div', {\n      className: 'imgUrl'\n    });\n    var placeUrl = this.i10n.getConstant('imageUrl');\n    this.inputUrl = this.parent.createElement('input', {\n      className: 'e-input e-img-url',\n      attrs: {\n        placeholder: placeUrl,\n        spellcheck: 'false'\n      }\n    });\n    this.inputUrl.addEventListener('input', function () {\n      if (!isNOU(_this.inputUrl)) {\n        if (_this.inputUrl.value.length === 0) {\n          _this.dialogObj.getButtons(0).element.disabled = true;\n        } else {\n          _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n        }\n      }\n    });\n    imgUrl.appendChild(this.inputUrl);\n    return imgUrl;\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.insertImageUrl = function (e) {\n    var proxy = this.selfImage;\n    proxy.isImgUploaded = false;\n    var url = proxy.inputUrl.value;\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n      proxy.uploadUrl.cssClass = proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK;\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n      proxy.uploadUrl.url = '';\n\n      if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        proxy.imgEle.style.outline = '';\n        proxy.removeResizeEle();\n      }\n    } else if (url !== '') {\n      if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest( // eslint-disable-next-line\n      this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n        proxy.contentModule.getEditPanel().focus();\n        var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n        this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n        this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      }\n\n      var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n      var matchUrl = !isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML' ? url.match(regex)[0] : '';\n      var value = {\n        cssClass: proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n        url: url,\n        selection: this.selection,\n        altText: matchUrl,\n        selectParent: this.selectParent,\n        width: {\n          width: proxy.parent.insertImageSettings.width,\n          minWidth: proxy.parent.insertImageSettings.minWidth,\n          maxWidth: proxy.parent.getInsertImgMaxWidth()\n        },\n        height: {\n          height: proxy.parent.insertImageSettings.height,\n          minHeight: proxy.parent.insertImageSettings.minHeight,\n          maxHeight: proxy.parent.insertImageSettings.maxHeight\n        }\n      };\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n\n  Image.prototype.imgsizeInput = function (e) {\n    var _this = this;\n\n    var selectNode = e.selectNode[0];\n    var imgHeight = this.i10n.getConstant('imageHeight');\n    var imgWidth = this.i10n.getConstant('imageWidth');\n    var imgSizeWrap = this.parent.createElement('div', {\n      className: 'e-img-sizewrap'\n    });\n    var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' || selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ? this.changedWidthValue : parseInt(selectNode.getClientRects()[0].width.toString(), 10).toString();\n    var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' || selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ? this.changedHeightValue : parseInt(selectNode.getClientRects()[0].height.toString(), 10).toString();\n    this.changedWidthValue = null;\n    this.changedHeightValue = null;\n    var content = '<div class=\"e-rte-label\"><label>' + imgWidth + '</label></div><div class=\"e-rte-field\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width\" value=' + widthVal + ' /></div>' + '<div class=\"e-rte-label\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field\"> ' + '<input type=\"text\" id=\"imgheight\" class=\"e-img-height\" value=' + heightVal + ' /></div>';\n    var contentElem = parseHtml(content);\n    imgSizeWrap.appendChild(contentElem);\n    var widthNum = new TextBox({\n      value: formatUnit(widthVal),\n      enableRtl: this.parent.enableRtl,\n      input: function (e) {\n        _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    widthNum.createElement = this.parent.createElement;\n    widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n    var heightNum = new TextBox({\n      value: formatUnit(heightVal),\n      enableRtl: this.parent.enableRtl,\n      input: function (e) {\n        _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    heightNum.createElement = this.parent.createElement;\n    heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n    return imgSizeWrap;\n  };\n\n  Image.prototype.inputValue = function (value) {\n    if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1 || value.match(/(\\d+)/)) {\n      return value;\n    } else {\n      return 'auto';\n    }\n  };\n\n  Image.prototype.insertSize = function (e) {\n    e.selection.restore();\n    var proxy = e.selfImage;\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    var dialogEle = proxy.dialogObj.element;\n    this.changedWidthValue = this.inputWidthValue;\n    this.changedHeightValue = this.inputHeightValue;\n    var width = dialogEle.querySelector('.e-img-width').value;\n    var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n    proxy.parent.formatter.process(this.parent, e.args, e.args, {\n      width: width,\n      height: height,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n\n    if (this.imgResizeDiv) {\n      proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n    }\n\n    proxy.dialogObj.hide({\n      returnValue: true\n    });\n  };\n\n  Image.prototype.insertImage = function (e) {\n    this.imagDialog(e);\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n\n      if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n        document.getElementById(this.rteID + '_insertImage').focus();\n      } else {\n        dialogContent.querySelector('.e-img-url').focus();\n      }\n    }\n  };\n\n  Image.prototype.imgUpload = function (e) {\n    var _this = this;\n\n    var save;\n    var selectParent; // eslint-disable-next-line\n\n    var proxy = this;\n    var iframe = proxy.parent.iframeSettings.enable;\n\n    if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id=' // eslint-disable-next-line\n    + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']')) || iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib'))) {\n      this.contentModule.getEditPanel().focus();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = e.selection;\n      selectParent = e.selectParent;\n    }\n\n    var uploadParentEle = this.parent.createElement('div', {\n      className: 'e-img-uploadwrap e-droparea'\n    });\n    var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n    var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n    var span = this.parent.createElement('span', {\n      className: 'e-droptext'\n    });\n    var spanMsg = this.parent.createElement('span', {\n      className: 'e-rte-upload-text',\n      innerHTML: Browser.isDevice ? deviceImgUpMsg : imgUpMsg\n    });\n    span.appendChild(spanMsg);\n    var btnEle = this.parent.createElement('button', {\n      className: 'e-browsebtn',\n      id: this.rteID + '_insertImage',\n      attrs: {\n        autofocus: 'true',\n        type: 'button'\n      }\n    });\n    span.appendChild(btnEle);\n    uploadParentEle.appendChild(span);\n    var browserMsg = this.i10n.getConstant('browse');\n    var button = new Button({\n      content: browserMsg,\n      enableRtl: this.parent.enableRtl\n    });\n    button.isStringTemplate = true;\n    button.createElement = this.parent.createElement;\n    button.appendTo(btnEle);\n    var btnClick = Browser.isDevice ? span : btnEle;\n    EventHandler.add(btnClick, 'click', this.fileSelect, this);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    uploadParentEle.appendChild(uploadEle);\n    var altText;\n    var rawFile;\n    var selectArgs;\n    var filesData;\n    var beforeUploadArgs;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      dropArea: span,\n      multiple: false,\n      enableRtl: this.parent.enableRtl,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      selected: function (e) {\n        proxy.isImgUploaded = true;\n        selectArgs = e;\n        filesData = e.filesData;\n\n        if (_this.parent.isServerRendered) {\n          selectArgs = JSON.parse(JSON.stringify(e));\n          e.cancel = true;\n          rawFile = e.filesData;\n          selectArgs.filesData = rawFile;\n        }\n\n        _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n          if (!selectArgs.cancel) {\n            _this.checkExtension(selectArgs.filesData[0]);\n\n            altText = selectArgs.filesData[0].name;\n\n            if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n              var reader_1 = new FileReader(); // eslint-disable-next-line\n\n              reader_1.addEventListener('load', function (e) {\n                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result : URL.createObjectURL(convertToBlob(reader_1.result));\n                proxy.uploadUrl = {\n                  url: url,\n                  selection: save,\n                  altText: altText,\n                  selectParent: selectParent,\n                  width: {\n                    width: proxy.parent.insertImageSettings.width,\n                    minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                  },\n                  height: {\n                    height: proxy.parent.insertImageSettings.height,\n                    minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                  }\n                };\n                proxy.inputUrl.setAttribute('disabled', 'true');\n\n                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes && !isNullOrUndefined(_this.dialogObj)) {\n                  _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n              });\n              reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n            }\n\n            if (_this.parent.isServerRendered) {\n              /* eslint-disable */\n              _this.uploadObj._internalRenderSelect(selectArgs, rawFile);\n              /* eslint-enable */\n\n            }\n          }\n        });\n      },\n      beforeUpload: function (args) {\n        if (_this.parent.isServerRendered) {\n          beforeUploadArgs = JSON.parse(JSON.stringify(args));\n          beforeUploadArgs.filesData = filesData;\n          args.cancel = true;\n\n          _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n            if (beforeUploadArgs.cancel) {\n              return;\n            }\n            /* eslint-disable */\n\n\n            _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ? beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n            _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ? beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n\n            _this.uploadObj.uploadFiles(rawFile, null);\n            /* eslint-enable */\n\n          });\n        } else {\n          _this.parent.trigger(events.beforeImageUpload, args);\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          _this.parent.trigger(events.imageUploading, e);\n        }\n      },\n      success: function (e) {\n        _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n          if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n            var url = _this.parent.insertImageSettings.path + e.file.name; // eslint-disable-next-line\n\n            var value = {\n              url: url,\n              selection: save\n            };\n            proxy.uploadUrl = {\n              url: url,\n              selection: save,\n              altText: altText,\n              selectParent: selectParent,\n              width: {\n                width: proxy.parent.insertImageSettings.width,\n                minWidth: proxy.parent.insertImageSettings.minWidth,\n                maxWidth: proxy.parent.getInsertImgMaxWidth()\n              },\n              height: {\n                height: proxy.parent.insertImageSettings.height,\n                minHeight: proxy.parent.insertImageSettings.minHeight,\n                maxHeight: proxy.parent.insertImageSettings.maxHeight\n              }\n            };\n            proxy.inputUrl.setAttribute('disabled', 'true');\n          }\n\n          if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n            _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n          }\n        });\n      },\n      failure: function (e) {\n        _this.parent.trigger(events.imageUploadFailed, e);\n      },\n      removing: function () {\n        // eslint-disable-next-line\n        _this.parent.trigger(events.imageRemoving, e, function (e) {\n          proxy.isImgUploaded = false;\n          _this.dialogObj.getButtons(0).element.disabled = true;\n          proxy.inputUrl.removeAttribute('disabled');\n\n          if (proxy.uploadUrl) {\n            proxy.uploadUrl.url = '';\n          }\n        });\n      }\n    });\n    this.uploadObj.isStringTemplate = true;\n    this.uploadObj.createElement = this.parent.createElement;\n    this.uploadObj.appendTo(uploadEle);\n    return uploadParentEle;\n  };\n\n  Image.prototype.checkExtension = function (e) {\n    if (this.uploadObj.allowedExtensions) {\n      if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n        this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n        this.isAllowedTypes = false;\n      } else {\n        this.isAllowedTypes = true;\n      }\n    }\n  };\n\n  Image.prototype.fileSelect = function () {\n    this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n    return false;\n  };\n\n  Image.prototype.dragStart = function (e) {\n    if (e.target.nodeName === 'IMG') {\n      this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n        if (actionBeginArgs.cancel) {\n          e.preventDefault();\n        } else {\n          e.dataTransfer.effectAllowed = 'copyMove';\n          e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n        }\n      });\n    } else {\n      return true;\n    }\n  };\n\n  Image.prototype.dragEnter = function (e) {\n    e.dataTransfer.dropEffect = 'copy';\n    e.preventDefault();\n  };\n\n  Image.prototype.dragOver = function (e) {\n    if (Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1 || Browser.isIE && e.dataTransfer.types[0] === 'Files') {\n      e.preventDefault();\n    } else {\n      return true;\n    }\n  };\n  /**\n   * Used to set range When drop an image\n   *\n   * @param {ImageDropEventArgs} args - specifies the image arguments.\n   * @returns {void}\n   */\n\n\n  Image.prototype.dragDrop = function (args) {\n    var _this = this;\n\n    this.parent.trigger(events.beforeImageDrop, args, function (e) {\n      var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n\n      var isImgOrFileDrop = imgElement && imgElement.tagName === 'IMG' || e.dataTransfer.files.length > 0;\n\n      if (!e.cancel && isImgOrFileDrop) {\n        _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n          if (actionBeginArgs.cancel) {\n            e.preventDefault();\n          } else {\n            if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') || _this.parent.inputElement.contentEditable === 'false') {\n              e.preventDefault();\n              return;\n            }\n\n            if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n              detach(_this.imgResizeDiv);\n            }\n\n            e.preventDefault();\n            var range = void 0;\n\n            if (_this.contentModule.getDocument().caretRangeFromPoint) {\n              //For chrome\n              range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n            } else if (e.rangeParent) {\n              //For mozilla firefox\n              range = _this.contentModule.getDocument().createRange();\n              range.setStart(e.rangeParent, e.rangeOffset);\n            } else {\n              range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n            }\n\n            _this.parent.notify(events.selectRange, {\n              range: range\n            });\n\n            var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n\n            if (uploadArea) {\n              return;\n            }\n\n            _this.insertDragImage(e);\n          }\n        });\n      } else {\n        if (isImgOrFileDrop) {\n          e.preventDefault();\n        }\n      }\n    });\n  };\n  /**\n   * Used to calculate range on internet explorer\n   *\n   * @param {number} x - specifies the x range.\n   * @param {number} y - specifies the y range.\n   * @returns {void}\n   */\n\n\n  Image.prototype.getDropRange = function (x, y) {\n    var startRange = this.contentModule.getDocument().createRange();\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n    var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n    var startNode = elem.childNodes.length > 0 ? elem.childNodes[0] : elem;\n    var startCharIndexCharacter = 0;\n\n    if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n      startRange.setStart(startNode, startCharIndexCharacter);\n      startRange.setEnd(startNode, startCharIndexCharacter);\n    } else {\n      var rangeRect = void 0;\n\n      do {\n        startCharIndexCharacter++;\n        startRange.setStart(startNode, startCharIndexCharacter);\n        startRange.setEnd(startNode, startCharIndexCharacter + 1);\n        rangeRect = startRange.getBoundingClientRect();\n      } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n    }\n\n    return startRange;\n  };\n\n  Image.prototype.insertDragImage = function (e) {\n    var _this = this;\n\n    e.preventDefault();\n    var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n    this.parent.notify(events.drop, {\n      args: e\n    });\n\n    if (activePopupElement) {\n      activePopupElement.classList.add(classes.CLS_HIDE);\n    }\n\n    if (e.dataTransfer.files.length > 0) {\n      //For external image drag and drop\n      if (e.dataTransfer.files.length > 1) {\n        return;\n      }\n\n      var imgFiles = e.dataTransfer.files;\n      var fileName = imgFiles[0].name;\n      var imgType = fileName.substring(fileName.lastIndexOf('.'));\n      var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n\n      for (var i = 0; i < allowedTypes.length; i++) {\n        if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n          if (this.parent.insertImageSettings.saveUrl) {\n            this.onSelect(e);\n          } else {\n            var args = {\n              args: e,\n              text: '',\n              file: imgFiles[0]\n            };\n            e.preventDefault();\n            this.imagePaste(args);\n          }\n        }\n      }\n    } else {\n      //For internal image drag and drop\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n\n      if (imgElement && imgElement.tagName === 'IMG') {\n        if (imgElement.nextElementSibling) {\n          if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n            range.insertNode(imgElement.parentElement.parentElement);\n          } else {\n            range.insertNode(imgElement);\n          }\n        } else {\n          range.insertNode(imgElement);\n        }\n\n        imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n        var imgArgs_1 = {\n          elements: [imgElement]\n        };\n        imgElement.addEventListener('load', function () {\n          _this.parent.trigger(events.actionComplete, imgArgs_1);\n        });\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        var args = e;\n        this.resizeStart(args, imgElement);\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n\n  Image.prototype.onSelect = function (args) {\n    var _this = this; // eslint-disable-next-line\n\n\n    var proxy = this;\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var parentElement = this.parent.createElement('ul', {\n      className: classes.CLS_UPLOAD_FILES\n    });\n    this.parent.element.appendChild(parentElement);\n    var validFiles = {\n      name: '',\n      size: 0,\n      status: '',\n      statusCode: '',\n      type: '',\n      rawFile: args.dataTransfer.files[0],\n      validationMessages: {}\n    };\n    var imageTag = this.parent.createElement('IMG');\n    imageTag.style.opacity = '0.5';\n    imageTag.classList.add(classes.CLS_RTE_IMAGE);\n    imageTag.classList.add(classes.CLS_IMGINLINE);\n    imageTag.classList.add(classes.CLS_RESIZE);\n    var file = validFiles.rawFile;\n    var reader = new FileReader();\n    reader.addEventListener('load', function () {\n      var url = URL.createObjectURL(convertToBlob(reader.result));\n      imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n    });\n\n    if (file) {\n      reader.readAsDataURL(file);\n    }\n\n    range.insertNode(imageTag);\n    this.uploadMethod(args, imageTag);\n    var e = {\n      elements: [imageTag]\n    };\n    imageTag.addEventListener('load', function () {\n      _this.parent.trigger(events.actionComplete, e);\n    });\n    detach(parentElement);\n  };\n  /**\n   * Rendering uploader and popup for drag and drop\n   *\n   * @param {DragEvent} dragEvent - specifies the event.\n   * @param {HTMLImageElement} imageElement - specifies the element.\n   * @returns {void}\n   */\n\n\n  Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n    var _this = this;\n\n    var isUploading = false; // eslint-disable-next-line\n\n    var proxy = this;\n    var popupEle = this.parent.createElement('div');\n    this.parent.element.appendChild(popupEle);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n    this.popupObj = new Popup(popupEle, {\n      relateTo: imageElement,\n      height: '85px',\n      width: '300px',\n      offsetY: offsetY,\n      content: uploadEle,\n      viewPortElement: this.parent.element,\n      position: {\n        X: 'center',\n        Y: 'top'\n      },\n      enableRtl: this.parent.enableRtl,\n      zIndex: 10001,\n      // eslint-disable-next-line\n      close: function (event) {\n        _this.parent.isBlur = false;\n\n        _this.popupObj.destroy();\n\n        detach(_this.popupObj.element);\n        _this.popupObj = null;\n\n        if (!_this.parent.inlineMode.enable) {\n          _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n        }\n      }\n    });\n    this.popupObj.element.style.display = 'none';\n    addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n    addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n    setTimeout(function () {\n      proxy.refreshPopup(imageElement);\n    }, timeOut);\n    var rawFile;\n    var beforeUploadArgs;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      cssClass: classes.CLS_RTE_DIALOG_UPLOAD,\n      dropArea: this.parent.element,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      removing: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n\n        _this.popupObj.close();\n      },\n      canceling: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n\n        _this.popupObj.close();\n\n        _this.quickToolObj.imageQTBar.hidePopup();\n\n        setTimeout(function () {\n          _this.uploadObj.destroy();\n        }, 900);\n      },\n      beforeUpload: function (args) {\n        if (_this.parent.isServerRendered) {\n          beforeUploadArgs = JSON.parse(JSON.stringify(args));\n          beforeUploadArgs.filesData = rawFile;\n          isUploading = true;\n          args.cancel = true;\n\n          _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n            if (beforeUploadArgs.cancel) {\n              return;\n            }\n\n            if (!_this.parent.inlineMode.enable) {\n              _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n            }\n            /* eslint-disable */\n\n\n            _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ? beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n            _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ? beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n\n            _this.uploadObj.uploadFiles(rawFile, null);\n\n            _this.parent.inputElement.contentEditable = 'false';\n            /* eslint-enable */\n          });\n        } else {\n          _this.parent.trigger(events.beforeImageUpload, args);\n\n          if (!_this.parent.inlineMode.enable) {\n            _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n          }\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          isUploading = true;\n\n          _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n            if (imageUploadingArgs.cancel) {\n              if (!isNullOrUndefined(imageElement)) {\n                detach(imageElement);\n              }\n\n              if (!isNullOrUndefined(_this.popupObj.element)) {\n                detach(_this.popupObj.element);\n              }\n            } else {\n              _this.parent.inputElement.contentEditable = 'false';\n            }\n          });\n        }\n      },\n      selected: function (e) {\n        if (isUploading) {\n          e.cancel = true;\n        }\n\n        if (_this.parent.isServerRendered) {\n          rawFile = e.filesData;\n        }\n      },\n      failure: function (e) {\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadFailure(imageElement, args, e);\n        }, 900);\n      },\n      success: function (e) {\n        if (e.operation === \"cancel\") {\n          return;\n        }\n\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadSuccess(imageElement, dragEvent, args, e);\n        }, 900);\n      }\n    });\n    this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n    this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n    range.selectNodeContents(imageElement);\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n  };\n\n  Image.prototype.refreshPopup = function (imageElement) {\n    var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop + imageElement.offsetTop : imageElement.offsetTop;\n    var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n\n    if (imgPosition > rtePosition) {\n      this.popupObj.relateTo = this.parent.inputElement;\n      this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n      this.popupObj.element.style.display = 'block';\n    } else {\n      if (this.popupObj) {\n        this.popupObj.refreshPosition(imageElement);\n        this.popupObj.element.style.display = 'block';\n      }\n    }\n  };\n  /**\n   * Called when drop image upload was failed\n   *\n   * @param {HTMLElement} imgEle - specifies the image element.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {Object} e - specfies the object.\n   * @returns {void}\n   */\n\n\n  Image.prototype.uploadFailure = function (imgEle, args, e) {\n    detach(imgEle);\n\n    if (this.popupObj) {\n      this.popupObj.close();\n    }\n\n    this.parent.trigger(events.imageUploadFailed, e);\n    this.uploadObj.destroy();\n  };\n  /**\n   * Called when drop image upload was successful\n   *\n   * @param {HTMLElement} imageElement - specifies the image element.\n   * @param {DragEvent} dragEvent - specifies the drag event.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {ImageSuccessEventArgs} e - specifies the success event.\n   * @returns {void}\n   */\n\n\n  Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n    var _this = this;\n\n    imageElement.style.opacity = '1';\n    imageElement.classList.add(classes.CLS_IMG_FOCUS);\n    e.element = imageElement;\n    this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n      if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n        var url = _this.parent.insertImageSettings.path + e.file.name;\n        imageElement.src = url;\n        imageElement.setAttribute('alt', e.file.name);\n      }\n    });\n\n    if (this.popupObj) {\n      this.popupObj.close();\n      this.uploadObj.destroy();\n    }\n\n    this.showImageQuickToolbar(args);\n    this.resizeStart(dragEvent, imageElement);\n  };\n\n  Image.prototype.imagePaste = function (args) {\n    var _this = this;\n\n    if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n      // eslint-disable-next-line\n      var proxy_1 = this;\n      var reader_2 = new FileReader();\n      args.args.preventDefault(); // eslint-disable-next-line\n\n      reader_2.addEventListener('load', function (e) {\n        var url = {\n          cssClass: proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n          url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ? reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n          width: {\n            width: proxy_1.parent.insertImageSettings.width,\n            minWidth: proxy_1.parent.insertImageSettings.minWidth,\n            maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n          },\n          height: {\n            height: proxy_1.parent.insertImageSettings.height,\n            minHeight: proxy_1.parent.insertImageSettings.minHeight,\n            maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n          }\n        };\n\n        if (!isNullOrUndefined(args.callBack)) {\n          args.callBack(url);\n          return;\n        } else {\n          proxy_1.parent.formatter.process(proxy_1.parent, {\n            item: {\n              command: 'Images',\n              subCommand: 'Image'\n            }\n          }, args.args, url);\n\n          _this.showPopupToolBar(args, url);\n        }\n      });\n      reader_2.readAsDataURL(args.file);\n    }\n  };\n\n  Image.prototype.showPopupToolBar = function (e, url) {\n    var _this = this;\n\n    var imageSrc = 'img[src=\"' + url.url + '\"]';\n    var imageElement = this.parent.inputElement.querySelector(imageSrc);\n    this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n    var args = {\n      args: e.args,\n      type: 'Images',\n      isNotify: undefined,\n      elements: imageElement\n    };\n\n    if (imageElement) {\n      setTimeout(function () {\n        _this.showImageQuickToolbar(args);\n\n        _this.resizeStart(e.args, imageElement);\n      }, 0);\n    }\n  };\n  /* eslint-disable */\n\n  /**\n   * Destroys the ToolBar.\n   *\n   * @method destroy\n   * @returns {void}\n   * @hidden\n    */\n\n  /* eslint-enable */\n\n\n  Image.prototype.destroy = function () {\n    this.prevSelectedImgEle = undefined;\n    this.removeEventListener();\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {void}\n   */\n\n\n  Image.prototype.getModuleName = function () {\n    return 'image';\n  };\n\n  return Image;\n}();\n\nexport { Image };","map":{"version":3,"sources":["/Users/yasaman/Documents/moj_adminpanel/adminpanel/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/renderer/image-module.js"],"names":["addClass","detach","EventHandler","isNullOrUndefined","select","Ajax","formatUnit","Browser","closest","removeClass","isNOU","events","classes","Uploader","TextBox","Popup","Button","CheckBox","RenderType","dispatchEvent","parseHtml","hasClass","convertToBlob","isIDevice","Image","parent","serviceLocator","isImgUploaded","isAllowedTypes","pageX","pageY","deletedImg","rteID","element","id","i10n","getService","rendererFactory","dialogRenderObj","addEventListener","prototype","isDestroyed","on","keyDown","onKeyDown","keyUp","onKeyUp","insertImage","showImageDialog","showDialog","closeImageDialog","closeDialog","windowResize","onWindowResize","insertCompleted","showImageQuickToolbar","clearDialogObj","imageToolbarAction","onToolbarAction","imageCaption","caption","imageDelete","deleteImg","imageLink","insertImgLink","imageAlt","insertAltText","editAreaClick","editAreaClickHandler","iframeMouseDown","onIframeMouseDown","imageSize","dropDownSelect","alignmentSelect","initialEnd","afterRender","dynamicModule","paste","imagePaste","destroy","removeEventListener","off","dropElement","iframeSettings","enable","inputElement","ownerDocument","dragDrop","bind","dragStart","dragEnter","dragOver","contentModule","remove","getEditPanel","touchEndEvent","imageClick","formatter","editorManager","observer","checkUndo","undoStack","insertImageSettings","resize","touchStartEvent","resizeStart","onDocumentClick","onCutHandler","dialogObj","hide","returnValue","getRenderer","Content","add","args","subCommand","toLowerCase","i","getUndoRedoStack","length","temp","createElement","contentElem","text","appendChild","img","querySelectorAll","querySelector","j","style","outline","innerHTML","resizeEnd","e","resizeBtnInit","imgEle","parentElement","cursor","isDevice","target","event","requestType","trigger","resizeStop","getPointX","window","pageYOffset","getBoundingClientRect","top","clientY","saveData","ele","_this","readonly","prevSelectedImgEle","tagName","preventDefaultResize","imgResizeDiv","contains","imageResize","classList","getPointY","preventDefault","stopImmediatePropagation","quickToolObj","imageQTBar","hidePopup","resizeBtnStat","topLeft","topRight","botLeft","botRight","resizeStartArgs","cancel","cancelResizeAction","getDocument","setAttribute","focus","className","styles","imgResizePos","resizeImgDupPos","touchMoveEvent","resizing","touches","pos","calcPos","left","imgWid","width","imgHgt","height","borWid","parseInt","slice","devWid","elem","ignoreOffset","parentOffset","doc","offsetParent","indexOf","getID","documentElement","body","position","parentNode","nodeType","offsetTop","offsetLeft","setAspectRatio","expectedX","expectedY","match","parseFloat","minWidth","resizeByPercent","percentageValue","pixToPerc","previousElementSibling","Math","min","round","removeAttribute","currentWidth","right","toString","expected","parentEle","getComputedStyle","imgDupMouseMove","onResize","resizingArgs","getInsertImgMaxWidth","minHeight","maxHeight","setContentHeight","offsetWidth","offsetHeight","mouseX","mouseY","imgDupPos","notify","selectionRestore","item","fileManagerSettings","renderFileManager","openImgLink","editImgLink","removeImgLink","selectParent","process","url","href","selectNode","selectParentEle","linkUpdate","getConstant","inputDetails","header","btnText","isIE","selection","restore","isCapLink","captionEle","insertElement","document","originalEvent","range","save","selectNodeEle","isCursor","keyCodeValues","editorMode","nodeSelection","getRange","startContainer","endContainer","startOffset","endOffset","which","nodes","getNodeCollection","nodeName","push","code","isCursor_1","checkImageBack","checkImageDel","getParentNodeCollection","ctrlKey","key","action","prev","childNodes","removeResizeEle","setSelectionText","textContent","keyCode","event_1","command","close","src","imageRemovePost","CLS_CAPTION","CLS_CAPINLINE","nextElementSibling","openDialog","isInternal","member","markdownSelection","getSelectedText","module","name","getAttribute","afterImageDelete","previousSibling","nextSibling","alignImage","inline","break","imageWithLinkQTBarItemUpdate","separator","items","toolbarElement","display","newItems","addQTBarItem","type","quickToolbarModule","elements","forEach","call","index","isNotify","setTimeout","showPopup","hideImageQuickToolbar","showOnRightClick","quickToolbarSettings","Clear","setSelectionContents","isPopupOpen","selectionSave","imagDialog","linkWrap","linkUrl","content","linkTarget","inputLink","linkOpenLabel","checkBoxObj","label","checked","enableRtl","change","target_1","isStringTemplate","appendTo","linkargs_1","selfImage","link","setProperties","localeObj","X","Y","buttons","click","insertlink","buttonModel","cssClass","isPrimary","value","altText","altWrap","altHeader","getAlt","inputAlt","altArgs_1","alt","insertAlt","setSelectionRange","isUrl","proxy","regexp","test","captionClass","absoluteUrl","removeUrl","URL","baseURI","removingImgName","replace","xhr","XMLHttpRequest","readyState","status","triggerPost","response","open","responseType","send","file","File","ajax","formData","FormData","append","CLS_RTE_CAPTION","attrs","contenteditable","draggable","imgWrap","imgInner","parent_1","imgCaption","CLS_IMGINLINE","CLS_IMGBREAK","CLS_IMGLEFT","CLS_IMGRIGHT","CLS_IMGCENTER","imgSizeHeader","dialogContent","imgsizeInput","selectObj_1","insertSize","imgDialog","imgInsert","imglinkCancel","imgHeader","selectObj","dialogModel","CLS_RTE_ELEMENTS","locale","showCloseIcon","closeOnEscape","isModal","insertImageUrl","disabled","cancelDialog","animationSettings","effect","uploadObj","removing","isBlur","path","imgUpload","linkHeader","linkHeaderText","imageUrlPopup","render","inlineQTBar","toolbarSettings","getToolbarElement","offsetX","clientWidth","offsetY","clientHeight","imgUrl","placeUrl","inputUrl","placeholder","spellcheck","getButtons","uploadUrl","getPanel","regex","matchUrl","maxWidth","imgHeight","imgWidth","imgSizeWrap","widthVal","changedWidthValue","getClientRects","heightVal","changedHeightValue","widthNum","input","inputWidthValue","inputValue","heightNum","inputHeightValue","dialogEle","getElementById","iframe","uploadParentEle","deviceImgUpMsg","imgUpMsg","span","spanMsg","btnEle","autofocus","browserMsg","button","btnClick","fileSelect","uploadEle","rawFile","selectArgs","filesData","beforeUploadArgs","asyncSettings","saveUrl","dropArea","multiple","allowedExtensions","allowedTypes","selected","isServerRendered","JSON","parse","stringify","imageSelected","checkExtension","reader_1","FileReader","saveFormat","result","createObjectURL","readAsDataURL","_internalRenderSelect","beforeUpload","imageUploading","currentRequestHeader","currentRequest","customFormDatas","customFormData","uploadFiles","beforeImageUpload","uploading","success","imageUploadSuccess","operation","failure","imageUploadFailed","imageRemoving","toLocaleLowerCase","getElementsByClassName","actionBegin","actionBeginArgs","dataTransfer","effectAllowed","CLS_RTE_DRAG_IMAGE","dropEffect","info","split","types","beforeImageDrop","imgElement","isImgOrFileDrop","files","contentEditable","CLS_IMG_RESIZE","caretRangeFromPoint","clientX","rangeParent","createRange","setStart","rangeOffset","getDropRange","selectRange","uploadArea","CLS_DROPAREA","insertDragImage","x","y","startRange","setRange","elementFromPoint","startNode","startCharIndexCharacter","firstChild","setEnd","rangeRect","activePopupElement","CLS_POPUP_OPEN","drop","CLS_HIDE","imgFiles","fileName","imgType","substring","lastIndexOf","onSelect","CLS_IMG_INNER","insertNode","imgArgs_1","actionComplete","CLS_UPLOAD_FILES","validFiles","size","statusCode","validationMessages","imageTag","opacity","CLS_RTE_IMAGE","CLS_RESIZE","reader","uploadMethod","dragEvent","imageElement","isUploading","popupEle","popupObj","relateTo","viewPortElement","zIndex","inlineMode","toolbarModule","baseToolbar","toolbarObj","disable","CLS_RTE_UPLOAD_POPUP","timeOut","refreshPopup","CLS_RTE_DIALOG_UPLOAD","canceling","imageUploadingArgs","undefined","uploadFailure","uploadSuccess","selectNodeContents","imgPosition","rtePosition","refreshPosition","CLS_IMG_FOCUS","proxy_1","reader_2","callBack","showPopupToolBar","imageSrc","createQTBar","image","ImageToolbar","getModuleName"],"mappings":"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","sourcesContent":["import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\nvar Image = /** @class */ (function () {\n    function Image(parent, serviceLocator) {\n        this.isImgUploaded = false;\n        this.isAllowedTypes = true;\n        this.pageX = null;\n        this.pageY = null;\n        this.deletedImg = [];\n        this.parent = parent;\n        this.rteID = parent.element.id;\n        this.i10n = serviceLocator.getService('rteLocale');\n        this.rendererFactory = serviceLocator.getService('rendererFactory');\n        this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n        this.addEventListener();\n    }\n    Image.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.insertImage, this.insertImage, this);\n        this.parent.on(events.showImageDialog, this.showDialog, this);\n        this.parent.on(events.closeImageDialog, this.closeDialog, this);\n        this.parent.on(events.windowResize, this.onWindowResize, this);\n        this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n        this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n        this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n        this.parent.on(events.imageCaption, this.caption, this);\n        this.parent.on(events.imageDelete, this.deleteImg, this);\n        this.parent.on(events.imageLink, this.insertImgLink, this);\n        this.parent.on(events.imageAlt, this.insertAltText, this);\n        this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n        this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n        this.parent.on(events.imageSize, this.imageSize, this);\n        this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n        this.parent.on(events.initialEnd, this.afterRender, this);\n        this.parent.on(events.dynamicModule, this.afterRender, this);\n        this.parent.on(events.paste, this.imagePaste, this);\n        this.parent.on(events.destroy, this.removeEventListener, this);\n    };\n    Image.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.keyUp, this.onKeyUp);\n        this.parent.off(events.windowResize, this.onWindowResize);\n        this.parent.off(events.insertImage, this.insertImage);\n        this.parent.off(events.showImageDialog, this.showDialog);\n        this.parent.off(events.closeImageDialog, this.closeDialog);\n        this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n        this.parent.off(events.clearDialogObj, this.clearDialogObj);\n        this.parent.off(events.imageCaption, this.caption);\n        this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n        this.parent.off(events.imageDelete, this.deleteImg);\n        this.parent.off(events.imageLink, this.insertImgLink);\n        this.parent.off(events.imageAlt, this.insertAltText);\n        this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n        this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n        this.parent.off(events.imageSize, this.imageSize);\n        this.parent.off(events.dropDownSelect, this.alignmentSelect);\n        this.parent.off(events.initialEnd, this.afterRender);\n        this.parent.off(events.dynamicModule, this.afterRender);\n        this.parent.off(events.paste, this.imagePaste);\n        this.parent.off(events.destroy, this.removeEventListener);\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument\n            : this.parent.inputElement;\n        dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n        dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n        if (!isNullOrUndefined(this.contentModule)) {\n            EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n            this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n            if (this.parent.insertImageSettings.resize) {\n                EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n                EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n                EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n            }\n        }\n    };\n    Image.prototype.onIframeMouseDown = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    Image.prototype.afterRender = function () {\n        this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n        EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n        if (this.parent.insertImageSettings.resize) {\n            EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n            EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n            EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n        }\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument :\n            this.parent.inputElement;\n        dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n        dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n    };\n    Image.prototype.undoStack = function (args) {\n        if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n            for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n                var temp = this.parent.createElement('div');\n                var contentElem = parseHtml(this.parent.formatter.getUndoRedoStack()[i].text);\n                temp.appendChild(contentElem);\n                var img = temp.querySelectorAll('img');\n                if (temp.querySelector('.e-img-resize') && img.length > 0) {\n                    for (var j = 0; j < img.length; j++) {\n                        img[j].style.outline = '';\n                    }\n                    detach(temp.querySelector('.e-img-resize'));\n                    this.parent.formatter.getUndoRedoStack()[i].text = temp.innerHTML;\n                }\n            }\n        }\n    };\n    Image.prototype.resizeEnd = function (e) {\n        this.resizeBtnInit();\n        this.imgEle.parentElement.style.cursor = 'auto';\n        if (Browser.isDevice) {\n            removeClass([e.target.parentElement], 'e-mob-span');\n        }\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.resizeStop, args);\n        /* eslint-disable */\n        var pageX = this.getPointX(e);\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n        /* eslint-enable */\n        this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n        this.parent.formatter.saveData();\n    };\n    Image.prototype.resizeStart = function (e, ele) {\n        var _this = this;\n        if (this.parent.readonly) {\n            return;\n        }\n        var target = ele ? ele : e.target;\n        this.prevSelectedImgEle = this.imgEle;\n        if (target.tagName === 'IMG') {\n            this.parent.preventDefaultResize(e);\n            var img = target;\n            if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n                detach(this.imgResizeDiv);\n            }\n            this.imageResize(img);\n        }\n        if (target.classList.contains('e-rte-imageboxmark')) {\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            this.pageX = this.getPointX(e);\n            this.pageY = this.getPointY(e);\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.resizeBtnInit();\n            if (this.quickToolObj) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n            if (target.classList.contains('e-rte-topLeft')) {\n                this.resizeBtnStat.topLeft = true;\n            }\n            if (target.classList.contains('e-rte-topRight')) {\n                this.resizeBtnStat.topRight = true;\n            }\n            if (target.classList.contains('e-rte-botLeft')) {\n                this.resizeBtnStat.botLeft = true;\n            }\n            if (target.classList.contains('e-rte-botRight')) {\n                this.resizeBtnStat.botRight = true;\n            }\n            if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) &&\n                !this.imgResizeDiv.classList.contains('e-mob-span')) {\n                addClass([this.imgResizeDiv], 'e-mob-span');\n            }\n            else {\n                var args = { event: e, requestType: 'images' };\n                this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n                    if (resizeStartArgs.cancel) {\n                        _this.cancelResizeAction();\n                    }\n                });\n            }\n            EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n        }\n    };\n    Image.prototype.imageClick = function (e) {\n        if (Browser.isDevice) {\n            if ((e.target.tagName === 'IMG' &&\n                e.target.parentElement.tagName === 'A') ||\n                (e.target.tagName === 'IMG')) {\n                this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n                e.target.focus();\n            }\n            else {\n                if (!this.parent.readonly) {\n                    this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n                }\n            }\n        }\n        if (e.target.tagName === 'IMG' &&\n            e.target.parentElement.tagName === 'A') {\n            e.preventDefault();\n        }\n    };\n    Image.prototype.onCutHandler = function () {\n        if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n    };\n    Image.prototype.imageResize = function (e) {\n        this.resizeBtnInit();\n        this.imgEle = e;\n        addClass([this.imgEle], 'e-resize');\n        this.imgResizeDiv = this.parent.createElement('span', { className: 'e-img-resize', id: this.rteID + '_imgResize' });\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topLeft', styles: 'cursor: nwse-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topRight', styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botLeft', styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botRight', styles: 'cursor: nwse-resize'\n        }));\n        if (Browser.isDevice) {\n            addClass([this.imgResizeDiv], 'e-mob-rte');\n        }\n        e.style.outline = '2px solid #4a90e2';\n        this.imgResizePos(e, this.imgResizeDiv);\n        this.resizeImgDupPos(e);\n        this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n        EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n    };\n    Image.prototype.getPointX = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageX;\n        }\n        else {\n            return e.pageX;\n        }\n    };\n    Image.prototype.getPointY = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageY;\n        }\n        else {\n            return e.pageY;\n        }\n    };\n    Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n        var pos = this.calcPos(e);\n        var top = pos.top;\n        var left = pos.left;\n        var imgWid = e.width;\n        var imgHgt = e.height;\n        var borWid = (Browser.isDevice) ? (4 * parseInt((e.style.outline.slice(-3)), 10)) + 2 :\n            (2 * parseInt((e.style.outline.slice(-3)), 10)) + 2; //span border width + image outline width\n        var devWid = ((Browser.isDevice) ? 0 : 2); // span border width\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.top = (top - (borWid)) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.top = (top - borWid) + 'px';\n    };\n    Image.prototype.calcPos = function (elem) {\n        var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n        var parentOffset = { top: 0, left: 0 };\n        var doc = elem.ownerDocument;\n        var offsetParent = ((elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') ||\n            ignoreOffset.indexOf(elem.offsetParent.tagName) > -1)) ?\n            closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n        while (offsetParent &&\n            (offsetParent === doc.body || offsetParent === doc.documentElement) &&\n            offsetParent.style.position === 'static') {\n            offsetParent = offsetParent.parentNode;\n        }\n        if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n            // eslint-disable-next-line\n            parentOffset = offsetParent.getBoundingClientRect();\n        }\n        return {\n            top: elem.offsetTop,\n            left: elem.offsetLeft\n        };\n    };\n    Image.prototype.setAspectRatio = function (img, expectedX, expectedY) {\n        if (isNullOrUndefined(img.width)) {\n            return;\n        }\n        var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) :\n            parseInt(img.style.width, 10) : img.width;\n        var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n        if (width > height) {\n            img.style.minWidth = '20px';\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    var percentageValue = this.pixToPerc((width / height * expectedY), (img.previousElementSibling || img.parentElement));\n                    img.style.width = Math.min(Math.round((percentageValue / img.getBoundingClientRect().width) * expectedX * 100) / 100, 100) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((width / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width === '' && img.style.height !== '') {\n                img.style.height = expectedY + 'px';\n            }\n            else if (img.style.width !== '' && img.style.height === '') {\n                var currentWidth = ((width / height * expectedY) + width / height) < (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    ((width / height * expectedY) + width / height) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth.toString() + 'px';\n            }\n            else if (img.style.width !== '') {\n                var currentWidth = (width / height * expectedY) < (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    (width / height * expectedY) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth + 'px';\n                img.style.height = expectedY + 'px';\n            }\n            else {\n                img.setAttribute('width', ((width / height * expectedY) + width / height).toString());\n            }\n        }\n        else if (height > width) {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    img.style.width = Math.min(Math.round((width / img.getBoundingClientRect().width) * expectedX * 100) / 100, 100) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((expectedX / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width !== '') {\n                img.style.width = expectedX + 'px';\n                img.style.height = (height / width * expectedX) + 'px';\n            }\n            else {\n                img.setAttribute('width', expectedX.toString());\n            }\n        }\n        else {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                img.style.width = this.pixToPerc(expectedX, (img.previousElementSibling || img.parentElement)) + '%';\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width !== '') {\n                img.style.width = expectedX + 'px';\n                img.style.height = expectedX + 'px';\n            }\n            else {\n                img.setAttribute('width', expectedX.toString());\n                img.setAttribute('height', expectedX.toString());\n            }\n        }\n    };\n    Image.prototype.pixToPerc = function (expected, parentEle) {\n        return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n    };\n    Image.prototype.imgDupMouseMove = function (width, height, e) {\n        var _this = this;\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.onResize, args, function (resizingArgs) {\n            if (resizingArgs.cancel) {\n                _this.cancelResizeAction();\n            }\n            else {\n                if ((parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) ||\n                    (parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) &&\n                        isNOU(_this.imgEle.style.width)))) {\n                    return;\n                }\n                if (!_this.parent.insertImageSettings.resizeByPercent &&\n                    (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) ||\n                        parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n                    return;\n                }\n                _this.imgEle.parentElement.style.cursor = 'pointer';\n                _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10));\n                _this.resizeImgDupPos(_this.imgEle);\n                _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n                _this.parent.setContentHeight('', false);\n            }\n        });\n    };\n    Image.prototype.resizing = function (e) {\n        if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n            this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n        }\n        var pageX = this.getPointX(e);\n        var pageY = this.getPointY(e);\n        var mouseX = (this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft) ? -(pageX - this.pageX) : (pageX - this.pageX);\n        var mouseY = (this.resizeBtnStat.topLeft || this.resizeBtnStat.topRight) ? -(pageY - this.pageY) : (pageY - this.pageY);\n        var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n        var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n        this.pageX = pageX;\n        this.pageY = pageY;\n        if (this.resizeBtnStat.botRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.botLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n    };\n    Image.prototype.cancelResizeAction = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            detach(this.imgResizeDiv);\n            this.imgEle.style.outline = '';\n            this.imgResizeDiv = null;\n            this.pageX = null;\n            this.pageY = null;\n        }\n    };\n    Image.prototype.resizeImgDupPos = function (e) {\n        this.imgDupPos = {\n            width: (e.style.width !== '') ? this.imgEle.style.width : e.width + 'px',\n            height: (e.style.height !== '') ? this.imgEle.style.height : e.height + 'px'\n        };\n    };\n    Image.prototype.resizeBtnInit = function () {\n        return this.resizeBtnStat = { botLeft: false, botRight: false, topRight: false, topLeft: false };\n    };\n    Image.prototype.onToolbarAction = function (args) {\n        if (isIDevice()) {\n            this.parent.notify(events.selectionRestore, {});\n        }\n        var item = args.args.item;\n        switch (item.subCommand) {\n            case 'Replace':\n                if (this.parent.fileManagerSettings.enable) {\n                    this.parent.notify(events.renderFileManager, args);\n                }\n                else {\n                    this.parent.notify(events.insertImage, args);\n                }\n                break;\n            case 'Caption':\n                this.parent.notify(events.imageCaption, args);\n                break;\n            case 'InsertLink':\n                this.parent.notify(events.imageLink, args);\n                break;\n            case 'AltText':\n                this.parent.notify(events.imageAlt, args);\n                break;\n            case 'Remove':\n                this.parent.notify(events.imageDelete, args);\n                break;\n            case 'Dimension':\n                this.parent.notify(events.imageSize, args);\n                break;\n            case 'OpenImageLink':\n                this.openImgLink(args);\n                break;\n            case 'EditImageLink':\n                this.editImgLink(args);\n                break;\n            case 'RemoveImageLink':\n                this.removeImgLink(args);\n                break;\n        }\n    };\n    Image.prototype.openImgLink = function (e) {\n        var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            url: e.selectParent[0].parentNode.href, target: target, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n    };\n    Image.prototype.editImgLink = function (e) {\n        var selectParentEle = e.selectParent[0].parentNode;\n        var linkUpdate = this.i10n.getConstant('dialogUpdate');\n        var inputDetails = {\n            url: selectParentEle.href, target: selectParentEle.target,\n            header: 'Edit Link', btnText: linkUpdate\n        };\n        this.insertImgLink(e, inputDetails);\n    };\n    Image.prototype.removeImgLink = function (e) {\n        if (Browser.isIE) {\n            this.contentModule.getEditPanel().focus();\n        }\n        e.selection.restore();\n        var isCapLink = (this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle)) ?\n            true : false;\n        var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            insertElement: e.selectNode[0], selectParent: selectParent, selection: e.selection,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            if (!isNullOrUndefined(e.selectParent)) {\n                removeClass([e.selectParent[0]], 'e-img-focus');\n            }\n        }\n        if (isCapLink) {\n            select('.e-img-inner', this.captionEle).focus();\n        }\n    };\n    Image.prototype.onKeyDown = function (event) {\n        var originalEvent = event.args;\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        this.deletedImg = [];\n        var isCursor;\n        var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,\n            44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n        if (this.parent.editorMode === 'HTML') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n        }\n        if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n            var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            for (var i = 0; i < nodes.length; i++) {\n                if (nodes[i].nodeName === 'IMG') {\n                    this.deletedImg.push(nodes[i]);\n                }\n            }\n        }\n        if (this.parent.editorMode === 'HTML' && ((originalEvent.which === 8 && originalEvent.code === 'Backspace') ||\n            (originalEvent.which === 46 && originalEvent.code === 'Delete'))) {\n            var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n            if ((originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1)) {\n                this.checkImageBack(range);\n            }\n            else if ((originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1)) {\n                this.checkImageDel(range);\n            }\n        }\n        if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) &&\n            originalEvent.code !== 'KeyK') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') &&\n                (selectParentEle[0].tagName === 'IMG') && selectParentEle[0].parentElement) {\n                var prev = selectParentEle[0].parentElement.childNodes[0];\n                if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                    this.removeResizeEle();\n                }\n                this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n                removeClass([selectParentEle[0]], 'e-img-focus');\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n        if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n            this.undoStack({ subCommand: (originalEvent.keyCode === 90 ? 'undo' : 'redo') });\n        }\n        if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n            if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n                originalEvent.preventDefault();\n                var event_1 = {\n                    selectNode: selectNodeEle, selection: save, selectParent: selectParentEle,\n                    args: {\n                        item: { command: 'Images', subCommand: 'Remove' },\n                        originalEvent: originalEvent\n                    }\n                };\n                this.deleteImg(event_1, originalEvent.keyCode);\n            }\n            if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                this.removeResizeEle();\n            }\n        }\n        if (originalEvent.code === 'Backspace') {\n            originalEvent.action = 'backspace';\n        }\n        switch (originalEvent.action) {\n            case 'escape':\n                if (!isNullOrUndefined(this.dialogObj)) {\n                    this.dialogObj.close();\n                }\n                break;\n            case 'backspace':\n            case 'delete':\n                for (var i = 0; i < this.deletedImg.length; i++) {\n                    var src = this.deletedImg[i].src;\n                    this.imageRemovePost(src);\n                }\n                if (range.startContainer.nodeType === 3) {\n                    if (originalEvent.code === 'Backspace') {\n                        if (range.startContainer.previousElementSibling && range.startOffset === 0 &&\n                            range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                            range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                            detach(range.startContainer.previousElementSibling);\n                        }\n                    }\n                    else {\n                        if (range.startContainer.nextElementSibling &&\n                            range.endContainer.textContent.length === range.endOffset &&\n                            range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                            range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                            detach(range.startContainer.nextElementSibling);\n                        }\n                    }\n                }\n                else if ((range.startContainer.nodeType === 1 &&\n                    range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE))) {\n                    detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n                }\n                break;\n            case 'insert-image':\n                this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n                originalEvent.preventDefault();\n                break;\n        }\n    };\n    Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = selection;\n            selectNodeEle = ele;\n            selectParentEle = parentEle;\n        }\n        if (this.parent.editorMode === 'HTML') {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event\n                },\n                selectNode: selectNodeEle,\n                selection: save,\n                selectParent: selectParentEle\n            });\n        }\n        else {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event\n                },\n                member: 'image',\n                text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n                module: 'Markdown',\n                name: 'insertImage'\n            });\n        }\n    };\n    Image.prototype.showDialog = function () {\n        this.openDialog(false);\n    };\n    Image.prototype.closeDialog = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.onKeyUp = function (event) {\n        if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n            for (var i = 0; i < this.deletedImg.length; i++) {\n                var args = {\n                    element: this.deletedImg[i],\n                    src: this.deletedImg[i].getAttribute('src')\n                };\n                this.parent.trigger(events.afterImageDelete, args);\n            }\n        }\n    };\n    Image.prototype.checkImageBack = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === 0 &&\n            !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.previousSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) &&\n            range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n        }\n    };\n    Image.prototype.checkImageDel = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length &&\n            !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.nextSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) &&\n            range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n        }\n    };\n    Image.prototype.alignmentSelect = function (e) {\n        var item = e.item;\n        if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n            return;\n        }\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n        selectNodeEle = (selectNodeEle[0].nodeName === 'IMG') ? selectNodeEle : [this.imgEle];\n        var args = { args: e, selectNode: selectNodeEle };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        switch (item.subCommand) {\n            case 'JustifyLeft':\n                this.alignImage(args, 'JustifyLeft');\n                break;\n            case 'JustifyCenter':\n                this.alignImage(args, 'JustifyCenter');\n                break;\n            case 'JustifyRight':\n                this.alignImage(args, 'JustifyRight');\n                break;\n            case 'Inline':\n                this.inline(args);\n                break;\n            case 'Break':\n                this.break(args);\n                break;\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNodeEle[0]], 'e-img-focus');\n        }\n        this.cancelResizeAction();\n    };\n    Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n        var separator;\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                addClass([items[i]], 'e-link-groups');\n                items[i].style.display = 'none';\n            }\n            else if (items[i].getAttribute('title') === 'Insert Link') {\n                items[i].style.display = '';\n            }\n            else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                // eslint-disable-next-line\n                separator = items[i];\n                detach(items[i]);\n            }\n        }\n        var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n        this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n    };\n    Image.prototype.showImageQuickToolbar = function (e) {\n        var _this = this;\n        if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule)\n            || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n            return;\n        }\n        this.quickToolObj = this.parent.quickToolbarModule;\n        var args = e.args;\n        var target = e.elements;\n        [].forEach.call(e.elements, function (element, index) {\n            if (index === 0) {\n                target = element;\n            }\n        });\n        if (target && !closest(target, 'a')) {\n            this.imageWithLinkQTBarItemUpdate();\n        }\n        if (target.nodeName === 'IMG') {\n            addClass([target], ['e-img-focus']);\n        }\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n        if (this.parent.quickToolbarModule.imageQTBar) {\n            if (e.isNotify) {\n                setTimeout(function () {\n                    _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n                }, 400);\n            }\n            else {\n                this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n            }\n        }\n    };\n    Image.prototype.hideImageQuickToolbar = function () {\n        if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n            removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n            if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n    };\n    Image.prototype.editAreaClickHandler = function (e) {\n        if (this.parent.readonly) {\n            this.hideImageQuickToolbar();\n            return;\n        }\n        var args = e.args;\n        var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n        if (args.which === 2 || (showOnRightClick && args.which === 1) || (!showOnRightClick && args.which === 3)) {\n            if ((showOnRightClick && args.which === 1) && !isNullOrUndefined(args.target) &&\n                args.target.tagName === 'IMG') {\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n            }\n            return;\n        }\n        if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n            this.quickToolObj = this.parent.quickToolbarModule;\n            var target = args.target;\n            this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n            var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n            if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n                if (isPopupOpen) {\n                    return;\n                }\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n                if (isIDevice()) {\n                    this.parent.notify(events.selectionSave, e);\n                }\n                addClass([target], 'e-img-focus');\n                var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n                var separator = void 0;\n                if (closest(target, 'a')) {\n                    for (var i = 0; i < items.length; i++) {\n                        if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                            items[i].style.display = '';\n                            removeClass([items[i]], 'e-link-groups');\n                        }\n                        else if (items[i].getAttribute('title') === 'Insert Link') {\n                            items[i].style.display = 'none';\n                        }\n                        else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                            // eslint-disable-next-line\n                            separator = items[i];\n                            detach(items[i]);\n                        }\n                    }\n                    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n                    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n                }\n                else if (!closest(target, 'a')) {\n                    this.imageWithLinkQTBarItemUpdate();\n                }\n                this.showImageQuickToolbar({ args: args, type: 'Images', elements: [args.target] });\n            }\n            else {\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.insertImgLink = function (e, inputDetails) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var linkWrap = this.parent.createElement('div', { className: 'e-img-linkwrap' });\n            var linkUrl = this.i10n.getConstant('linkurl');\n            var content = '<div class=\"e-rte-field\">' +\n                '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' +\n                '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' +\n                '<input type=\"checkbox\" class=\"e-rte-linkTarget\"  data-role =\"none\"></div>';\n            var contentElem = parseHtml(content);\n            linkWrap.appendChild(contentElem);\n            var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n            var inputLink = linkWrap.querySelector('.e-img-link');\n            var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n            this.checkBoxObj = new CheckBox({\n                label: linkOpenLabel, checked: true, enableRtl: this.parent.enableRtl, change: function (e) {\n                    if (e.checked) {\n                        target_1 = '_blank';\n                    }\n                    else {\n                        target_1 = null;\n                    }\n                }\n            });\n            this.checkBoxObj.isStringTemplate = true;\n            this.checkBoxObj.createElement = this.parent.createElement;\n            this.checkBoxObj.appendTo(linkTarget);\n            var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var linkargs_1 = {\n                args: e.args,\n                selfImage: this, selection: e.selection,\n                selectNode: e.selectNode, selectParent: e.selectParent, link: inputLink, target: target_1\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit',\n                width: '290px',\n                header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n                content: linkWrap,\n                position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertlink(linkargs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-link', isPrimary: true\n                        }\n                    }]\n            });\n            if (!isNullOrUndefined(inputDetails)) {\n                inputLink.value = inputDetails.url;\n                // eslint-disable-next-line\n                (inputDetails.target) ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n                this.dialogObj.header = inputDetails.header;\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAltText = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        var altText = this.i10n.getConstant('altText');\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var altWrap = this.parent.createElement('div', { className: 'e-img-altwrap' });\n            var altHeader = this.i10n.getConstant('alternateHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var getAlt = (e.selectNode[0].getAttribute('alt') === null) ? '' :\n                e.selectNode[0].getAttribute('alt');\n            var content = '<div class=\"e-rte-field\">' +\n                '<input type=\"text\" spellcheck=\"false\" value=\"' + getAlt + '\" class=\"e-input e-img-alt\" placeholder=\"' + altText + '\"/>' +\n                '</div>';\n            var contentElem = parseHtml(content);\n            altWrap.appendChild(contentElem);\n            var inputAlt = altWrap.querySelector('.e-img-alt');\n            var altArgs_1 = {\n                args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode,\n                alt: inputAlt\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit', width: '290px', header: altHeader, content: altWrap, position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertAlt(altArgs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-alt', isPrimary: true\n                        }\n                    }]\n            });\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAlt = function (e) {\n        if (!isNullOrUndefined(e.alt)) {\n            e.selection.restore();\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            var altText = e.alt.value;\n            this.parent.formatter.process(this.parent, e.args, e.args, {\n                altText: altText, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            this.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.insertlink = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var url = e.link.value;\n        if (url === '') {\n            addClass([e.link], 'e-error');\n            e.link.setSelectionRange(0, url.length);\n            e.link.focus();\n            return;\n        }\n        if (!this.isUrl(url)) {\n            url = 'http://' + url;\n        }\n        else {\n            removeClass([e.link], 'e-error');\n        }\n        var proxy = e.selfImage;\n        if (proxy.parent.editorMode === 'HTML') {\n            e.selection.restore();\n        }\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (e.selectNode[0].parentElement.nodeName === 'A') {\n            proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n                url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            proxy.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n            url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand, selection: e.selection\n        });\n        var captionEle = closest(e.selectNode[0], '.e-img-caption');\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        proxy.dialogObj.hide({ returnValue: false });\n    };\n    Image.prototype.isUrl = function (url) {\n        // eslint-disable-next-line\n        var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n        return regexp.test(url);\n    };\n    Image.prototype.deleteImg = function (e, keyCode) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var args = {\n            element: e.selectNode[0],\n            src: e.selectNode[0].getAttribute('src')\n        };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        e.selection.restore();\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n            this.removeResizeEle();\n        }\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            selectNode: e.selectNode,\n            captionClass: classes.CLS_CAPTION,\n            subCommand: e.args.item.subCommand\n        });\n        this.imageRemovePost(args.src);\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n        }\n        this.cancelResizeAction();\n        if (isNullOrUndefined(keyCode)) {\n            this.parent.trigger(events.afterImageDelete, args);\n        }\n    };\n    Image.prototype.imageRemovePost = function (src) {\n        var proxy = this;\n        var absoluteUrl = '';\n        if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n            return;\n        }\n        if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n            absoluteUrl = src;\n        }\n        else {\n            absoluteUrl = new URL(src, document.baseURI).href;\n        }\n        this.removingImgName = absoluteUrl.replace(/^.*[\\\\\\/]/, '');\n        var xhr = new XMLHttpRequest();\n        xhr.addEventListener(\"readystatechange\", function () {\n            if (this.readyState == 4 && this.status == 200) {\n                proxy.triggerPost(this.response);\n            }\n        });\n        xhr.open('GET', absoluteUrl);\n        xhr.responseType = 'blob';\n        xhr.send();\n    };\n    Image.prototype.triggerPost = function (response) {\n        var removeUrl = this.parent.insertImageSettings.removeUrl;\n        if (isNOU(removeUrl) || removeUrl === '') {\n            return;\n        }\n        var file = new File([response], this.removingImgName);\n        var ajax = new Ajax(removeUrl, 'POST', true, null);\n        var formData = new FormData();\n        formData.append('UploadFiles', file);\n        ajax.send(formData);\n    };\n    Image.prototype.caption = function (e) {\n        var selectNode = e.selectNode[0];\n        if (selectNode.nodeName !== 'IMG') {\n            return;\n        }\n        e.selection.restore();\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        this.cancelResizeAction();\n        addClass([selectNode], 'e-rte-image');\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Caption';\n        if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n            detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n            if (Browser.isIE) {\n                this.contentModule.getEditPanel().focus();\n                e.selection.restore();\n            }\n            if (selectNode.parentElement.tagName === 'A') {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode.parentElement, selectNode: e.selectNode, subCommand: subCommand });\n            }\n            else {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode, selectNode: e.selectNode, subCommand: subCommand });\n            }\n        }\n        else {\n            this.captionEle = this.parent.createElement('span', {\n                className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION,\n                attrs: { contenteditable: 'false', draggable: 'false', style: 'width:' + this.parent.insertImageSettings.width }\n            });\n            var imgWrap = this.parent.createElement('span', { className: 'e-img-wrap' });\n            var imgInner = this.parent.createElement('span', { className: 'e-img-inner',\n                attrs: { contenteditable: 'true' } });\n            var parent_1 = e.selectNode[0].parentElement;\n            if (parent_1.tagName === 'A') {\n                parent_1.setAttribute('contenteditable', 'true');\n            }\n            imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n            imgWrap.appendChild(imgInner);\n            var imgCaption = this.i10n.getConstant('imageCaption');\n            imgInner.innerHTML = imgCaption;\n            this.captionEle.appendChild(imgWrap);\n            if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n                addClass([this.captionEle], classes.CLS_CAPINLINE);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n                addClass([this.captionEle], classes.CLS_IMGBREAK);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n                addClass([this.captionEle], classes.CLS_IMGLEFT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n                addClass([this.captionEle], classes.CLS_IMGRIGHT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n                addClass([this.captionEle], classes.CLS_IMGCENTER);\n            }\n            this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: this.captionEle, selectNode: e.selectNode, subCommand: subCommand });\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNode], 'e-img-focus');\n        }\n    };\n    Image.prototype.imageSize = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var dialogContent = this.imgsizeInput(e);\n            var selectObj_1 = { args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode };\n            this.dialogObj.setProperties({\n                height: 'inherit', width: '290px', header: imgSizeHeader, content: dialogContent, position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertSize(selectObj_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-size', isPrimary: true\n                        }\n                    }]\n            });\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.break = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Break';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.inline = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Inline';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.alignImage = function (e, type) {\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : type;\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.clearDialogObj = function () {\n        if (this.dialogObj) {\n            this.dialogObj.destroy();\n            detach(this.dialogObj.element);\n            this.dialogObj = null;\n        }\n    };\n    Image.prototype.imagDialog = function (e) {\n        var _this = this;\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        var imgDialog = this.parent.createElement('div', { className: 'e-rte-img-dialog', id: this.rteID + '_image' });\n        this.parent.element.appendChild(imgDialog);\n        var imgInsert = this.i10n.getConstant('dialogInsert');\n        var imglinkCancel = this.i10n.getConstant('dialogCancel');\n        var imgHeader = this.i10n.getConstant('imageHeader');\n        var selection = e.selection;\n        var selectObj = { selfImage: this, selection: e.selection, args: e.args, selectParent: e.selectParent };\n        var dialogModel = {\n            header: imgHeader,\n            cssClass: classes.CLS_RTE_ELEMENTS,\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            showCloseIcon: true, closeOnEscape: true, width: (Browser.isDevice) ? '290px' : '340px', height: 'inherit',\n            position: { X: 'center', Y: (Browser.isDevice) ? 'center' : 'top' },\n            isModal: Browser.isDevice,\n            buttons: [{\n                    click: this.insertImageUrl.bind(selectObj),\n                    buttonModel: { content: imgInsert, cssClass: 'e-flat e-insertImage', isPrimary: true, disabled: true }\n                },\n                {\n                    click: function (e) {\n                        _this.cancelDialog(e);\n                    },\n                    buttonModel: { cssClass: 'e-flat e-cancel', content: imglinkCancel }\n                }],\n            target: (Browser.isDevice) ? document.body : this.parent.element,\n            animationSettings: { effect: 'None' },\n            close: function (event) {\n                if (_this.isImgUploaded) {\n                    _this.uploadObj.removing();\n                }\n                _this.parent.isBlur = false;\n                if (event && event.event.returnValue) {\n                    if (_this.parent.editorMode === 'HTML') {\n                        selection.restore();\n                    }\n                    else {\n                        _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n                    }\n                }\n                _this.dialogObj.destroy();\n                detach(_this.dialogObj.element);\n                _this.dialogRenderObj.close(event);\n                _this.dialogObj = null;\n            }\n        };\n        var dialogContent = this.parent.createElement('div', { className: 'e-img-content' });\n        if ((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n            || this.parent.editorMode === 'HTML') {\n            dialogContent.appendChild(this.imgUpload(e));\n        }\n        var linkHeader = this.parent.createElement('div', { className: 'e-linkheader' });\n        var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n        if (this.parent.editorMode === 'HTML') {\n            linkHeader.innerHTML = linkHeaderText;\n        }\n        else {\n            linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n        }\n        dialogContent.appendChild(linkHeader);\n        dialogContent.appendChild(this.imageUrlPopup(e));\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n            dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n            dialogModel.content = dialogContent;\n        }\n        else {\n            dialogModel.content = dialogContent;\n        }\n        this.dialogObj = this.dialogRenderObj.render(dialogModel);\n        this.dialogObj.createElement = this.parent.createElement;\n        this.dialogObj.appendTo(imgDialog);\n        if (isNullOrUndefined(this.dialogObj)) {\n            return;\n        }\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && (e.name === 'insertImage')) {\n            this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n        }\n        imgDialog.style.maxHeight = 'inherit';\n        if (this.quickToolObj) {\n            if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n                if (!isNullOrUndefined(e.selectParent)) {\n                    removeClass([e.selectParent[0]], 'e-img-focus');\n                }\n            }\n            if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n                this.quickToolObj.inlineQTBar.hidePopup();\n            }\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.cancelDialog = function (e) {\n        this.parent.isBlur = false;\n        this.dialogObj.hide({ returnValue: true });\n        if (this.isImgUploaded) {\n            this.uploadObj.removing();\n        }\n    };\n    Image.prototype.onDocumentClick = function (e) {\n        var target = e.target;\n        if (target.nodeName === 'IMG') {\n            this.imgEle = target;\n        }\n        if (!isNullOrUndefined(this.dialogObj) && ((\n        // eslint-disable-next-line\n        !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() &&\n            !this.parent.getToolbarElement().contains(e.target)) ||\n            (this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) &&\n                !closest(target, '#' + this.parent.getID() + '_toolbar_Image') &&\n                !target.querySelector('#' + this.parent.getID() + '_toolbar_Image')))) {\n            /* eslint-disable */\n            if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {\n            }\n            else {\n                this.dialogObj.hide({ returnValue: true });\n                this.parent.isBlur = true;\n                dispatchEvent(this.parent.element, 'focusout');\n            }\n            /* eslint-enable */\n        }\n        if (e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj &&\n            this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) &&\n            this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n            if (target.tagName !== 'IMG') {\n                this.removeResizeEle();\n            }\n            if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n                this.imgEle.style.outline = '';\n            }\n            else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n                this.prevSelectedImgEle.style.outline = '';\n            }\n        }\n    };\n    Image.prototype.removeResizeEle = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n    };\n    Image.prototype.onWindowResize = function () {\n        if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n            this.cancelResizeAction();\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.imageUrlPopup = function (e) {\n        var _this = this;\n        var imgUrl = this.parent.createElement('div', { className: 'imgUrl' });\n        var placeUrl = this.i10n.getConstant('imageUrl');\n        this.inputUrl = this.parent.createElement('input', {\n            className: 'e-input e-img-url',\n            attrs: { placeholder: placeUrl, spellcheck: 'false' }\n        });\n        this.inputUrl.addEventListener('input', function () {\n            if (!isNOU(_this.inputUrl)) {\n                if (_this.inputUrl.value.length === 0) {\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                }\n                else {\n                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n            }\n        });\n        imgUrl.appendChild(this.inputUrl);\n        return imgUrl;\n    };\n    // eslint-disable-next-line\n    Image.prototype.insertImageUrl = function (e) {\n        var proxy = this.selfImage;\n        proxy.isImgUploaded = false;\n        var url = proxy.inputUrl.value;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n            proxy.uploadUrl.cssClass = (proxy.parent.insertImageSettings.display === 'inline' ?\n                classes.CLS_IMGINLINE : classes.CLS_IMGBREAK);\n            proxy.dialogObj.hide({ returnValue: false });\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n            proxy.uploadUrl.url = '';\n            if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                proxy.imgEle.style.outline = '';\n                proxy.removeResizeEle();\n            }\n        }\n        else if (url !== '') {\n            if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest(\n            // eslint-disable-next-line\n            this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n                proxy.contentModule.getEditPanel().focus();\n                var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n                this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n                this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            }\n            var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n            var matchUrl = (!isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML') ? url.match(regex)[0] : '';\n            var value = {\n                cssClass: (proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                url: url, selection: this.selection, altText: matchUrl,\n                selectParent: this.selectParent, width: {\n                    width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                },\n                height: {\n                    height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                }\n            };\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n            proxy.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.imgsizeInput = function (e) {\n        var _this = this;\n        var selectNode = e.selectNode[0];\n        var imgHeight = this.i10n.getConstant('imageHeight');\n        var imgWidth = this.i10n.getConstant('imageWidth');\n        var imgSizeWrap = this.parent.createElement('div', { className: 'e-img-sizewrap' });\n        var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' ||\n            selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ?\n            this.changedWidthValue : (parseInt(selectNode.getClientRects()[0].width.toString(), 10)).toString();\n        var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' ||\n            selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ?\n            this.changedHeightValue : (parseInt(selectNode.getClientRects()[0].height.toString(), 10)).toString();\n        this.changedWidthValue = null;\n        this.changedHeightValue = null;\n        var content = '<div class=\"e-rte-label\"><label>' + imgWidth +\n            '</label></div><div class=\"e-rte-field\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width\" value=' +\n            widthVal\n            + ' /></div>' +\n            '<div class=\"e-rte-label\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field\"> ' +\n            '<input type=\"text\" id=\"imgheight\" class=\"e-img-height\" value=' +\n            heightVal\n            + ' /></div>';\n        var contentElem = parseHtml(content);\n        imgSizeWrap.appendChild(contentElem);\n        var widthNum = new TextBox({\n            value: formatUnit(widthVal),\n            enableRtl: this.parent.enableRtl,\n            input: function (e) {\n                _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        widthNum.createElement = this.parent.createElement;\n        widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n        var heightNum = new TextBox({\n            value: formatUnit(heightVal),\n            enableRtl: this.parent.enableRtl,\n            input: function (e) {\n                _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        heightNum.createElement = this.parent.createElement;\n        heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n        return imgSizeWrap;\n    };\n    Image.prototype.inputValue = function (value) {\n        if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1\n            || value.match(/(\\d+)/)) {\n            return value;\n        }\n        else {\n            return 'auto';\n        }\n    };\n    Image.prototype.insertSize = function (e) {\n        e.selection.restore();\n        var proxy = e.selfImage;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        var dialogEle = proxy.dialogObj.element;\n        this.changedWidthValue = this.inputWidthValue;\n        this.changedHeightValue = this.inputHeightValue;\n        var width = dialogEle.querySelector('.e-img-width').value;\n        var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n        proxy.parent.formatter.process(this.parent, e.args, e.args, {\n            width: width, height: height, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.imgResizeDiv) {\n            proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n        }\n        proxy.dialogObj.hide({ returnValue: true });\n    };\n    Image.prototype.insertImage = function (e) {\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n            if (((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n                || this.parent.editorMode === 'HTML')) {\n                document.getElementById(this.rteID + '_insertImage').focus();\n            }\n            else {\n                dialogContent.querySelector('.e-img-url').focus();\n            }\n        }\n    };\n    Image.prototype.imgUpload = function (e) {\n        var _this = this;\n        var save;\n        var selectParent;\n        // eslint-disable-next-line\n        var proxy = this;\n        var iframe = proxy.parent.iframeSettings.enable;\n        if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id='\n            // eslint-disable-next-line\n            + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']'))\n            || (iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib')))) {\n            this.contentModule.getEditPanel().focus();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = e.selection;\n            selectParent = e.selectParent;\n        }\n        var uploadParentEle = this.parent.createElement('div', { className: 'e-img-uploadwrap e-droparea' });\n        var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n        var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n        var span = this.parent.createElement('span', { className: 'e-droptext' });\n        var spanMsg = this.parent.createElement('span', {\n            className: 'e-rte-upload-text', innerHTML: ((Browser.isDevice) ? deviceImgUpMsg : imgUpMsg)\n        });\n        span.appendChild(spanMsg);\n        var btnEle = this.parent.createElement('button', {\n            className: 'e-browsebtn', id: this.rteID + '_insertImage', attrs: { autofocus: 'true', type: 'button' }\n        });\n        span.appendChild(btnEle);\n        uploadParentEle.appendChild(span);\n        var browserMsg = this.i10n.getConstant('browse');\n        var button = new Button({ content: browserMsg, enableRtl: this.parent.enableRtl });\n        button.isStringTemplate = true;\n        button.createElement = this.parent.createElement;\n        button.appendTo(btnEle);\n        var btnClick = (Browser.isDevice) ? span : btnEle;\n        EventHandler.add(btnClick, 'click', this.fileSelect, this);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        uploadParentEle.appendChild(uploadEle);\n        var altText;\n        var rawFile;\n        var selectArgs;\n        var filesData;\n        var beforeUploadArgs;\n        this.uploadObj = new Uploader({\n            asyncSettings: { saveUrl: this.parent.insertImageSettings.saveUrl, removeUrl: this.parent.insertImageSettings.removeUrl },\n            dropArea: span, multiple: false, enableRtl: this.parent.enableRtl,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            selected: function (e) {\n                proxy.isImgUploaded = true;\n                selectArgs = e;\n                filesData = e.filesData;\n                if (_this.parent.isServerRendered) {\n                    selectArgs = JSON.parse(JSON.stringify(e));\n                    e.cancel = true;\n                    rawFile = e.filesData;\n                    selectArgs.filesData = rawFile;\n                }\n                _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n                    if (!selectArgs.cancel) {\n                        _this.checkExtension(selectArgs.filesData[0]);\n                        altText = selectArgs.filesData[0].name;\n                        if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                            var reader_1 = new FileReader();\n                            // eslint-disable-next-line\n                            reader_1.addEventListener('load', function (e) {\n                                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result :\n                                    URL.createObjectURL(convertToBlob(reader_1.result));\n                                proxy.uploadUrl = {\n                                    url: url, selection: save, altText: altText,\n                                    selectParent: selectParent,\n                                    width: {\n                                        width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                        maxWidth: proxy.parent.getInsertImgMaxWidth()\n                                    }, height: {\n                                        height: proxy.parent.insertImageSettings.height,\n                                        minHeight: proxy.parent.insertImageSettings.minHeight,\n                                        maxHeight: proxy.parent.insertImageSettings.maxHeight\n                                    }\n                                };\n                                proxy.inputUrl.setAttribute('disabled', 'true');\n                                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes\n                                    && !isNullOrUndefined(_this.dialogObj)) {\n                                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                                }\n                            });\n                            reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n                        }\n                        if (_this.parent.isServerRendered) {\n                            /* eslint-disable */\n                            _this.uploadObj._internalRenderSelect(selectArgs, rawFile);\n                            /* eslint-enable */\n                        }\n                    }\n                });\n            },\n            beforeUpload: function (args) {\n                if (_this.parent.isServerRendered) {\n                    beforeUploadArgs = JSON.parse(JSON.stringify(args));\n                    beforeUploadArgs.filesData = filesData;\n                    args.cancel = true;\n                    _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n                        if (beforeUploadArgs.cancel) {\n                            return;\n                        }\n                        /* eslint-disable */\n                        _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ?\n                            beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n                        _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ?\n                            beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n                        _this.uploadObj.uploadFiles(rawFile, null);\n                        /* eslint-enable */\n                    });\n                }\n                else {\n                    _this.parent.trigger(events.beforeImageUpload, args);\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    _this.parent.trigger(events.imageUploading, e);\n                }\n            },\n            success: function (e) {\n                _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n                    if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                        var url = _this.parent.insertImageSettings.path + e.file.name;\n                        // eslint-disable-next-line\n                        var value = { url: url, selection: save };\n                        proxy.uploadUrl = {\n                            url: url, selection: save, altText: altText, selectParent: selectParent,\n                            width: {\n                                width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                maxWidth: proxy.parent.getInsertImgMaxWidth()\n                            }, height: {\n                                height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                                maxHeight: proxy.parent.insertImageSettings.maxHeight\n                            }\n                        };\n                        proxy.inputUrl.setAttribute('disabled', 'true');\n                    }\n                    if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n                        _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                    }\n                });\n            },\n            failure: function (e) {\n                _this.parent.trigger(events.imageUploadFailed, e);\n            },\n            removing: function () {\n                // eslint-disable-next-line\n                _this.parent.trigger(events.imageRemoving, e, function (e) {\n                    proxy.isImgUploaded = false;\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                    proxy.inputUrl.removeAttribute('disabled');\n                    if (proxy.uploadUrl) {\n                        proxy.uploadUrl.url = '';\n                    }\n                });\n            }\n        });\n        this.uploadObj.isStringTemplate = true;\n        this.uploadObj.createElement = this.parent.createElement;\n        this.uploadObj.appendTo(uploadEle);\n        return uploadParentEle;\n    };\n    Image.prototype.checkExtension = function (e) {\n        if (this.uploadObj.allowedExtensions) {\n            if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n                this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n                this.isAllowedTypes = false;\n            }\n            else {\n                this.isAllowedTypes = true;\n            }\n        }\n    };\n    Image.prototype.fileSelect = function () {\n        this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n        return false;\n    };\n    Image.prototype.dragStart = function (e) {\n        if (e.target.nodeName === 'IMG') {\n            this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                if (actionBeginArgs.cancel) {\n                    e.preventDefault();\n                }\n                else {\n                    e.dataTransfer.effectAllowed = 'copyMove';\n                    e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n                }\n            });\n        }\n        else {\n            return true;\n        }\n    };\n    Image.prototype.dragEnter = function (e) {\n        e.dataTransfer.dropEffect = 'copy';\n        e.preventDefault();\n    };\n    Image.prototype.dragOver = function (e) {\n        if ((Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1) ||\n            (Browser.isIE && e.dataTransfer.types[0] === 'Files')) {\n            e.preventDefault();\n        }\n        else {\n            return true;\n        }\n    };\n    /**\n     * Used to set range When drop an image\n     *\n     * @param {ImageDropEventArgs} args - specifies the image arguments.\n     * @returns {void}\n     */\n    Image.prototype.dragDrop = function (args) {\n        var _this = this;\n        this.parent.trigger(events.beforeImageDrop, args, function (e) {\n            var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n            var isImgOrFileDrop = (imgElement && imgElement.tagName === 'IMG') || e.dataTransfer.files.length > 0;\n            if (!e.cancel && isImgOrFileDrop) {\n                _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                    if (actionBeginArgs.cancel) {\n                        e.preventDefault();\n                    }\n                    else {\n                        if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') ||\n                            _this.parent.inputElement.contentEditable === 'false') {\n                            e.preventDefault();\n                            return;\n                        }\n                        if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n                            detach(_this.imgResizeDiv);\n                        }\n                        e.preventDefault();\n                        var range = void 0;\n                        if (_this.contentModule.getDocument().caretRangeFromPoint) { //For chrome\n                            range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n                        }\n                        else if ((e.rangeParent)) { //For mozilla firefox\n                            range = _this.contentModule.getDocument().createRange();\n                            range.setStart(e.rangeParent, e.rangeOffset);\n                        }\n                        else {\n                            range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n                        }\n                        _this.parent.notify(events.selectRange, { range: range });\n                        var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n                        if (uploadArea) {\n                            return;\n                        }\n                        _this.insertDragImage(e);\n                    }\n                });\n            }\n            else {\n                if (isImgOrFileDrop) {\n                    e.preventDefault();\n                }\n            }\n        });\n    };\n    /**\n     * Used to calculate range on internet explorer\n     *\n     * @param {number} x - specifies the x range.\n     * @param {number} y - specifies the y range.\n     * @returns {void}\n     */\n    Image.prototype.getDropRange = function (x, y) {\n        var startRange = this.contentModule.getDocument().createRange();\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n        var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n        var startNode = (elem.childNodes.length > 0 ? elem.childNodes[0] : elem);\n        var startCharIndexCharacter = 0;\n        if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n            startRange.setStart(startNode, startCharIndexCharacter);\n            startRange.setEnd(startNode, startCharIndexCharacter);\n        }\n        else {\n            var rangeRect = void 0;\n            do {\n                startCharIndexCharacter++;\n                startRange.setStart(startNode, startCharIndexCharacter);\n                startRange.setEnd(startNode, startCharIndexCharacter + 1);\n                rangeRect = startRange.getBoundingClientRect();\n            } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n        }\n        return startRange;\n    };\n    Image.prototype.insertDragImage = function (e) {\n        var _this = this;\n        e.preventDefault();\n        var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n        this.parent.notify(events.drop, { args: e });\n        if (activePopupElement) {\n            activePopupElement.classList.add(classes.CLS_HIDE);\n        }\n        if (e.dataTransfer.files.length > 0) { //For external image drag and drop\n            if (e.dataTransfer.files.length > 1) {\n                return;\n            }\n            var imgFiles = e.dataTransfer.files;\n            var fileName = imgFiles[0].name;\n            var imgType = fileName.substring(fileName.lastIndexOf('.'));\n            var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n            for (var i = 0; i < allowedTypes.length; i++) {\n                if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n                    if (this.parent.insertImageSettings.saveUrl) {\n                        this.onSelect(e);\n                    }\n                    else {\n                        var args = { args: e, text: '', file: imgFiles[0] };\n                        e.preventDefault();\n                        this.imagePaste(args);\n                    }\n                }\n            }\n        }\n        else { //For internal image drag and drop\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n            if (imgElement && imgElement.tagName === 'IMG') {\n                if (imgElement.nextElementSibling) {\n                    if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n                        range.insertNode(imgElement.parentElement.parentElement);\n                    }\n                    else {\n                        range.insertNode(imgElement);\n                    }\n                }\n                else {\n                    range.insertNode(imgElement);\n                }\n                imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n                var imgArgs_1 = { elements: [imgElement] };\n                imgElement.addEventListener('load', function () {\n                    _this.parent.trigger(events.actionComplete, imgArgs_1);\n                });\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                var args = e;\n                this.resizeStart(args, imgElement);\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.onSelect = function (args) {\n        var _this = this;\n        // eslint-disable-next-line\n        var proxy = this;\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var parentElement = this.parent.createElement('ul', { className: classes.CLS_UPLOAD_FILES });\n        this.parent.element.appendChild(parentElement);\n        var validFiles = {\n            name: '',\n            size: 0,\n            status: '',\n            statusCode: '',\n            type: '',\n            rawFile: args.dataTransfer.files[0],\n            validationMessages: {}\n        };\n        var imageTag = this.parent.createElement('IMG');\n        imageTag.style.opacity = '0.5';\n        imageTag.classList.add(classes.CLS_RTE_IMAGE);\n        imageTag.classList.add(classes.CLS_IMGINLINE);\n        imageTag.classList.add(classes.CLS_RESIZE);\n        var file = validFiles.rawFile;\n        var reader = new FileReader();\n        reader.addEventListener('load', function () {\n            var url = URL.createObjectURL(convertToBlob(reader.result));\n            imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n        });\n        if (file) {\n            reader.readAsDataURL(file);\n        }\n        range.insertNode(imageTag);\n        this.uploadMethod(args, imageTag);\n        var e = { elements: [imageTag] };\n        imageTag.addEventListener('load', function () {\n            _this.parent.trigger(events.actionComplete, e);\n        });\n        detach(parentElement);\n    };\n    /**\n     * Rendering uploader and popup for drag and drop\n     *\n     * @param {DragEvent} dragEvent - specifies the event.\n     * @param {HTMLImageElement} imageElement - specifies the element.\n     * @returns {void}\n     */\n    Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n        var _this = this;\n        var isUploading = false;\n        // eslint-disable-next-line\n        var proxy = this;\n        var popupEle = this.parent.createElement('div');\n        this.parent.element.appendChild(popupEle);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n        this.popupObj = new Popup(popupEle, {\n            relateTo: imageElement,\n            height: '85px',\n            width: '300px',\n            offsetY: offsetY,\n            content: uploadEle,\n            viewPortElement: this.parent.element,\n            position: { X: 'center', Y: 'top' },\n            enableRtl: this.parent.enableRtl,\n            zIndex: 10001,\n            // eslint-disable-next-line\n            close: function (event) {\n                _this.parent.isBlur = false;\n                _this.popupObj.destroy();\n                detach(_this.popupObj.element);\n                _this.popupObj = null;\n                if (!_this.parent.inlineMode.enable) {\n                    _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n                }\n            }\n        });\n        this.popupObj.element.style.display = 'none';\n        addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n        addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n        setTimeout(function () {\n            proxy.refreshPopup(imageElement);\n        }, timeOut);\n        var rawFile;\n        var beforeUploadArgs;\n        this.uploadObj = new Uploader({\n            asyncSettings: {\n                saveUrl: this.parent.insertImageSettings.saveUrl,\n                removeUrl: this.parent.insertImageSettings.removeUrl\n            },\n            cssClass: classes.CLS_RTE_DIALOG_UPLOAD,\n            dropArea: this.parent.element,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            removing: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n            },\n            canceling: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n                _this.quickToolObj.imageQTBar.hidePopup();\n                setTimeout(function () {\n                    _this.uploadObj.destroy();\n                }, 900);\n            },\n            beforeUpload: function (args) {\n                if (_this.parent.isServerRendered) {\n                    beforeUploadArgs = JSON.parse(JSON.stringify(args));\n                    beforeUploadArgs.filesData = rawFile;\n                    isUploading = true;\n                    args.cancel = true;\n                    _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n                        if (beforeUploadArgs.cancel) {\n                            return;\n                        }\n                        if (!_this.parent.inlineMode.enable) {\n                            _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                        }\n                        /* eslint-disable */\n                        _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ?\n                            beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n                        _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ?\n                            beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n                        _this.uploadObj.uploadFiles(rawFile, null);\n                        _this.parent.inputElement.contentEditable = 'false';\n                        /* eslint-enable */\n                    });\n                }\n                else {\n                    _this.parent.trigger(events.beforeImageUpload, args);\n                    if (!_this.parent.inlineMode.enable) {\n                        _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                    }\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    isUploading = true;\n                    _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n                        if (imageUploadingArgs.cancel) {\n                            if (!isNullOrUndefined(imageElement)) {\n                                detach(imageElement);\n                            }\n                            if (!isNullOrUndefined(_this.popupObj.element)) {\n                                detach(_this.popupObj.element);\n                            }\n                        }\n                        else {\n                            _this.parent.inputElement.contentEditable = 'false';\n                        }\n                    });\n                }\n            },\n            selected: function (e) {\n                if (isUploading) {\n                    e.cancel = true;\n                }\n                if (_this.parent.isServerRendered) {\n                    rawFile = e.filesData;\n                }\n            },\n            failure: function (e) {\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadFailure(imageElement, args, e);\n                }, 900);\n            },\n            success: function (e) {\n                if (e.operation === \"cancel\") {\n                    return;\n                }\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadSuccess(imageElement, dragEvent, args, e);\n                }, 900);\n            }\n        });\n        this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n        this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n        range.selectNodeContents(imageElement);\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n    };\n    Image.prototype.refreshPopup = function (imageElement) {\n        var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop +\n            imageElement.offsetTop : imageElement.offsetTop;\n        var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n        if (imgPosition > rtePosition) {\n            this.popupObj.relateTo = this.parent.inputElement;\n            this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n            this.popupObj.element.style.display = 'block';\n        }\n        else {\n            if (this.popupObj) {\n                this.popupObj.refreshPosition(imageElement);\n                this.popupObj.element.style.display = 'block';\n            }\n        }\n    };\n    /**\n     * Called when drop image upload was failed\n     *\n     * @param {HTMLElement} imgEle - specifies the image element.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {Object} e - specfies the object.\n     * @returns {void}\n     */\n    Image.prototype.uploadFailure = function (imgEle, args, e) {\n        detach(imgEle);\n        if (this.popupObj) {\n            this.popupObj.close();\n        }\n        this.parent.trigger(events.imageUploadFailed, e);\n        this.uploadObj.destroy();\n    };\n    /**\n     * Called when drop image upload was successful\n     *\n     * @param {HTMLElement} imageElement - specifies the image element.\n     * @param {DragEvent} dragEvent - specifies the drag event.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {ImageSuccessEventArgs} e - specifies the success event.\n     * @returns {void}\n     */\n    Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n        var _this = this;\n        imageElement.style.opacity = '1';\n        imageElement.classList.add(classes.CLS_IMG_FOCUS);\n        e.element = imageElement;\n        this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n            if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                var url = _this.parent.insertImageSettings.path + e.file.name;\n                imageElement.src = url;\n                imageElement.setAttribute('alt', e.file.name);\n            }\n        });\n        if (this.popupObj) {\n            this.popupObj.close();\n            this.uploadObj.destroy();\n        }\n        this.showImageQuickToolbar(args);\n        this.resizeStart(dragEvent, imageElement);\n    };\n    Image.prototype.imagePaste = function (args) {\n        var _this = this;\n        if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n            // eslint-disable-next-line\n            var proxy_1 = this;\n            var reader_2 = new FileReader();\n            args.args.preventDefault();\n            // eslint-disable-next-line\n            reader_2.addEventListener('load', function (e) {\n                var url = {\n                    cssClass: (proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                    url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ?\n                        reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n                    width: {\n                        width: proxy_1.parent.insertImageSettings.width, minWidth: proxy_1.parent.insertImageSettings.minWidth,\n                        maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n                    },\n                    height: {\n                        height: proxy_1.parent.insertImageSettings.height, minHeight: proxy_1.parent.insertImageSettings.minHeight,\n                        maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n                    }\n                };\n                if (!isNullOrUndefined(args.callBack)) {\n                    args.callBack(url);\n                    return;\n                }\n                else {\n                    proxy_1.parent.formatter.process(proxy_1.parent, { item: { command: 'Images', subCommand: 'Image' } }, args.args, url);\n                    _this.showPopupToolBar(args, url);\n                }\n            });\n            reader_2.readAsDataURL(args.file);\n        }\n    };\n    Image.prototype.showPopupToolBar = function (e, url) {\n        var _this = this;\n        var imageSrc = 'img[src=\"' + url.url + '\"]';\n        var imageElement = this.parent.inputElement.querySelector(imageSrc);\n        this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n        var args = {\n            args: e.args,\n            type: 'Images',\n            isNotify: undefined,\n            elements: imageElement\n        };\n        if (imageElement) {\n            setTimeout(function () {\n                _this.showImageQuickToolbar(args);\n                _this.resizeStart(e.args, imageElement);\n            }, 0);\n        }\n    };\n    /* eslint-disable */\n    /**\n     * Destroys the ToolBar.\n     *\n     * @method destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    /* eslint-enable */\n    Image.prototype.destroy = function () {\n        this.prevSelectedImgEle = undefined;\n        this.removeEventListener();\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {void}\n     */\n    Image.prototype.getModuleName = function () {\n        return 'image';\n    };\n    return Image;\n}());\nexport { Image };\n"]},"metadata":{},"sourceType":"module"}